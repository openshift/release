---
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  annotations:
    capability.openshift.io/name: CloudCredential
    exclude.release.openshift.io/internal-openshift-hosted: "true"
    include.release.openshift.io/self-managed-high-availability: "true"
  creationTimestamp: "2024-06-11T10:41:12Z"
  generation: 1
  managedFields:
  - apiVersion: monitoring.coreos.com/v1
    fieldsType: FieldsV1
    fieldsV1:
      f:metadata:
        f:annotations:
          .: {}
          f:capability.openshift.io/name: {}
          f:exclude.release.openshift.io/internal-openshift-hosted: {}
          f:include.release.openshift.io/self-managed-high-availability: {}
        f:ownerReferences:
          .: {}
          k:{"uid":"7f5ed23b-8031-407e-bbf3-8850738c2d59"}: {}
      f:spec:
        .: {}
        f:groups:
          .: {}
          k:{"name":"CloudCredentialOperator"}:
            .: {}
            f:name: {}
            f:rules: {}
    manager: cluster-version-operator
    operation: Update
    time: "2024-06-11T10:41:12Z"
  name: cloud-credential-operator-alerts
  namespace: openshift-cloud-credential-operator
  ownerReferences:
  - apiVersion: config.openshift.io/v1
    controller: true
    kind: ClusterVersion
    name: version
    uid: 7f5ed23b-8031-407e-bbf3-8850738c2d59
  resourceVersion: "1734"
  uid: 0b733474-3cf6-4d99-be15-4d982bd6d8bd
spec:
  groups:
  - name: CloudCredentialOperator
    rules:
    - alert: CloudCredentialOperatorTargetNamespaceMissing
      annotations:
        description: At least one CredentialsRequest custom resource has specified
          in its .spec.secretRef.namespace field a namespace which does not presently
          exist. This means the Cloud Credential Operator in the openshift-cloud-credential-operator
          namespace cannot process the CredentialsRequest resource. Check the conditions
          of all CredentialsRequests with 'oc get credentialsrequest -A' to find any
          CredentialsRequest(s) with a .status.condition showing a condition type
          of MissingTargetNamespace set to True.
        message: CredentialsRequest(s) pointing to non-existent namespace
        summary: One ore more CredentialsRequest CRs are asking to save credentials
          to a non-existent namespace.
      expr: cco_credentials_requests_conditions{condition="MissingTargetNamespace"}
        > 0
      for: 5m
      labels:
        severity: warning
    - alert: CloudCredentialOperatorProvisioningFailed
      annotations:
        description: While processing a CredentialsRequest, the Cloud Credential Operator
          encountered an issue. Check the conditions of all CredentialsRequests with
          'oc get credentialsrequest -A' to find any CredentialsRequest(s) with a
          .stats.condition showing a condition type of CredentialsProvisionFailure
          set to True for more details on the issue.
        message: CredentialsRequest(s) unable to be fulfilled
        summary: One or more CredentialsRequest CRs are unable to be processed.
      expr: cco_credentials_requests_conditions{condition="CredentialsProvisionFailure"}
        > 0
      for: 5m
      labels:
        severity: warning
    - alert: CloudCredentialOperatorDeprovisioningFailed
      annotations:
        description: While processing a CredentialsRequest marked for deletion, the
          Cloud Credential Operator encountered an issue. Check the conditions of
          all CredentialsRequests with 'oc get credentialsrequest -A' to find any
          CredentialsRequest(s) with a .status.condition showing a condition type
          of CredentialsDeprovisionFailure set to True for more details on the issue.
        message: CredentialsRequest(s) unable to be cleaned up
        summary: One or more CredentialsRequest CRs are unable to be deleted.
      expr: cco_credentials_requests_conditions{condition="CredentialsDeprovisionFailure"}
        > 0
      for: 5m
      labels:
        severity: warning
    - alert: CloudCredentialOperatorInsufficientCloudCreds
      annotations:
        description: The Cloud Credential Operator has determined that there are insufficient
          permissions to process one or more CredentialsRequest CRs. Check the conditions
          of all CredentialsRequests with 'oc get credentialsrequest -A' to find any
          CredentialsRequest(s) with a .status.condition showing a condition type
          of InsufficientCloudCreds set to True for more details.
        message: Cluster's cloud credentials insufficient for minting or passthrough
        summary: Problem with the available platform credentials.
      expr: cco_credentials_requests_conditions{condition="InsufficientCloudCreds"}
        > 0
      for: 5m
      labels:
        severity: warning
    - alert: CloudCredentialOperatorStaleCredentials
      annotations:
        description: The Cloud Credential Operator (CCO) has detected one or more
          stale CredentialsRequest CRs that need to be manually deleted. When the
          CCO is in Manual credentials mode, it will not automatically clean up stale
          CredentialsRequest CRs (that may no longer be necessary in the present version
          of OpenShift because it could involve needing to clean up manually created
          cloud resources. Check the conditions of all CredentialsRequests with 'oc
          get credentialsrequest -A' to find any CredentialsRequest(s) with a .status.condition
          showing a condition type of StaleCredentials set to True. Determine the
          appropriate steps to clean up/deprovision any previously provisioned cloud
          resources. Finally, delete the CredentialsRequest with an 'oc delete'.
        message: 1 or more credentials requests are stale and should be deleted. Check
          the status.conditions on CredentialsRequest CRs to identify the stale one(s).
        summary: One or more CredentialsRequest CRs are stale and should be deleted.
      expr: cco_credentials_requests_conditions{condition="StaleCredentials"} > 0
      for: 5m
      labels:
        severity: warning
