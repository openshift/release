presubmits:
  openshift/hypershift-toolkit:
    - agent: kubernetes
      always_run: true
      branches:
        - release-4.3
      context: ci/prow/build
      decorate: true
      decoration_config:
        skip_cloning: true
      labels:
        ci-operator.openshift.io/prowgen-controlled: "true"
        pj-rehearse.openshift.io/can-be-rehearsed: "true"
      name: deploy-ibm-cloud-cluster
      spec:
        imagePullSecrets:
        containers:
          - args:
              - --artifact-dir=$(ARTIFACTS)
              - --branch=release-4.3
              - --give-pr-author-access-to-namespace=true
              - --org=openshift
              - --repo=hypershift-toolkit
              - --resolver-address=http://ci-operator-configresolver-ci.svc.ci.openshift.org
              - --secret-dir=/etc/ibm-gate-test-secrets
              - --image-import-pull-secret=/usr/local/registry-default-secret/
              - --sentry-dsn-path=/etc/sentry-dsn/ci-operator
              - --target=create-cluster
          - args:
            command:
              - ci-operator
            env:
              - name: CONFIG_SPEC
                  valueFrom:
                    configMapKeyRef:
                      key: openshift-hypershift-toolkit-release-4.3.yaml
                      name: ci-operator-master-configs
              - name: OPENSHIFT_BUILD_NAMESPACE
                valueFrom:
                  fieldRef:
                    fieldPath: metadata.namespace
            image: ci-operator:latest
            imagePullPolicy: Always
            name: ""
            resources:
              requests:
                cpu: 10m
            volumeMounts:
              - mountPath: /etc/ibm-gate-test-secrets
                name: ibm-gate-test-secrets
                readOnly: true
              - mountPath: /etc/sentry-dsn
                name: sentry-dsn
                readOnly: true
        serviceAccountName: ci-operator
        volumes:
          - name: ibm-gate-test-secrets
            secret:
              secretName: ibm-gate-test-secrets
          - name: sentry-dsn
            secret:
              secretName: sentry-dsn
      trigger: (?m)^/test( | .* )build,?($|\s.*)
