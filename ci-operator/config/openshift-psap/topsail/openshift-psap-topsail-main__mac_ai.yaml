base_images:
  image_stream_tag:
    name: ci-tools-build-root
    namespace: ci
    tag: latest
resources:
  '*':
    limits:
      cpu: 2000m
    requests:
      cpu: 500m
      memory: 2Gi
tests:
- always_run: false
  as: jump-ci
  capabilities:
  - intranet
  restrict_network_access: false
  steps:
    allow_skip_on_success: true
    post:
    - as: 006-unlock-cluster
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run unlock_cluster
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    pre:
    - as: 001-lock-cluster
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run lock_cluster
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 10h0m0s
    - as: 002-prepare-jump-ci
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run prepare_jump_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 1h0m0s
    - as: 003-pre-cleanup
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test pre_cleanup_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    - as: 004-prepare
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test prepare_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 3h0m0s
    test:
    - as: 005-test
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test test_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 23h0m0s
- always_run: false
  as: jump-ci-mac5
  capabilities:
  - intranet
  restrict_network_access: false
  steps:
    allow_skip_on_success: true
    post:
    - as: 006-unlock-cluster
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run unlock_cluster
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    pre:
    - as: 001-lock-cluster
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run lock_cluster
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 10h0m0s
    - as: 002-prepare-jump-ci
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run prepare_jump_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 1h0m0s
    - as: 003-pre-cleanup
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test pre_cleanup_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    - as: 004-prepare
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test prepare_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 3h0m0s
    test:
    - as: 005-test
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin $PULL_PULL_SHA
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test test_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 23h0m0s
- as: jump-ci-cpt
  capabilities:
  - intranet
  cron: 0 12 * * *
  restrict_network_access: false
  steps:
    allow_skip_on_success: true
    post:
    - as: 006-post-cleanup
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test post_cleanup_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    - as: 007-unlock-cluster
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run unlock_cluster
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    pre:
    - as: 001-lock-cluster
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        cat <<EOF > variable_overrides.yaml
        ci_presets.to_apply: [cpt_nightly]
        EOF
        run jump_ci run lock_cluster
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 10h0m0s
    - as: 002-prepare-jump-ci
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run prepare_jump_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 1h0m0s
    - as: 003-pre-cleanup
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test pre_cleanup_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    - as: 004-prepare
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test prepare_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 3h0m0s
    test:
    - as: 005-test
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test test_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 23h0m0s
- as: jump-ci-cpt-lightspeed
  capabilities:
  - intranet
  cron: 0 11 * * *
  restrict_network_access: false
  steps:
    allow_skip_on_success: true
    post:
    - as: 006-post-cleanup
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test post_cleanup_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    - as: 007-unlock-cluster
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run unlock_cluster
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    pre:
    - as: 001-lock-cluster
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        cat <<EOF > variable_overrides.yaml
        ci_presets.to_apply: [cpt_nightly]
        EOF
        run jump_ci run lock_cluster
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 10h0m0s
    - as: 002-prepare-jump-ci
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci run prepare_jump_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 1h0m0s
    - as: 003-pre-cleanup
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test pre_cleanup_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
    - as: 004-prepare
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test prepare_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 3h0m0s
    test:
    - as: 005-test
      commands: |
        export CRC_MAC_AI_SECRET_PATH=/var/run/crc-mac-ai-secret
        git -C $HOME fetch --quiet origin main
        git -C $HOME reset --hard FETCH_HEAD
        run jump_ci test test_ci
      credentials:
      - collection: ""
        mount_path: /var/run/crc-mac-ai-secret
        name: crc-mac-ai-secret
        namespace: test-credentials
      from_image:
        name: topsail-light
        namespace: ci
        tag: latest
      resources:
        requests:
          cpu: 1000m
          memory: 500Mi
      timeout: 23h0m0s
zz_generated_metadata:
  branch: main
  org: openshift-psap
  repo: topsail
  variant: mac_ai
