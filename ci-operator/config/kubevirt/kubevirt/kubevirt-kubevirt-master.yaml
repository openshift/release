base_images:
  base:
    name: "4.2"
    namespace: ocp
    tag: base
build_root:
  project_image:
    context_dir: hack/kubevirt-builder
    dockerfile_path: Dockerfile
canonical_go_repository: kubevirt.io/kubevirt
binary_build_commands: |

  export GIMME_GO_VERSION=1.12.8
  export GOPATH="/go"
  export GOBIN="/usr/bin"
  source /etc/profile.d/gimme.sh
  go env

  export DOCKER_PREFIX='https://api.ci.openshift.org/kubevirt/kubevirt'
  export DOCKER_TAG='os-ci-devel'
  export KUBEVIRT_PROVIDER=external

  # build and push images
  bash -x ./hack/bazel-push-images.sh

resources:
  '*':
    limits:
      memory: 4Gi
    requests:
      cpu: 100m
      memory: 200Mi
tag_specification:
  name: "4.2"
  namespace: ocp
tests:
- as: "kubevirt-e2e-test"
  commands: |

    export GIMME_GO_VERSION=1.12.8
    export GOPATH="/go"
    export GOBIN="/usr/bin"
    source /etc/profile.d/gimme.sh
    go env

    export DOCKER_PREFIX='https://api.ci.openshift.org/kubevirt/kubevirt'
    export DOCKER_TAG='os-ci-devel'
    export KUBEVIRT_PROVIDER=external

    # create manifests
    bash -x ./hack/build-manifests.sh

    # deploy
    bash -x ./hack/cluster-deploy.sh

    # functest
    bash -x ./hack/functests.sh
  openshift_installer_src:
    cluster_profile: gcp
