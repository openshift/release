base_images:
  base:
    name: "4.2"
    namespace: ocp
    tag: base
build_root:
  project_image:
    context_dir: hack/kubevirt-builder
    dockerfile_path: Dockerfile
canonical_go_repository: kubevirt.io/kubevirt
resources:
  '*':
    limits:
      memory: 4Gi
    requests:
      cpu: 100m
      memory: 200Mi
tag_specification:
  name: "4.2"
  namespace: ocp
tests:
- as: "kubevirt-e2e-test"
  commands: |

    set -euo pipefail

    echo "fetching oc and kubectl for deployment"
    curl -L -O -o openshift-origin-client-tools-v3.11.0-0cbc58b-linux-64bit.tar.gz https://github.com/openshift/origin/releases/download/v3.11.0/openshift-origin-client-tools-v3.11.0-0cbc58b-linux-64bit.tar.gz
    tar zxvf openshift-origin-client-tools-v3.11.0-0cbc58b-linux-64bit.tar.gz
    export PATH=$(pwd)/openshift-origin-client-tools-v3.11.0-0cbc58b-linux-64bit:$PATH
    which kubectl
    which oc

    export DOCKER_PREFIX='dhiller'
    export DOCKER_TAG="latest"
    export KUBEVIRT_PROVIDER=external

    export GIMME_GO_VERSION=1.12.8
    export GOPATH="/go"
    export GOBIN="/usr/bin"
    source /etc/profile.d/gimme.sh

    echo "creating manifests"
    set +e # we set errors off because we don't care about the diff :-P
    bash -x ./hack/build-manifests.sh
    set -e

    echo "deploying"
    bash -x ./hack/cluster-deploy.sh

    echo "testing"
    go get -u github.com/onsi/ginkgo/ginkgo
    bash -x ./hack/build-func-tests.sh
    bash -x ./hack/functests.sh

  openshift_installer_src:
    cluster_profile: gcp
