base_images:
  cli:
    name: "4.19"
    namespace: ocp
    tag: cli
build_root:
  image_stream_tag:
    name: release
    namespace: openshift
    tag: golang-1.23
images:
- dockerfile_literal: |
    FROM cli

    # Install openssh-clients and jq
    RUN PACKAGES="openssh-clients jq" && \
        (dnf install --setopt=tsflags=nodocs -y $PACKAGES || microdnf install -y $PACKAGES) && \
        (dnf clean all || microdnf clean all) && rm -rf /var/cache/dnf/*

    # Install YQ (Direct download)
    RUN YQ_PATH="/usr/local/bin/yq" && \
        curl -L https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -o "${YQ_PATH}" && \
        chmod +x "${YQ_PATH}"

    # Verification
    RUN jq --version && yq --version && ssh -V
  from: cli
  to: cli-plus-tools
releases:
  latest:
    candidate:
      product: ocp
      stream: nightly
      version: "4.19"
resources:
  '*':
    limits:
      memory: 4Gi
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- as: krkn-hub-tests
  cron: 0 15 * * *
  steps:
    cluster_profile: aws-lp-chaos
    env:
      KCFG_SRC_SFX: weiliu--chaos-test
      VM_REPLICA_COUNT: "3"
      VM_WAIT_TIMEOUT: 30m
    test:
    - ref: redhat-lp-chaos-lp-cnv-vm-create
    - chain: redhat-chaos-krkn-hub-tests
    - ref: redhat-lp-chaos-lp-cnv-vm-check
    workflow: external-cluster
  timeout: 5h0m0s
- as: krkn-hub-node-tests
  cron: 0 17 * * *
  steps:
    cluster_profile: aws-lp-chaos
    env:
      KCFG_SRC_SFX: weiliu--chaos-test
    test:
    - ref: redhat-lp-chaos-lp-cnv-vm-create
    - chain: redhat-chaos-krkn-hub-node-tests
    - ref: redhat-lp-chaos-lp-cnv-vm-check
    workflow: external-cluster
  timeout: 5h0m0s
- as: kubevirt-outage
  cron: 0 19 * * *
  steps:
    cluster_profile: aws-lp-chaos
    env:
      KCFG_SRC_SFX: weiliu--chaos-test
      TARGET_NAMESPACE: cnv-chaos-test-ns
    test:
    - ref: redhat-lp-chaos-lp-cnv-vm-create
    - ref: redhat-chaos-kubevirt-outage
    - ref: redhat-lp-chaos-lp-cnv-vm-check
    workflow: external-cluster
  timeout: 5h0m0s
- as: aws-chaos-syn-flood
  cron: 0 21 * * *
  steps:
    cluster_profile: aws-lp-chaos
    env:
      KCFG_SRC_SFX: weiliu--chaos-test
    test:
    - ref: redhat-lp-chaos-lp-cnv-vm-create
    - ref: redhat-chaos-syn-flood
    - ref: redhat-lp-chaos-lp-cnv-vm-check
    workflow: external-cluster
  timeout: 5h0m0s
zz_generated_metadata:
  branch: main
  org: redhat-chaos
  repo: lp-chaos
  variant: ocp4.19-nightly--cnv-4.19-stable--aws
