base_images:
  cli:
    name: "4.19"
    namespace: ocp
    tag: cli
build_root:
  image_stream_tag:
    name: release
    namespace: openshift
    tag: golang-1.23
images:
- dockerfile_literal: |
    FROM cli
    RUN set -exo pipefail && \
        # Install openssh-clients and jq
        declare pkgs='openssh-clients jq' && \
        if command -v dnf 1> /dev/null; then \
            dnf install --setopt tsflags=nodocs -y ${pkgs} && \
            dnf clean all; \
        else \
            microdnf install -y ${pkgs} && \
            microdnf clean all; \
        fi && \
        rm -rf /var/cache/dnf/* && \
        # Install yq
        wget -qO - 'https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64.tar.gz' | \
            tar zvx -C /usr/local/bin/ --transform 's|^\./yq_linux_amd64$|yq|' ./yq_linux_amd64
  from: cli
  to: cli-plus-tools
releases:
  latest:
    candidate:
      product: ocp
      stream: nightly
      version: "4.19"
resources:
  '*':
    limits:
      memory: 4Gi
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- as: krkn-hub-tests
  cron: 0 22 * * 0
  steps:
    cluster_profile: aws-lp-chaos
    env:
      BASE_DOMAIN: chaos.lp.devcluster.openshift.com
      COMPUTE_NODE_TYPE: m5.metal
      ENABLE_ES: "false"
      LPC_LP_CNV__VM__REPLICA_COUNT: "3"
      LPC_LP_CNV__VM__WAIT_TIMEOUT: 30m
      TELEMETRY_GROUP: ocp4.19-nightly--cnv-4.19-stable--aws
    test:
    - ref: redhat-lp-chaos-lp-cnv-vm-create
    - ref: redhat-chaos-pod-scenarios-etcd-disruption
    - ref: redhat-chaos-time-scenarios
    - chain: redhat-chaos-krkn-hub-console-tests
    - chain: redhat-chaos-krkn-hub-ovn-disruption
    - chain: redhat-chaos-krkn-hub-prometheus-tests
    - chain: redhat-chaos-krkn-hub-random-system-pods-disruption
    - ref: redhat-chaos-pod-scenarios-kube-apiserver-disruption
    - ref: redhat-lp-chaos-lp-cnv-vm-check
    - ref: redhat-lp-chaos-lp-cnv-vm-clean
    workflow: redhat-lp-chaos-ocp-installer-aws-cnv
  timeout: 6h0m0s
- as: krkn-hub-node-tests
  cron: 0 8 * * 1
  steps:
    cluster_profile: aws-lp-chaos
    env:
      BASE_DOMAIN: chaos.lp.devcluster.openshift.com
      COMPUTE_NODE_TYPE: m5.metal
      ENABLE_ES: "false"
      LPC_LP_CNV__VM__WAIT_TIMEOUT: 30m
      TELEMETRY_GROUP: ocp4.19-nightly--cnv-4.19-stable--aws
    test:
    - ref: redhat-lp-chaos-lp-cnv-vm-create
    - ref: redhat-chaos-zone-outage
    - chain: redhat-chaos-krkn-hub-control-plane-tests
    - chain: redhat-chaos-hog-scenarios
    - ref: redhat-lp-chaos-lp-cnv-vm-check
    - ref: redhat-lp-chaos-lp-cnv-vm-clean
    workflow: redhat-lp-chaos-ocp-installer-aws-cnv
  timeout: 8h0m0s
- as: kubevirt-outage
  cron: 0 4 * * 1
  steps:
    cluster_profile: aws-lp-chaos
    env:
      BASE_DOMAIN: chaos.lp.devcluster.openshift.com
      COMPUTE_NODE_TYPE: m5.metal
      ENABLE_ES: "false"
      LPC_LP_CNV__VM__WAIT_TIMEOUT: 30m
      TARGET_NAMESPACE: cnv-chaos-test-ns
      TELEMETRY_GROUP: ocp4.19-nightly--cnv-4.19-stable--aws
    test:
    - ref: redhat-lp-chaos-lp-cnv-vm-create
    - ref: redhat-chaos-kubevirt-outage
    - ref: redhat-lp-chaos-lp-cnv-vm-check
    - ref: redhat-lp-chaos-lp-cnv-vm-clean
    workflow: redhat-lp-chaos-ocp-installer-aws-cnv
  timeout: 4h0m0s
zz_generated_metadata:
  branch: main
  org: redhat-chaos
  repo: lp-chaos
  variant: ocp4.19-nightly--cnv-4.19-stable--aws
