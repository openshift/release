base_images:
  f30:
    cluster: https://api.ci.openshift.org
    name: fedora
    namespace: rhcos
    tag: "30"

build_root:
  image_stream_tag:
    cluster: https://api.ci.openshift.org
    name: release
    namespace: openshift
    tag: golang-1.10

images:
- from: f30
  dockerfile_path: ci/prow/Dockerfile
  to: ostree-ci

resources:
  '*':
    limits:
      memory: 6Gi
    requests:
      cpu: 1000m
      memory: 1Gi
  unit:
    limits:
      memory: 9Gi
    requests:
      cpu: '3'
      memory: 5Gi

# TODO move all these scripts to ci/prow
tests:
- as: sanity
  commands: sudo make install && ostree --version
  container:
    from: ostree-ci
# - as: minimal
#   commands: |
#     export CONFIGOPTS='--without-curl --without-soup --disable-gtk-doc --disable-man --disable-rust --without-libarchive --without-selinux --without-smack --without-openssl --without-avahi --without-libmount --disable-rofiles-fuse --disable-experimental-api'
#     make clean
#     ci/build.sh
#   container:
#     from: ostree-ci
# - as: primary
#   commands: |
#     export CFLAGS='-fsanitize=undefined -fsanitize-undefined-trap-on-error -fsanitize=address -O2 -Wp,-D_FORTIFY_SOURCE=2'
#     export GI_SCANNERFLAGS='--warn-error'
#     export ASAN_OPTIONS='detect_leaks=0'
#     export CONFIGOPTS='--with-curl --with-openssl'
#     make clean
#     ci/ci-commitmessage-submodules.sh
#     ci/build-check.sh
#     ci/ci-release-build.sh
#     make dist-then-build
#   container:
#     from: ostree-ci
# - as: rust
#   commands: |
#     export CONFIGOPTS='--enable-rust'
#     make clean
#     ci/build.sh
#     make check TESTS=tests/test-rollsum
#   container:
#     from: ostree-ci
# - as: gnutls
#   commands: |
#     export CONFIGOPTS='--with-crypto=gnutls'
#     make clean
#     ci/build.sh
#     make check TESTS=tests/test-basic.sh
#   container:
#     from: ostree-ci
# - as: libsoup
#   commands: |
#     export CONFIGOPTS='--without-curl --without-openssl --with-soup'
#     make clean
#     ci/build-check.sh
#   container:
#     from: ostree-ci
# - as: introspection
#   commands: |
#     export INSTALLED_TESTS_PATTERN='libostree/test-sizes.js libostree/test-sysroot.js libostree/test-core.js'
#     make clean
#     ci/build-check.sh
#   container:
#     from: ostree-ci
