base_images:
  ansible-operator:
    cluster: https://api.ci.openshift.org
    name: "4.6"
    namespace: ocp
    tag: ansible-operator
  base:
    cluster: https://api.ci.openshift.org
    name: "4.6"
    namespace: ocp
    tag: base
build_root:
  project_image:
    context_dir: .
    dockerfile_path: Dockerfile.src
images:
- dockerfile_path: Dockerfile.reporting-operator.okd
  from: base
  to: metering-reporting-operator
- dockerfile_path: Dockerfile.metering-ansible-operator
  from: ansible-operator
  to: metering-ansible-operator
- dockerfile_path: bundle.Dockerfile
  context_dir: manifests/deploy/openshift/olm/bundle
  operator_manifests: "4.6"
  to: metering-reporting-operator-bundle
  substitute:
  - pullspec: "quay.io/openshift/origin-ghostunnel:4.6"
    with: "stable:ghostunnel"
  - pullspec: "quay.io/openshift/origin-metering-ansible-operator:4.6"
    with: metering-ansible-operator
  - pullspec: "quay.io/openshift/origin-metering-hadoop:4.6"
    with: "stable:metering-hadoop"
  - pullspec: "quay.io/openshift/origin-metering-hive:4.6"
    with: "stable:metering-hive"
  - pullspec: "quay.io/openshift/origin-metering-presto:4.6"
    with: "stable:metering-presto"
  - pullspec: "quay.io/openshift/origin-metering-reporting-operator:4.6"
    with: metering-reporting-operator
- operator_index:
  - metering-reporting-operator-bundle
  as: metering-reporting-operator-index
releases:
  latest:
    release:
      channel: stable
      version: "4.6"
resources:
  '*':
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- artifact_dir: /tmp/artifacts
  as: unit
  commands: make unit TEST_OUTPUT_DIR=/tmp/artifacts
  container:
    from: src
- as: e2e
  steps:
    cluster_profile: aws
    test:
    - as: this-needs-a-name
      from: src
      commands: |
        set -x
        kubectl -n openshift-machine-api get machinesets -o name | grep worker | cut -d/ -f2 | xargs -I{} kubectl -n openshift-machine-api scale machineset {} --replicas 3
        TEST_OUTPUT_PATH=/tmp/artifacts/metering_test_output/e2e EXTRA_TEST_FLAGS="-run TestCIOperatorInstallation" make e2e
      resources:
        requests:
          cpu: 1000m
          memory: 100Mi
    workflow: optional-operators-aws
  env:
    OO_PACKAGE: metering-ocp
    OO_CHANNEL: "4.6"
zz_generated_metadata:
  branch: master
  org: kube-reporting
  repo: metering-operator
  variant: optional
