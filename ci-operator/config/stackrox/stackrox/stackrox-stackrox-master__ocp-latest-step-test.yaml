releases:
  latest:
    release:
      product: ocp
      channel: stable
      version: "4.15"
resources:
  '*':
    requests:
      cpu: "8"
      memory: 8000Mi
tests:
- as: e2e-hypershift
  steps:
    cluster_profile: aws-2
    test:
    - as: claim
      commands: oc get node
      from: stable:cli
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
    - as: list
      commands: oc get packagemanifests | grep security
      from: stable:cli
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
    - as: install
      ref: install-operators
      from: stable:cli
      env:
      - name: OPERATORS
        default: |
          [
            {'name': 'advanced-cluster-security', 'source': 'redhat-operators', 'channel': '!default', 'install_namespace': 'stackrox'}
          ]
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
    - as: central
      commands: |
        curl https://raw.githubusercontent.com/stackrox/stackrox/master/operator/tests/common/central-cr.yaml \
          | kubectl apply -n stackrox -f -
        kubectl -n stackrox exec deploy/central -- \
          roxctl central init-bundles generate my-test-bundle --insecure-skip-tls-verify --password letmein --output-secrets - \
          | kubectl -n stackrox apply -f -
        kubectl -n stackrox rollout status deploy/central --timeout=10m
        kubectl get -n stackrox centrals.platform.stackrox.io
        kubectl get -n stackrox centrals.platform.stackrox.io stackrox-central-services --output=json
      from: stable:cli
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
    - as: securedcluster
      commands: |
        curl https://raw.githubusercontent.com/stackrox/stackrox/master/operator/tests/common/secured-cluster-cr.yaml \
          | kubectl apply -n stackrox -f -
        for I in {1..10} do
          kubectl get -n stackrox securedclusters.platform.stackrox.io || true
          sleep 30
        done
        kubectl get -n stackrox securedclusters.platform.stackrox.io stackrox-secured-cluster-services --output=json
      from: stable:cli
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
    - as: getpodstatus
      commands: oc get pods -n "stackrox"
      from: stable:cli
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
    workflow: hypershift-hostedcluster-workflow
zz_generated_metadata:
  branch: master
  org: stackrox
  repo: stackrox
  variant: ocp-latest-step-test
