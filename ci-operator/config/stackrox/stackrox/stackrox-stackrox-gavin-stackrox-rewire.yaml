build_root:
  image_stream_tag:
    name: release
    namespace: openshift
    tag: golang-1.17
images:
- build_args:
  - name: ROX_PRODUCT_BRANDING
    value: RHACS_BRANDING
  dockerfile_path: .openshift-ci/build/Dockerfile.build-main-and-bundle
  to: main-bundle
- build_args:
  - name: ROX_PRODUCT_BRANDING
    value: RHACS_BRANDING
  dockerfile_path: Dockerfile.gen
  inputs:
    main-bundle:
      paths:
      - destination_dir: .
        source_path: /go/src/github.com/stackrox/stackrox/image/rhel/.
  to: main
- dockerfile_literal: |-
    FROM quay.io/stackrox-io/apollo-ci:stackrox-build-0.3.44-2-ga2b83e99da
    WORKDIR $GOPATH/src/github.com/stackrox/stackrox
    COPY . .
  to: build-plus-src
- dockerfile_literal: |-
    FROM quay.io/stackrox-io/apollo-ci:stackrox-build-0.3.44-2-ga2b83e99da
    WORKDIR $GOPATH/src/github.com/stackrox/stackrox
  to: build-plus-src-2
- dockerfile_literal: |-
    FROM quay.io/stackrox-io/apollo-ci:stackrox-test-0.3.44-2-ga2b83e99da
    WORKDIR $GOPATH/src/github.com/stackrox/stackrox
    COPY . .
  to: test-plus-src
- dockerfile_literal: |-
    FROM quay.io/stackrox-io/apollo-ci:stackrox-test-0.3.44-2-ga2b83e99da
    WORKDIR $GOPATH/src/github.com/stackrox/stackrox
    COPY . .
    RUN .openshift-ci/dispatch.sh test-binary-build-commands
  to: test-plus-bin
resources:
  '*':
    requests:
      cpu: 2000m
      memory: 8000Mi
tests:
- as: go-unit-tests
  commands: .openshift-ci/dispatch.sh go-unit-tests
  container:
    clone: false
    from: build-plus-src
- as: style
  commands: .openshift-ci/dispatch.sh style-checks
  container:
    clone: false
    from: test-plus-src
- as: gke-qa-e2e-tests
  commands: .openshift-ci/dispatch.sh gke-qa-e2e-tests
  container:
    clone: false
    from: test-plus-bin
  optional: true
  secrets:
  - mount_path: /tmp/vault/stackrox-stackrox-e2e-tests
    name: stackrox-stackrox-e2e-tests
  timeout: 5h0m0s
zz_generated_metadata:
  branch: gavin-stackrox-rewire
  org: stackrox
  repo: stackrox
