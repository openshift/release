base_images:
  centos:
    name: centos
    namespace: origin
    tag: stream8
  collector-test:
    name: collector-test
    namespace: stackrox
    tag: latest
build_root:
  image_stream_tag:
    name: release
    namespace: openshift
    tag: golang-1.17
images:
- dockerfile_literal: |-
    FROM centos:8
    RUN yum install -y git
    RUN git clone --recurse-submodules https://github.com/stackrox/collector.git
    RUN yum makecache
    RUN yum install gcc gcc-c++ -y
    RUN yum install yum-utils -y
    RUN yum-config-manager --enable extras
    RUN yum makecache
    RUN yum install clang -y
    RUN yum install git-clang-format -y
    RUN clang_version="$(yum --showduplicates list git-clang-format | grep 13.0.1-1 | tail -1)"; \
        yum --showducplicates list git-clang-format; \
        echo "clang_version= $clang_version"
                                                                                               #yum install git-clang-format
  from: centos
  to: test-image
- dockerfile_literal: |-
    FROM centos:8
    RUN yum install -y git go make
    RUN git clone --recurse-submodules https://github.com/stackrox/collector.git
    RUN yum install -y epel-release
    RUN yum install snapd -y
    RUN ln -s /var/lib/snapd/snap /snap
    RUN snap install shfmt
    RUN go install mvdan.cc/sh/v3/cmd/shfmt@v3.4.1
  from: centos
  to: shfmt-image
resources:
  '*':
    limits:
      memory: 4Gi
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- as: lint-via-clang-format
  commands: make -C collector/collector check
  container:
    from: collector-test
- as: lint-via-shfmt
  commands: go install mvdan.cc/sh/v3/cmd/shfmt@v3.4.1; make -C collector shfmt-check
  container:
    from: collector-test
zz_generated_metadata:
  branch: master
  org: stackrox
  repo: collector
