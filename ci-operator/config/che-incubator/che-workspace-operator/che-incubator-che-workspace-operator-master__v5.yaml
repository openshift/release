build_root:
  image_stream_tag:
    name: release
    namespace: openshift
    tag: golang-1.13
resources:
  '*':
    requests:
      cpu: 200m
      memory: 6Gi
tag_specification:
  name: "4.5"
  namespace: ocp
tests:
- as: openshift-web-terminal-e2e
  commands: |
    # Update CRDs
    # oc apply -f https://raw.githubusercontent.com/devfile/kubernetes-api/master/deploy/crds/workspace.devfile.io_devworkspacetemplates_crd.yaml
    # oc apply -f https://raw.githubusercontent.com/devfile/kubernetes-api/master/deploy/crds/workspace.devfile.io_devworkspaces_crd.yaml
    mkdir -p $GOPATH/bin
    export PATH="$PATH:$(pwd):$GOPATH/bin"
    RELEASE_VERSION=v0.18.1
    curl -LO https://github.com/operator-framework/operator-sdk/releases/download/${RELEASE_VERSION}/operator-sdk-${RELEASE_VERSION}-x86_64-linux-gnu
    chmod +x operator-sdk-${RELEASE_VERSION}-x86_64-linux-gnu && cp operator-sdk-${RELEASE_VERSION}-x86_64-linux-gnu $GOPATH/bin/operator-sdk && rm operator-sdk-${RELEASE_VERSION}-x86_64-linux-gnu
    operator-sdk version
    export USER_ID=$(id -u)
    export GROUP_ID=$(id -g)

    if ! whoami >/dev/null 2>&1; then
      echo "${USER_NAME:-user}:x:${USER_ID}:0:${USER_NAME:-user} user:${HOME}:/bin/sh" >> /etc/passwd
    fi
    export GIT_COMMITTER_NAME="Flavius Lacatusu"
    export GIT_COMMITTER_EMAIL="flacatus@redhat.com"
    make update_devworkspace_crds
    go mod tidy
    go mod vendor
    # Output of e2e binary
    export OUT_FILE=bin/workspace-controller-e2e

    # Compile e2e binary tests
    CGO_ENABLED=0 go test -v -c -o ${OUT_FILE} ./test/e2e/cmd/workspaces_test.go

    # Launch tests
    ./bin/workspace-controller-e2e
  openshift_installer_src:
    cluster_profile: aws
zz_generated_metadata:
  branch: master
  org: che-incubator
  repo: che-workspace-operator
  variant: v5
