build_root:
  project_image:
    dockerfile_literal: |-
      FROM registry.access.redhat.com/ubi9/python-312

      USER root

      ENV GO_VERSION=1.24.3
      ENV PATH="/usr/local/go/bin:$PATH"

      RUN dnf install -y tar gzip git gpgme gpgme-devel pkgconfig make && \
          curl -Ls https://golang.org/dl/go${GO_VERSION}.linux-amd64.tar.gz | tar -C /usr/local -xz && \
          python -m pip install --no-cache-dir uv && \
          dnf clean all && rm -rf /var/cache/dnf /tmp/*

      # Prow expects to be able to check out a repo under /go
      RUN mkdir -p /go && \
      chown 1001:1001 /go && \
      chmod 755 /go

      WORKDIR /go
      USER 1001:1001
images:
- dockerfile_path: Containerfile.oadp
  to: rebasebot-oadp
resources:
  '*':
    limits:
      memory: 4Gi
    requests:
      cpu: 100m
      memory: 200Mi
test_binary_build_commands: make deps
tests:
- as: migtools-udistribution-main
  cron: 0 1 * * Mon
  steps:
    test:
    - as: migtools-udistribution-main
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/migtools_udistribution_main.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: migtools-kopia-oadp-dev
  cron: 0 1 * * Mon,Wed,Fri
  steps:
    test:
    - as: migtools-kopia-oadp-dev
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/migtools_kopia_oadp-dev.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: migtools-kopia-oadp-1-5
  cron: 0 1 * * Mon
  steps:
    test:
    - as: migtools-kopia-oadp-1-5
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/migtools_kopia_oadp-1.5.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: migtools-kubevirt-velero-plugin-main
  cron: 0 1 * * Mon
  steps:
    test:
    - as: migtools-kubevirt-velero-plugin-main
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/migtools_kubevirt_velero_plugin_main.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: openshift-velero-oadp-dev
  cron: 0 2 * * Tue,Thu,Sat
  steps:
    test:
    - as: openshift-velero-oadp-dev
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/openshift_velero_oadp-dev.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: openshift-velero-oadp-1-5
  cron: 0 2 * * Tue
  steps:
    test:
    - as: openshift-velero-oadp-1-5
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/openshift_velero_oadp-1.5.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: openshift-oadp-operator-oadp-dev
  cron: 0 3 * * Wed,Fri,Sun
  steps:
    test:
    - as: openshift-oadp-operator-oadp-dev
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/openshift_oadp-operator_oadp-dev.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: openshift-oadp-operator-oadp-1-5
  cron: 0 3 * * Wed
  steps:
    test:
    - as: openshift-oadp-operator-oadp-1-5
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/openshift_oadp-operator_oadp-1.5.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: openshift-velero-plugin-for-aws-oadp-dev
  cron: 0 3 * * Wed,Fri,Sun
  steps:
    test:
    - as: openshift-velero-plugin-for-aws-oadp-dev
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/openshift_velero_plugin_for_aws_oadp-dev.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: openshift-velero-plugin-for-microsoft-azure-oadp-dev
  cron: 0 3 * * Wed,Fri,Sun
  steps:
    test:
    - as: openshift-velero-plugin-for-microsoft-azure-oadp-dev
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/openshift_velero_plugin_for_microsoft_azure_oadp-dev.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: openshift-velero-plugin-for-gcp-oadp-dev
  cron: 0 3 * * Wed,Fri,Sun
  steps:
    test:
    - as: openshift-velero-plugin-for-gcp-oadp-dev
      commands: |
        source <(curl --silent https://raw.githubusercontent.com/oadp-rebasebot/oadp-rebase/refs/heads/oadp-dev/rebase-configs/openshift_velero_plugin_for_gcp_oadp-dev.env.sh)
        rebasebot --source "$SOURCE_UPSTREAM_REPO" \
                  --dest "$DESTINATION_DOWNSTREAM_REPO" \
                  --rebase "$REBASE_REPO" \
                  --github-app-id 1810299 \
                  --github-cloner-id 1810272 \
                  --github-app-key /secrets/oadp-rebase-bot/oadp-rebasebot-app-key \
                  --github-cloner-key /secrets/oadp-rebase-bot/oadp-rebasebot-cloner-key \
                  --git-username oadp-team-rebase-bot \
                  --git-email oadp-maintainers@redhat.com \
                  ${HOOK_SCRIPTS:+$HOOK_SCRIPTS} \
                  ${EXTRA_REBASEBOT_ARGS:+$EXTRA_REBASEBOT_ARGS}
      credentials:
      - collection: ""
        mount_path: /secrets/oadp-rebase-bot
        name: oadp-team-rebasebot-credentials
        namespace: test-credentials
      from: rebasebot-oadp
      resources:
        limits:
          memory: 4Gi
        requests:
          cpu: 100m
          memory: 200Mi
- as: unit
  commands: make deps && make unittests
  container:
    from: src
- as: lint
  commands: make deps && make lint
  container:
    from: src
zz_generated_metadata:
  branch: main
  org: migtools
  repo: rebasebot
