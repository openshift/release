base_images:
  claude-ai-helpers:
    name: claude-ai-helpers
    namespace: ci
    tag: latest
  upi-installer:
    name: "4.21"
    namespace: ocp
    tag: upi-installer
  vsphere-ci-python:
    name: vsphere-python
    namespace: ci
    tag: latest
releases:
  initial:
    candidate:
      product: ocp
      relative: 1
      stream: ci
      version: "4.21"
  latest:
    candidate:
      product: ocp
      stream: ci
      version: "4.21"
resources:
  '*':
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- as: e2e-aws-ovn-techpreview
  interval: 168h
  steps:
    cluster_profile: aws
    env:
      FEATURE_SET: TechPreviewNoUpgrade
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-aws-ovn
- as: e2e-aws-ovn-no-capabilities
  interval: 168h
  steps:
    cluster_profile: aws-2
    env:
      ADDITIONAL_ENABLED_CAPABILITIES: MachineAPI CloudCredential CloudControllerManager
        Ingress
      BASELINE_CAPABILITY_SET: None
      PERSISTENT_MONITORING: "false"
      TEST_SKIPS: check registry.redhat.io is available and samples operator can import
        sample imagestreams
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-aws-ovn
- as: e2e-aws-ovn
  interval: 168h
  steps:
    cluster_profile: aws-2
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-aws-ovn
- as: e2e-aws-ovn-proxy
  interval: 168h
  steps:
    cluster_profile: aws-5
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-aws-proxy
- as: e2e-aws-ovn-serial
  interval: 168h
  steps:
    cluster_profile: aws-5
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-aws-ovn-serial
- as: e2e-aws-ovn-techpreview-serial
  interval: 168h
  shard_count: 3
  steps:
    cluster_profile: aws-5
    env:
      FEATURE_SET: TechPreviewNoUpgrade
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-aws-ovn-serial
- as: e2e-aws-ovn-upgrade
  interval: 168h
  steps:
    cluster_profile: aws-5
    env:
      FAIL_ON_CORE_DUMP: "true"
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-aws-ovn
- as: e2e-aws-ovn-techpreview-upgrade
  interval: 168h
  steps:
    cluster_profile: aws-5
    env:
      FAIL_ON_CORE_DUMP: "true"
      FEATURE_SET: TechPreviewNoUpgrade
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-aws-ovn
- as: e2e-aws-ovn-upgrade-out-of-change
  interval: 168h
  steps:
    cluster_profile: aws-5
    dependencies:
      OPENSHIFT_INSTALL_RELEASE_IMAGE_OVERRIDE: release:latest
      OPENSHIFT_UPGRADE_RELEASE_IMAGE_OVERRIDE: release:initial
    env:
      FAIL_ON_CORE_DUMP: "true"
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-aws-ovn
- as: e2e-aws-cilium
  interval: 168h
  steps:
    cluster_profile: aws-2
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-aws-cilium
- as: e2e-azure-ovn-techpreview
  interval: 168h
  steps:
    cluster_profile: azure4
    env:
      FEATURE_SET: TechPreviewNoUpgrade
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-azure-ovn
- as: e2e-azure-ovn-serial
  interval: 168h
  steps:
    cluster_profile: azure4
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-azure-serial
- as: e2e-azure-ovn-techpreview-serial
  interval: 168h
  steps:
    cluster_profile: azure4
    env:
      FEATURE_SET: TechPreviewNoUpgrade
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-azure-serial
- as: e2e-azure-ovn-upgrade
  interval: 168h
  steps:
    cluster_profile: azure4
    env:
      FAIL_ON_CORE_DUMP: "true"
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-azure-ovn
- as: e2e-azure-ovn-techpreview-upgrade
  interval: 168h
  steps:
    cluster_profile: azure4
    env:
      FAIL_ON_CORE_DUMP: "true"
      FEATURE_SET: TechPreviewNoUpgrade
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-azure-ovn
- as: e2e-azure-ovn-upgrade-out-of-change
  interval: 168h
  steps:
    cluster_profile: azure4
    dependencies:
      OPENSHIFT_INSTALL_RELEASE_IMAGE_OVERRIDE: release:latest
      OPENSHIFT_UPGRADE_RELEASE_IMAGE_OVERRIDE: release:initial
    env:
      FAIL_ON_CORE_DUMP: "true"
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-azure-ovn
- as: e2e-azure-cilium
  interval: 168h
  steps:
    cluster_profile: azure4
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-azure-cilium
- as: e2e-azure-ovn
  interval: 168h
  steps:
    cluster_profile: azure4
    env:
      FAIL_ON_CORE_DUMP: "true"
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-azure-ovn
- as: e2e-gcp-ovn-techpreview
  interval: 168h
  steps:
    cluster_profile: gcp-3
    env:
      FEATURE_SET: TechPreviewNoUpgrade
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-gcp-ovn
- as: e2e-gcp-ovn
  interval: 168h
  steps:
    cluster_profile: gcp-openshift-gce-devel-ci-2
    env:
      FAIL_ON_CORE_DUMP: "true"
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-gcp-ovn
- as: e2e-gcp-ovn-xpn
  interval: 168h
  steps:
    cluster_profile: gcp
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-gcp-xpn
- as: e2e-gcp-ovn-mount-ns-hiding
  interval: 168h
  steps:
    cluster_profile: gcp-3
    env:
      FAIL_ON_CORE_DUMP: "true"
      MOUNT_NS_HIDING_ENABLED: "true"
      MOUNT_NS_HIDING_LOG: "2"
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-gcp-mount-ns-hiding
- as: e2e-gcp-ovn-techpreview-serial
  interval: 168h
  steps:
    cluster_profile: gcp-3
    env:
      FEATURE_SET: TechPreviewNoUpgrade
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-gcp-serial
- as: e2e-gcp-ovn-usernamespace
  cron: '@daily'
  steps:
    cluster_profile: gcp-3
    env:
      FEATURE_SET: TechPreviewNoUpgrade
      TEST_SUITE: openshift/usernamespace
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-gcp
- as: e2e-gcp-ovn-upgrade
  interval: 168h
  steps:
    cluster_profile: gcp-3
    env:
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-gcp-ovn
- as: e2e-gcp-ovn-techpreview-upgrade
  interval: 168h
  steps:
    cluster_profile: gcp-3
    env:
      FEATURE_SET: TechPreviewNoUpgrade
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-gcp-ovn
- as: e2e-gcp-ovn-upgrade-out-of-change
  interval: 168h
  steps:
    cluster_profile: gcp-3
    dependencies:
      OPENSHIFT_INSTALL_RELEASE_IMAGE_OVERRIDE: release:latest
      OPENSHIFT_UPGRADE_RELEASE_IMAGE_OVERRIDE: release:initial
    env:
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-gcp-ovn
- as: e2e-gcp-cilium
  interval: 168h
  steps:
    cluster_profile: gcp-3
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-gcp-cilium
- as: e2e-gcp-secureboot
  interval: 168h
  steps:
    cluster_profile: gcp-openshift-gce-devel-ci-2
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-e2e-gcp-secureboot
- as: e2e-aws-upgrade-ovn-single-node
  interval: 168h
  steps:
    cluster_profile: aws-2
    env:
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-aws-single-node
- as: e2e-vsphere-ovn-upgrade
  cron: 46 16 * * 3
  steps:
    cluster_profile: vsphere-elastic
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-vsphere
- as: e2e-azure-runc-upgrade
  cron: '@daily'
  steps:
    cluster_profile: azure4
    env:
      FAIL_ON_CORE_DUMP: "true"
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-azure-runc
- as: e2e-gcp-runc-upgrade
  cron: '@daily'
  steps:
    cluster_profile: gcp-openshift-gce-devel-ci-2
    env:
      FAIL_ON_CORE_DUMP: "true"
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-gcp-runc
- as: e2e-aws-runc-upgrade
  cron: '@daily'
  steps:
    cluster_profile: aws-5
    env:
      FAIL_ON_CORE_DUMP: "true"
      TEST_TYPE: upgrade-conformance
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-aws-runc
- as: e2e-vsphere-runc-upgrade
  cron: 9 7 * * *
  steps:
    cluster_profile: vsphere-elastic
    observers:
      enable:
      - observers-resource-watch
    workflow: openshift-upgrade-vsphere-runc
- as: claude-post-analysis-test
  interval: 24h
  steps:
    post:
    - ref: claude-post-job-analysis
    test:
    - as: generate-dummy-artifacts
      commands: |
        #!/bin/bash
        set -o nounset
        set -o errexit
        set -o pipefail

        echo "Generating dummy artifacts for testing claude-post-job-analysis..."

        # Create a dummy test step directory structure
        mkdir -p "${ARTIFACT_DIR}/e2e-test/artifacts"

        # Create a failed finished.json
        cat > "${ARTIFACT_DIR}/e2e-test/finished.json" << 'EOF'
        {
          "timestamp": 1733760000,
          "passed": false,
          "result": "FAILURE"
        }
        EOF

        # Create a dummy JUnit XML with some failures
        cat > "${ARTIFACT_DIR}/e2e-test/artifacts/junit_e2e.xml" << 'EOF'
        <?xml version="1.0" encoding="UTF-8"?>
        <testsuites>
          <testsuite name="e2e-tests" tests="10" failures="2" errors="0" skipped="1" time="300.5">
            <testcase name="test-pod-creation" classname="cluster" time="5.2">
              <system-out>Pod created successfully</system-out>
            </testcase>
            <testcase name="test-networking" classname="cluster" time="10.5">
              <failure message="Connection timeout" type="NetworkError">
                Expected connection to succeed but got timeout after 30s
                Error: dial tcp 10.0.0.1:443: i/o timeout
              </failure>
            </testcase>
            <testcase name="test-storage" classname="cluster" time="8.3">
              <system-out>Storage provisioned correctly</system-out>
            </testcase>
            <testcase name="test-authentication" classname="cluster" time="15.7">
              <failure message="Authentication failed" type="AuthError">
                Expected OAuth authentication to succeed but got 401 Unauthorized
                Error: unable to authenticate user
              </failure>
            </testcase>
            <testcase name="test-upgrade" classname="cluster" time="0">
              <skipped message="Skipped due to environment" />
            </testcase>
          </testsuite>
        </testsuites>
        EOF

        # Create some dummy log files
        mkdir -p "${ARTIFACT_DIR}/e2e-test/artifacts/pods"
        cat > "${ARTIFACT_DIR}/e2e-test/artifacts/pods/test-pod-1.log" << 'EOF'
        2025-12-09T10:00:00Z INFO Starting pod test-pod-1
        2025-12-09T10:00:05Z ERROR Failed to connect to API server
        2025-12-09T10:00:06Z ERROR Connection refused: dial tcp 10.0.0.1:6443: connection refused
        2025-12-09T10:00:10Z FATAL Pod failed to start
        EOF

        cat > "${ARTIFACT_DIR}/e2e-test/artifacts/e2e-test.log" << 'EOF'
        Running e2e tests...
        [INFO] Test suite: cluster networking
        [PASS] test-pod-creation
        [FAIL] test-networking: Connection timeout
        [PASS] test-storage
        [FAIL] test-authentication: Authentication failed
        [SKIP] test-upgrade
        Summary: 10 tests, 7 passed, 2 failed, 1 skipped
        EOF

        echo "Dummy artifacts created successfully"
        ls -laR "${ARTIFACT_DIR}"
      from: cli
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
zz_generated_metadata:
  branch: master
  org: openshift
  repo: release
  variant: ci-4.21
