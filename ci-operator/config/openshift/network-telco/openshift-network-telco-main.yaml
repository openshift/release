base_images:
  dev-scripts:
    name: test
    namespace: ocp-kni
    tag: dev-scripts
  tests:
    name: "4.22"
    namespace: ocp
    tag: tests
build_root:
  image_stream_tag:
    name: release
    namespace: openshift
    tag: golang-1.22
releases:
  latest:
    candidate:
      product: ocp
      stream: nightly
      version: "4.22"
resources:
  '*':
    limits:
      memory: 4Gi
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- as: metallb-e2e-metal-dualstack-konflux
  capabilities:
  - intranet
  steps:
    cluster_profile: equinix-ocp-metal
    env:
      DEVSCRIPTS_CONFIG: |
        IP_STACK=v4v6
        NETWORK_TYPE=OVNKubernetes
      KONFLUX_TARGET_OPERATORS: metallb
    post:
    - chain: baremetalds-ofcir-post
    pre:
    - chain: baremetalds-ofcir-pre
    test:
    - ref: deploy-konflux-operator
    - as: metallb-operator-e2e
      commands: |
        # Clone metallb-operator repository
        git clone --depth 1 https://github.com/openshift/metallb-operator.git /tmp/metallb-operator
        cd /tmp/metallb-operator

        # Wait for MetalLB operator to be ready
        echo "Waiting for MetalLB operator deployment..."
        oc wait --for condition=Available -n openshift-metallb-operator deployment metallb-operator-controller-manager --timeout=300s || true
        oc wait --for condition=Available -n openshift-metallb-operator deployment metallb-operator-webhook-server --timeout=300s || true

        # Run e2e tests
        echo "Running metallb-operator e2e tests..."
        make test-e2e
      from: tests
      resources:
        requests:
          cpu: 100m
          memory: 200Mi
zz_generated_metadata:
  branch: main
  org: openshift
  repo: network-telco
