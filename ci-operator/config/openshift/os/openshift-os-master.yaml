base_images:
  coreos_coreos-assembler_latest:
    name: coreos-assembler
    namespace: coreos
    tag: latest
build_root:
  image_stream_tag:
    name: fcos-buildroot
    namespace: coreos
    tag: testing-devel
images:
- dockerfile_path: ci/Dockerfile
  inputs:
    coreos_coreos-assembler_latest:
      as:
      - registry.svc.ci.openshift.org/coreos/coreos-assembler:latest
  to: build-test-qemu-img
- dockerfile_literal: |
    FROM registry.ci.openshift.org/coreos/build-test-qemu-img:latest
    RUN echo "in built-cosa" > /home/build/in-container
  from: build-test-qemu-img
  inputs:
    build-test-qemu-img:
      as:
      - registry.ci.openshift.org/coreos/build-test-qemu-img:latest
  to: built-cosa
- dockerfile_literal: |
    FROM registry.ci.openshift.org/coreos/built-cosa:latest
    RUN echo "in machine-os-oci-content" >> /home/build/in-container
  from: built-cosa
  inputs:
    built-cosa:
      as:
      - registry.ci.openshift.org/coreos/built-cosa:latest
  to: machine-os-oci-content
- dockerfile_literal: |
    FROM registry.ci.openshift.org/coreos/built-cosa:latest
    RUN echo "in machine-os-content" >> /home/build/in-container
  from: built-cosa
  inputs:
    built-cosa:
      as:
      - registry.ci.openshift.org/coreos/built-cosa:latest
  to: machine-os-content
- dockerfile_literal: |
    FROM registry.ci.openshift.org/coreos/machine-os-content:latest AS builder
    FROM scratch
    COPY --from=builder /home/build/in-container /in-container
  from: machine-os-content
  inputs:
    machine-os-content:
      as:
      - registry.ci.openshift.org/coreos/machine-os-content:latest
  to: machine-os-content-scratch-image
promotion:
  excluded_images:
  - '*'
  name: "4.11"
  namespace: ocp
releases:
  initial:
    integration:
      name: "4.11"
      namespace: ocp
  latest:
    integration:
      include_built_images: true
      name: "4.11"
      namespace: ocp
resources:
  '*':
    requests:
      cpu: 1000m
      memory: 1Gi
  build-test-qemu:
    limits:
      devices.kubevirt.io/kvm: "1"
    requests:
      cpu: 1000m
      devices.kubevirt.io/kvm: "1"
      memory: 3Gi
tests:
- as: validate
  commands: ./ci/validate.sh
  container:
    from: src
  skip_if_only_changed: ^docs/|\.md$|^(?:.*/)?(?:\.gitignore|OWNERS|PROJECT|LICENSE)$
- as: build-test-qemu
  commands: /src/ci/build-test-qemu.sh
  container:
    from: build-test-qemu-img
  skip_if_only_changed: ^docs/|\.md$|^(?:.*/)?(?:\.gitignore|OWNERS|PROJECT|LICENSE)$
- as: built-cosa-test
  commands: cat /etc/in-container && cat /etc/os-release
  container:
    from: built-cosa
  skip_if_only_changed: ^docs/|\.md$|^(?:.*/)?(?:\.gitignore|OWNERS|PROJECT|LICENSE)$
- as: machine-os-oci-content-test
  commands: cat /etc/in-container && cat /etc/os-release
  container:
    from: machine-os-oci-content
  skip_if_only_changed: ^docs/|\.md$|^(?:.*/)?(?:\.gitignore|OWNERS|PROJECT|LICENSE)$
- as: machine-os-content-test
  commands: cat /etc/in-container && cat /etc/os-release
  container:
    from: machine-os-content
  skip_if_only_changed: ^docs/|\.md$|^(?:.*/)?(?:\.gitignore|OWNERS|PROJECT|LICENSE)$
zz_generated_metadata:
  branch: master
  org: openshift
  repo: os
