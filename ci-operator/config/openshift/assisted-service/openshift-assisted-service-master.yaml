base_images:
  openshift_release_golang-1.14:
    name: release
    namespace: openshift
    tag: golang-1.14
  ubi8:
    name: ubi
    namespace: ocp
    tag: "8"
build_root:
  image_stream_tag:
    name: release
    namespace: openshift
    tag: golang-1.13
images:
- dockerfile_path: Dockerfile
  from: src-dockerfile
  inputs:
    openshift_release_golang-1.14:
      as:
      - registry.svc.ci.openshift.org/openshift/release:golang-1.14
    src-dockerfile:
      paths:
      - destination_dir: .
        source_path: /opt/Dockerfile
    ubi8:
      as:
      - registry.access.redhat.com/ubi8/ubi-minimal:latest
  to: assisted-service
raw_steps:
- pipeline_image_cache_step:
    commands: "cat <<DOCKERFILE > /opt/Dockerfile\nFROM registry.access.redhat.com/ubi8/ubi-minimal:latest as certs\n\nFROM swaggerapi/swagger-codegen-cli:2.4.15 as swagger_py\nCOPY swagger.yaml .\nRUN mkdir /build && sed -i '/pattern:/d' swagger.yaml && \\\n        echo '{\"packageName\" : \"assisted_service_client\", \"packageVersion\": \"1.0.0\"}' > config.json && \\\n        java -jar /opt/swagger-codegen-cli/swagger-codegen-cli.jar generate --lang python --config config.json --output /build --input-spec swagger.yaml\n\nFROM quay.io/goswagger/swagger:v0.25.0 as swagger_go\nCOPY . .\nRUN mkdir /build\nRUN swagger generate server --template=stratoscale -f swagger.yaml --template-dir=/templates/contrib \\\n    && mv restapi models /build\nRUN swagger generate client --template=stratoscale -f swagger.yaml --template-dir=/templates/contrib \\\n    && mv client /build\n\nFROM registry.svc.ci.openshift.org/openshift/release:golang-1.14 as builder\nCOPY . . \nCOPY --from=swagger_py /build build\nCOPY --from=swagger_go /build/client client\nCOPY --from=swagger_go /build/models models\nCOPY --from=swagger_go /build/restapi restapi\nRUN GOFLAGS=\"\" GO111MODULE=on go build -o /build/assisted-service cmd/main.go\nRUN cd build && python3 setup.py sdist --dist-dir /assisted-service-client\n\nFROM scratch\nCOPY --from=certs /etc/pki/ca-trust/extracted/pem/tls-ca-bundle.pem /etc/ssl/certs/ca-bundle.crt\nCOPY --from=certs /etc/pki/ca-trust/extracted/openssl/ca-bundle.trust.crt /etc/ssl/certs/ca-bundle.trust.crt\nARG GIT_REVISION\nLABEL \"git_revision\"=${GIT_REVISION}\nCOPY --from=builder /build/assisted-service /assisted-service\nCOPY --from=builder /assisted-service-client/assisted-service-client-1.0.0.tar.gz /clients/assisted-service-client-1.0.0.tar.gz\nCMD [\"/assisted-service\"]\nDOCKERFILE\n"
    from: src
    to: src-dockerfile
resources:
  '*':
    requests:
      cpu: 100m
      memory: 200Mi
tag_specification:
  name: "4.6"
  namespace: ocp
zz_generated_metadata:
  branch: master
  org: openshift
  repo: assisted-service
