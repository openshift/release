base_images:
  tests-private:
    name: tests-private
    namespace: ci
    tag: "4.21"
  tests-private-builder:
    name: builder
    namespace: ocp
    tag: rhel-9-golang-1.24-openshift-4.22
  upi-installer:
    name: "4.18"
    namespace: ocp
    tag: upi-installer
releases:
  latest:
    release:
      architecture: amd64
      channel: fast
      version: "4.18"
resources:
  '*':
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- as: azure-ipi-kata
  cron: 0 0 31 2 1
  steps:
    cluster_profile: azure-qe
    env:
      BASE_DOMAIN: qe.azure.devcluster.openshift.com
      CATALOG_SOURCE_IMAGE: quay.io/redhat-user-workloads/ose-osc-tenant/osc-test-fbc:1.11.2-1768223136
      CATALOG_SOURCE_NAME: brew-catalog
      CUSTOM_AZURE_REGION: eastus
      ENABLE_MUST_GATHER: "true"
      EXPECTED_OPERATOR_VERSION: 1.11.2
      INITDATA: ""
      INSTALL_KATA_RPM: "true"
      KATA_RPM_VERSION: 3.17.0-3.rhaos4.19.el9
      MUST_GATHER_IMAGE: registry.redhat.io/openshift-sandboxed-containers/osc-must-gather-rhel9:latest
      MUST_GATHER_ON_FAILURE_ONLY: "false"
      SLEEP_DURATION: 0h
      TEST_FILTERS: ~DisconnectedOnly&;~Disruptive&
      TEST_RELEASE_TYPE: Pre-GA
      TEST_SCENARIOS: sig-kata.*Kata Author
      TEST_TIMEOUT: "120"
      TRUSTEE_URL: https://kbs-service-trustee-operator-system.apps.trustee-1.0.azure.sandboxedcontainers.com
    pre:
    - as: build-tests-private-fork
      commands: |
        echo "============================================"
        echo "Building openshift-tests-private from fork"
        echo "============================================"

        # Clone the fork
        TESTS_PRIVATE_DIR="/tmp/openshift-tests-private"
        git clone --depth=1 --branch=beforeOTE \
          https://github.com/tbuskey/openshift-tests-private.git \
          "${TESTS_PRIVATE_DIR}"
        cd "${TESTS_PRIVATE_DIR}"

        # Log git info for verification
        echo "Fork: https://github.com/tbuskey/openshift-tests-private"
        echo "Branch: beforeOTE"
        echo "Commit: $(git rev-parse HEAD)"
        echo "Commit Msg: $(git log -1 --format=%s)"

        # Save git info to shared dir for later steps
        {
          echo "Fork: https://github.com/tbuskey/openshift-tests-private"
          echo "Branch: beforeOTE"
          echo "Commit: $(git rev-parse HEAD)"
          echo "Date: $(git log -1 --format=%ci)"
          echo "Message: $(git log -1 --format=%s)"
        } > "${SHARED_DIR}/tests-private-fork-info.txt"

        # Build
        echo "Building extended-platform-tests..."
        make go-mod-tidy
        make all

        # Copy binary to shared dir
        cp ./bin/extended-platform-tests "${SHARED_DIR}/"
        chmod +x "${SHARED_DIR}/extended-platform-tests"

        echo "Binary saved to ${SHARED_DIR}/extended-platform-tests"
        ls -la "${SHARED_DIR}/extended-platform-tests"

        # Mark that fork binary should be used
        echo "true" > "${SHARED_DIR}/use-tests-private-fork"
      from: tests-private-builder
      resources:
        requests:
          cpu: "3"
          memory: 12Gi
    test:
    - as: run-tests-from-fork
      cli: latest
      commands: |
        # Use the fork binary built in the pre step
        FORK_BINARY="${SHARED_DIR}/extended-platform-tests"

        if [[ -f "${FORK_BINARY}" ]]; then
          echo "Using fork binary from: ${FORK_BINARY}"
          chmod +x "${FORK_BINARY}"

          # Show fork info
          if [[ -f "${SHARED_DIR}/tests-private-fork-info.txt" ]]; then
            echo "=== Fork Information ==="
            cat "${SHARED_DIR}/tests-private-fork-info.txt"
            echo "========================"
            cp "${SHARED_DIR}/tests-private-fork-info.txt" "${ARTIFACT_DIR}/"
          fi
        else
          echo "ERROR: Fork binary not found at ${FORK_BINARY}"
          echo "Contents of SHARED_DIR:"
          ls -la "${SHARED_DIR}/"
          exit 1
        fi

        # Run the tests using the fork binary
        echo "Running tests with fork binary..."
        cd /tmp

        # Build test list
        SCENARIOS="${TEST_SCENARIOS:-sig-kata.*Kata Author}"
        FILTERS="${TEST_FILTERS:-~DisconnectedOnly&;~Disruptive&}"
        TIMEOUT="${TEST_TIMEOUT:-90}"
        PARALLEL="${TEST_PARALLEL:-1}"

        echo "Test scenarios: ${SCENARIOS}"
        echo "Test filters: ${FILTERS}"

        # Get test cases
        TEST_CASES=$("${FORK_BINARY}" run all --dry-run 2>/dev/null | \
          grep -E "${SCENARIOS}" | \
          grep -v -E "^#" || true)

        if [[ -z "${TEST_CASES}" ]]; then
          echo "No test cases matched the scenario filter"
          "${FORK_BINARY}" run all --dry-run 2>/dev/null | head -50
          exit 1
        fi

        echo "Found $(echo "${TEST_CASES}" | wc -l) test cases"
        echo "${TEST_CASES}" > "${ARTIFACT_DIR}/test-cases.txt"

        # Run tests
        "${FORK_BINARY}" run --max-parallel-tests "${PARALLEL}" \
          --timeout "${TIMEOUT}m" \
          -o "${ARTIFACT_DIR}/e2e-tests.txt" \
          --junit-dir "${ARTIFACT_DIR}/junit" \
          -- "${TEST_CASES}" || true

        echo "Test results saved to ${ARTIFACT_DIR}/"
        ls -la "${ARTIFACT_DIR}/"
      from: cli
      resources:
        requests:
          cpu: "1"
          memory: 1Gi
    workflow: sandboxed-containers-operator-e2e-azure
  timeout: 24h0m0s
- as: azure-ipi-peerpods
  cron: 0 0 31 2 1
  steps:
    cluster_profile: azure-qe
    env:
      BASE_DOMAIN: qe.azure.devcluster.openshift.com
      CATALOG_SOURCE_IMAGE: quay.io/redhat-user-workloads/ose-osc-tenant/osc-test-fbc:1.11.2-1768223136
      CATALOG_SOURCE_NAME: brew-catalog
      CUSTOM_AZURE_REGION: eastus
      ENABLE_MUST_GATHER: "true"
      ENABLEPEERPODS: "true"
      EXPECTED_OPERATOR_VERSION: 1.11.2
      INITDATA: ""
      INSTALL_KATA_RPM: "true"
      KATA_RPM_VERSION: 3.17.0-3.rhaos4.19.el9
      MUST_GATHER_IMAGE: registry.redhat.io/openshift-sandboxed-containers/osc-must-gather-rhel9:latest
      MUST_GATHER_ON_FAILURE_ONLY: "false"
      RUNTIMECLASS: kata-remote
      SLEEP_DURATION: 0h
      TEST_FILTERS: ~DisconnectedOnly&;~Disruptive&
      TEST_RELEASE_TYPE: Pre-GA
      TEST_SCENARIOS: sig-kata.*Kata Author
      TEST_TIMEOUT: "120"
      TRUSTEE_URL: https://kbs-service-trustee-operator-system.apps.trustee-1.0.azure.sandboxedcontainers.com
      WORKLOAD_TO_TEST: peer-pods
    pre:
    - as: build-tests-private-fork
      commands: |
        echo "============================================"
        echo "Building openshift-tests-private from fork"
        echo "============================================"

        # Clone the fork
        TESTS_PRIVATE_DIR="/tmp/openshift-tests-private"
        git clone --depth=1 --branch=beforeOTE \
          https://github.com/tbuskey/openshift-tests-private.git \
          "${TESTS_PRIVATE_DIR}"
        cd "${TESTS_PRIVATE_DIR}"

        # Log git info for verification
        echo "Fork: https://github.com/tbuskey/openshift-tests-private"
        echo "Branch: beforeOTE"
        echo "Commit: $(git rev-parse HEAD)"
        echo "Commit Msg: $(git log -1 --format=%s)"

        # Save git info to shared dir for later steps
        {
          echo "Fork: https://github.com/tbuskey/openshift-tests-private"
          echo "Branch: beforeOTE"
          echo "Commit: $(git rev-parse HEAD)"
          echo "Date: $(git log -1 --format=%ci)"
          echo "Message: $(git log -1 --format=%s)"
        } > "${SHARED_DIR}/tests-private-fork-info.txt"

        # Build
        echo "Building extended-platform-tests..."
        make go-mod-tidy
        make all

        # Copy binary to shared dir
        cp ./bin/extended-platform-tests "${SHARED_DIR}/"
        chmod +x "${SHARED_DIR}/extended-platform-tests"

        echo "Binary saved to ${SHARED_DIR}/extended-platform-tests"
        ls -la "${SHARED_DIR}/extended-platform-tests"

        # Mark that fork binary should be used
        echo "true" > "${SHARED_DIR}/use-tests-private-fork"
      from: tests-private-builder
      resources:
        requests:
          cpu: "3"
          memory: 12Gi
    test:
    - as: run-tests-from-fork
      cli: latest
      commands: |
        # Use the fork binary built in the pre step
        FORK_BINARY="${SHARED_DIR}/extended-platform-tests"

        if [[ -f "${FORK_BINARY}" ]]; then
          echo "Using fork binary from: ${FORK_BINARY}"
          chmod +x "${FORK_BINARY}"

          # Show fork info
          if [[ -f "${SHARED_DIR}/tests-private-fork-info.txt" ]]; then
            echo "=== Fork Information ==="
            cat "${SHARED_DIR}/tests-private-fork-info.txt"
            echo "========================"
            cp "${SHARED_DIR}/tests-private-fork-info.txt" "${ARTIFACT_DIR}/"
          fi
        else
          echo "ERROR: Fork binary not found at ${FORK_BINARY}"
          echo "Contents of SHARED_DIR:"
          ls -la "${SHARED_DIR}/"
          exit 1
        fi

        # Run the tests using the fork binary
        echo "Running tests with fork binary..."
        cd /tmp

        # Build test list
        SCENARIOS="${TEST_SCENARIOS:-sig-kata.*Kata Author}"
        FILTERS="${TEST_FILTERS:-~DisconnectedOnly&;~Disruptive&}"
        TIMEOUT="${TEST_TIMEOUT:-90}"
        PARALLEL="${TEST_PARALLEL:-1}"

        echo "Test scenarios: ${SCENARIOS}"
        echo "Test filters: ${FILTERS}"

        # Get test cases
        TEST_CASES=$("${FORK_BINARY}" run all --dry-run 2>/dev/null | \
          grep -E "${SCENARIOS}" | \
          grep -v -E "^#" || true)

        if [[ -z "${TEST_CASES}" ]]; then
          echo "No test cases matched the scenario filter"
          "${FORK_BINARY}" run all --dry-run 2>/dev/null | head -50
          exit 1
        fi

        echo "Found $(echo "${TEST_CASES}" | wc -l) test cases"
        echo "${TEST_CASES}" > "${ARTIFACT_DIR}/test-cases.txt"

        # Run tests
        "${FORK_BINARY}" run --max-parallel-tests "${PARALLEL}" \
          --timeout "${TIMEOUT}m" \
          -o "${ARTIFACT_DIR}/e2e-tests.txt" \
          --junit-dir "${ARTIFACT_DIR}/junit" \
          -- "${TEST_CASES}" || true

        echo "Test results saved to ${ARTIFACT_DIR}/"
        ls -la "${ARTIFACT_DIR}/"
      from: cli
      resources:
        requests:
          cpu: "1"
          memory: 1Gi
    workflow: sandboxed-containers-operator-e2e-azure
  timeout: 24h0m0s
- as: azure-ipi-coco
  cron: 0 0 31 2 1
  steps:
    cluster_profile: azure-qe
    env:
      BASE_DOMAIN: qe.azure.devcluster.openshift.com
      CATALOG_SOURCE_IMAGE: quay.io/redhat-user-workloads/ose-osc-tenant/osc-test-fbc:1.11.2-1768223136
      CATALOG_SOURCE_NAME: brew-catalog
      CUSTOM_AZURE_REGION: eastus
      ENABLE_MUST_GATHER: "true"
      ENABLEPEERPODS: "true"
      EXPECTED_OPERATOR_VERSION: 1.11.2
      INITDATA: ""
      INSTALL_KATA_RPM: "true"
      KATA_RPM_VERSION: 3.17.0-3.rhaos4.19.el9
      MUST_GATHER_IMAGE: registry.redhat.io/openshift-sandboxed-containers/osc-must-gather-rhel9:latest
      MUST_GATHER_ON_FAILURE_ONLY: "false"
      RUNTIMECLASS: kata-remote
      SLEEP_DURATION: 0h
      TEST_FILTERS: ~DisconnectedOnly&;~Disruptive&
      TEST_RELEASE_TYPE: Pre-GA
      TEST_SCENARIOS: sig-kata.*Kata Author
      TEST_TIMEOUT: "120"
      TRUSTEE_URL: https://kbs-service-trustee-operator-system.apps.trustee-1.0.azure.sandboxedcontainers.com
      WORKLOAD_TO_TEST: coco
    pre:
    - as: build-tests-private-fork
      commands: |
        echo "============================================"
        echo "Building openshift-tests-private from fork"
        echo "============================================"

        # Clone the fork
        TESTS_PRIVATE_DIR="/tmp/openshift-tests-private"
        git clone --depth=1 --branch=beforeOTE \
          https://github.com/tbuskey/openshift-tests-private.git \
          "${TESTS_PRIVATE_DIR}"
        cd "${TESTS_PRIVATE_DIR}"

        # Log git info for verification
        echo "Fork: https://github.com/tbuskey/openshift-tests-private"
        echo "Branch: beforeOTE"
        echo "Commit: $(git rev-parse HEAD)"
        echo "Commit Msg: $(git log -1 --format=%s)"

        # Save git info to shared dir for later steps
        {
          echo "Fork: https://github.com/tbuskey/openshift-tests-private"
          echo "Branch: beforeOTE"
          echo "Commit: $(git rev-parse HEAD)"
          echo "Date: $(git log -1 --format=%ci)"
          echo "Message: $(git log -1 --format=%s)"
        } > "${SHARED_DIR}/tests-private-fork-info.txt"

        # Build
        echo "Building extended-platform-tests..."
        make go-mod-tidy
        make all

        # Copy binary to shared dir
        cp ./bin/extended-platform-tests "${SHARED_DIR}/"
        chmod +x "${SHARED_DIR}/extended-platform-tests"

        echo "Binary saved to ${SHARED_DIR}/extended-platform-tests"
        ls -la "${SHARED_DIR}/extended-platform-tests"

        # Mark that fork binary should be used
        echo "true" > "${SHARED_DIR}/use-tests-private-fork"
      from: tests-private-builder
      resources:
        requests:
          cpu: "3"
          memory: 12Gi
    test:
    - as: run-tests-from-fork
      cli: latest
      commands: |
        # Use the fork binary built in the pre step
        FORK_BINARY="${SHARED_DIR}/extended-platform-tests"

        if [[ -f "${FORK_BINARY}" ]]; then
          echo "Using fork binary from: ${FORK_BINARY}"
          chmod +x "${FORK_BINARY}"

          # Show fork info
          if [[ -f "${SHARED_DIR}/tests-private-fork-info.txt" ]]; then
            echo "=== Fork Information ==="
            cat "${SHARED_DIR}/tests-private-fork-info.txt"
            echo "========================"
            cp "${SHARED_DIR}/tests-private-fork-info.txt" "${ARTIFACT_DIR}/"
          fi
        else
          echo "ERROR: Fork binary not found at ${FORK_BINARY}"
          echo "Contents of SHARED_DIR:"
          ls -la "${SHARED_DIR}/"
          exit 1
        fi

        # Run the tests using the fork binary
        echo "Running tests with fork binary..."
        cd /tmp

        # Build test list
        SCENARIOS="${TEST_SCENARIOS:-sig-kata.*Kata Author}"
        FILTERS="${TEST_FILTERS:-~DisconnectedOnly&;~Disruptive&}"
        TIMEOUT="${TEST_TIMEOUT:-90}"
        PARALLEL="${TEST_PARALLEL:-1}"

        echo "Test scenarios: ${SCENARIOS}"
        echo "Test filters: ${FILTERS}"

        # Get test cases
        TEST_CASES=$("${FORK_BINARY}" run all --dry-run 2>/dev/null | \
          grep -E "${SCENARIOS}" | \
          grep -v -E "^#" || true)

        if [[ -z "${TEST_CASES}" ]]; then
          echo "No test cases matched the scenario filter"
          "${FORK_BINARY}" run all --dry-run 2>/dev/null | head -50
          exit 1
        fi

        echo "Found $(echo "${TEST_CASES}" | wc -l) test cases"
        echo "${TEST_CASES}" > "${ARTIFACT_DIR}/test-cases.txt"

        # Run tests
        "${FORK_BINARY}" run --max-parallel-tests "${PARALLEL}" \
          --timeout "${TIMEOUT}m" \
          -o "${ARTIFACT_DIR}/e2e-tests.txt" \
          --junit-dir "${ARTIFACT_DIR}/junit" \
          -- "${TEST_CASES}" || true

        echo "Test results saved to ${ARTIFACT_DIR}/"
        ls -la "${ARTIFACT_DIR}/"
      from: cli
      resources:
        requests:
          cpu: "1"
          memory: 1Gi
    workflow: sandboxed-containers-operator-e2e-azure
  timeout: 24h0m0s
- as: aro-ipi-peerpods
  cron: 0 0 31 2 1
  steps:
    cluster_profile: azure-qe
    env:
      ARO_CLUSTER_VERSION: "4.17"
      CATALOG_SOURCE_IMAGE: quay.io/redhat-user-workloads/ose-osc-tenant/osc-test-fbc:1.11.2-1768223136
      CATALOG_SOURCE_NAME: brew-catalog
      ENABLE_MUST_GATHER: "true"
      ENABLEPEERPODS: "true"
      EXPECTED_OPERATOR_VERSION: 1.11.2
      HYPERSHIFT_AZURE_LOCATION: eastus
      INITDATA: ""
      INSTALL_KATA_RPM: "true"
      KATA_RPM_VERSION: 3.17.0-3.rhaos4.19.el9
      LOCATION: eastus
      MUST_GATHER_IMAGE: registry.redhat.io/openshift-sandboxed-containers/osc-must-gather-rhel9:latest
      MUST_GATHER_ON_FAILURE_ONLY: "false"
      RUNTIMECLASS: kata-remote
      SLEEP_DURATION: 0h
      TEST_FILTERS: ~DisconnectedOnly&;~Disruptive&
      TEST_RELEASE_TYPE: Pre-GA
      TEST_SCENARIOS: sig-kata.*Kata Author
      TEST_TIMEOUT: "120"
      TRUSTEE_URL: https://kbs-service-trustee-operator-system.apps.trustee-1.0.azure.sandboxedcontainers.com
      WORKLOAD_TO_TEST: peer-pods
    pre:
    - as: build-tests-private-fork
      commands: |
        echo "============================================"
        echo "Building openshift-tests-private from fork"
        echo "============================================"

        # Clone the fork
        TESTS_PRIVATE_DIR="/tmp/openshift-tests-private"
        git clone --depth=1 --branch=beforeOTE \
          https://github.com/tbuskey/openshift-tests-private.git \
          "${TESTS_PRIVATE_DIR}"
        cd "${TESTS_PRIVATE_DIR}"

        # Log git info for verification
        echo "Fork: https://github.com/tbuskey/openshift-tests-private"
        echo "Branch: beforeOTE"
        echo "Commit: $(git rev-parse HEAD)"
        echo "Commit Msg: $(git log -1 --format=%s)"

        # Save git info to shared dir for later steps
        {
          echo "Fork: https://github.com/tbuskey/openshift-tests-private"
          echo "Branch: beforeOTE"
          echo "Commit: $(git rev-parse HEAD)"
          echo "Date: $(git log -1 --format=%ci)"
          echo "Message: $(git log -1 --format=%s)"
        } > "${SHARED_DIR}/tests-private-fork-info.txt"

        # Build
        echo "Building extended-platform-tests..."
        make go-mod-tidy
        make all

        # Copy binary to shared dir
        cp ./bin/extended-platform-tests "${SHARED_DIR}/"
        chmod +x "${SHARED_DIR}/extended-platform-tests"

        echo "Binary saved to ${SHARED_DIR}/extended-platform-tests"
        ls -la "${SHARED_DIR}/extended-platform-tests"

        # Mark that fork binary should be used
        echo "true" > "${SHARED_DIR}/use-tests-private-fork"
      from: tests-private-builder
      resources:
        requests:
          cpu: "3"
          memory: 12Gi
    test:
    - as: run-tests-from-fork
      cli: latest
      commands: |
        # Use the fork binary built in the pre step
        FORK_BINARY="${SHARED_DIR}/extended-platform-tests"

        if [[ -f "${FORK_BINARY}" ]]; then
          echo "Using fork binary from: ${FORK_BINARY}"
          chmod +x "${FORK_BINARY}"

          # Show fork info
          if [[ -f "${SHARED_DIR}/tests-private-fork-info.txt" ]]; then
            echo "=== Fork Information ==="
            cat "${SHARED_DIR}/tests-private-fork-info.txt"
            echo "========================"
            cp "${SHARED_DIR}/tests-private-fork-info.txt" "${ARTIFACT_DIR}/"
          fi
        else
          echo "ERROR: Fork binary not found at ${FORK_BINARY}"
          echo "Contents of SHARED_DIR:"
          ls -la "${SHARED_DIR}/"
          exit 1
        fi

        # Run the tests using the fork binary
        echo "Running tests with fork binary..."
        cd /tmp

        # Build test list
        SCENARIOS="${TEST_SCENARIOS:-sig-kata.*Kata Author}"
        FILTERS="${TEST_FILTERS:-~DisconnectedOnly&;~Disruptive&}"
        TIMEOUT="${TEST_TIMEOUT:-90}"
        PARALLEL="${TEST_PARALLEL:-1}"

        echo "Test scenarios: ${SCENARIOS}"
        echo "Test filters: ${FILTERS}"

        # Get test cases
        TEST_CASES=$("${FORK_BINARY}" run all --dry-run 2>/dev/null | \
          grep -E "${SCENARIOS}" | \
          grep -v -E "^#" || true)

        if [[ -z "${TEST_CASES}" ]]; then
          echo "No test cases matched the scenario filter"
          "${FORK_BINARY}" run all --dry-run 2>/dev/null | head -50
          exit 1
        fi

        echo "Found $(echo "${TEST_CASES}" | wc -l) test cases"
        echo "${TEST_CASES}" > "${ARTIFACT_DIR}/test-cases.txt"

        # Run tests
        "${FORK_BINARY}" run --max-parallel-tests "${PARALLEL}" \
          --timeout "${TIMEOUT}m" \
          -o "${ARTIFACT_DIR}/e2e-tests.txt" \
          --junit-dir "${ARTIFACT_DIR}/junit" \
          -- "${TEST_CASES}" || true

        echo "Test results saved to ${ARTIFACT_DIR}/"
        ls -la "${ARTIFACT_DIR}/"
      from: cli
      resources:
        requests:
          cpu: "1"
          memory: 1Gi
    workflow: sandboxed-containers-operator-e2e-aro
  timeout: 24h0m0s
- as: aro-ipi-coco
  cron: 0 0 31 2 1
  steps:
    cluster_profile: azure-qe
    env:
      ARO_CLUSTER_VERSION: "4.17"
      CATALOG_SOURCE_IMAGE: quay.io/redhat-user-workloads/ose-osc-tenant/osc-test-fbc:1.11.2-1768223136
      CATALOG_SOURCE_NAME: brew-catalog
      ENABLE_MUST_GATHER: "true"
      ENABLEPEERPODS: "true"
      EXPECTED_OPERATOR_VERSION: 1.11.2
      HYPERSHIFT_AZURE_LOCATION: eastus
      INITDATA: ""
      INSTALL_KATA_RPM: "true"
      KATA_RPM_VERSION: 3.17.0-3.rhaos4.19.el9
      LOCATION: eastus
      MUST_GATHER_IMAGE: registry.redhat.io/openshift-sandboxed-containers/osc-must-gather-rhel9:latest
      MUST_GATHER_ON_FAILURE_ONLY: "false"
      RUNTIMECLASS: kata-remote
      SLEEP_DURATION: 0h
      TEST_FILTERS: ~DisconnectedOnly&;~Disruptive&
      TEST_RELEASE_TYPE: Pre-GA
      TEST_SCENARIOS: sig-kata.*Kata Author
      TEST_TIMEOUT: "120"
      TRUSTEE_URL: https://kbs-service-trustee-operator-system.apps.trustee-1.0.azure.sandboxedcontainers.com
      WORKLOAD_TO_TEST: coco
    pre:
    - as: build-tests-private-fork
      commands: |
        echo "============================================"
        echo "Building openshift-tests-private from fork"
        echo "============================================"

        # Clone the fork
        TESTS_PRIVATE_DIR="/tmp/openshift-tests-private"
        git clone --depth=1 --branch=beforeOTE \
          https://github.com/tbuskey/openshift-tests-private.git \
          "${TESTS_PRIVATE_DIR}"
        cd "${TESTS_PRIVATE_DIR}"

        # Log git info for verification
        echo "Fork: https://github.com/tbuskey/openshift-tests-private"
        echo "Branch: beforeOTE"
        echo "Commit: $(git rev-parse HEAD)"
        echo "Commit Msg: $(git log -1 --format=%s)"

        # Save git info to shared dir for later steps
        {
          echo "Fork: https://github.com/tbuskey/openshift-tests-private"
          echo "Branch: beforeOTE"
          echo "Commit: $(git rev-parse HEAD)"
          echo "Date: $(git log -1 --format=%ci)"
          echo "Message: $(git log -1 --format=%s)"
        } > "${SHARED_DIR}/tests-private-fork-info.txt"

        # Build
        echo "Building extended-platform-tests..."
        make go-mod-tidy
        make all

        # Copy binary to shared dir
        cp ./bin/extended-platform-tests "${SHARED_DIR}/"
        chmod +x "${SHARED_DIR}/extended-platform-tests"

        echo "Binary saved to ${SHARED_DIR}/extended-platform-tests"
        ls -la "${SHARED_DIR}/extended-platform-tests"

        # Mark that fork binary should be used
        echo "true" > "${SHARED_DIR}/use-tests-private-fork"
      from: tests-private-builder
      resources:
        requests:
          cpu: "3"
          memory: 12Gi
    test:
    - as: run-tests-from-fork
      cli: latest
      commands: |
        # Use the fork binary built in the pre step
        FORK_BINARY="${SHARED_DIR}/extended-platform-tests"

        if [[ -f "${FORK_BINARY}" ]]; then
          echo "Using fork binary from: ${FORK_BINARY}"
          chmod +x "${FORK_BINARY}"

          # Show fork info
          if [[ -f "${SHARED_DIR}/tests-private-fork-info.txt" ]]; then
            echo "=== Fork Information ==="
            cat "${SHARED_DIR}/tests-private-fork-info.txt"
            echo "========================"
            cp "${SHARED_DIR}/tests-private-fork-info.txt" "${ARTIFACT_DIR}/"
          fi
        else
          echo "ERROR: Fork binary not found at ${FORK_BINARY}"
          echo "Contents of SHARED_DIR:"
          ls -la "${SHARED_DIR}/"
          exit 1
        fi

        # Run the tests using the fork binary
        echo "Running tests with fork binary..."
        cd /tmp

        # Build test list
        SCENARIOS="${TEST_SCENARIOS:-sig-kata.*Kata Author}"
        FILTERS="${TEST_FILTERS:-~DisconnectedOnly&;~Disruptive&}"
        TIMEOUT="${TEST_TIMEOUT:-90}"
        PARALLEL="${TEST_PARALLEL:-1}"

        echo "Test scenarios: ${SCENARIOS}"
        echo "Test filters: ${FILTERS}"

        # Get test cases
        TEST_CASES=$("${FORK_BINARY}" run all --dry-run 2>/dev/null | \
          grep -E "${SCENARIOS}" | \
          grep -v -E "^#" || true)

        if [[ -z "${TEST_CASES}" ]]; then
          echo "No test cases matched the scenario filter"
          "${FORK_BINARY}" run all --dry-run 2>/dev/null | head -50
          exit 1
        fi

        echo "Found $(echo "${TEST_CASES}" | wc -l) test cases"
        echo "${TEST_CASES}" > "${ARTIFACT_DIR}/test-cases.txt"

        # Run tests
        "${FORK_BINARY}" run --max-parallel-tests "${PARALLEL}" \
          --timeout "${TIMEOUT}m" \
          -o "${ARTIFACT_DIR}/e2e-tests.txt" \
          --junit-dir "${ARTIFACT_DIR}/junit" \
          -- "${TEST_CASES}" || true

        echo "Test results saved to ${ARTIFACT_DIR}/"
        ls -la "${ARTIFACT_DIR}/"
      from: cli
      resources:
        requests:
          cpu: "1"
          memory: 1Gi
    workflow: sandboxed-containers-operator-e2e-aro
  timeout: 24h0m0s
- as: aws-ipi-peerpods
  cron: 0 0 31 2 1
  steps:
    cluster_profile: aws-sandboxed-containers-operator
    env:
      AWS_REGION_OVERRIDE: us-east-2
      CATALOG_SOURCE_IMAGE: quay.io/redhat-user-workloads/ose-osc-tenant/osc-test-fbc:1.11.2-1768223136
      CATALOG_SOURCE_NAME: brew-catalog
      ENABLE_MUST_GATHER: "true"
      ENABLEPEERPODS: "true"
      EXPECTED_OPERATOR_VERSION: 1.11.2
      INITDATA: ""
      INSTALL_KATA_RPM: "true"
      KATA_RPM_VERSION: 3.17.0-3.rhaos4.19.el9
      MUST_GATHER_IMAGE: registry.redhat.io/openshift-sandboxed-containers/osc-must-gather-rhel9:latest
      MUST_GATHER_ON_FAILURE_ONLY: "false"
      RUNTIMECLASS: kata-remote
      SLEEP_DURATION: 0h
      TEST_FILTERS: ~DisconnectedOnly&;~Disruptive&
      TEST_RELEASE_TYPE: Pre-GA
      TEST_SCENARIOS: sig-kata.*Kata Author
      TEST_TIMEOUT: "120"
      TRUSTEE_URL: https://kbs-service-trustee-operator-system.apps.trustee-1.0.azure.sandboxedcontainers.com
      WORKLOAD_TO_TEST: peer-pods
    pre:
    - as: build-tests-private-fork
      commands: |
        echo "============================================"
        echo "Building openshift-tests-private from fork"
        echo "============================================"

        # Clone the fork
        TESTS_PRIVATE_DIR="/tmp/openshift-tests-private"
        git clone --depth=1 --branch=beforeOTE \
          https://github.com/tbuskey/openshift-tests-private.git \
          "${TESTS_PRIVATE_DIR}"
        cd "${TESTS_PRIVATE_DIR}"

        # Log git info for verification
        echo "Fork: https://github.com/tbuskey/openshift-tests-private"
        echo "Branch: beforeOTE"
        echo "Commit: $(git rev-parse HEAD)"
        echo "Commit Msg: $(git log -1 --format=%s)"

        # Save git info to shared dir for later steps
        {
          echo "Fork: https://github.com/tbuskey/openshift-tests-private"
          echo "Branch: beforeOTE"
          echo "Commit: $(git rev-parse HEAD)"
          echo "Date: $(git log -1 --format=%ci)"
          echo "Message: $(git log -1 --format=%s)"
        } > "${SHARED_DIR}/tests-private-fork-info.txt"

        # Build
        echo "Building extended-platform-tests..."
        make go-mod-tidy
        make all

        # Copy binary to shared dir
        cp ./bin/extended-platform-tests "${SHARED_DIR}/"
        chmod +x "${SHARED_DIR}/extended-platform-tests"

        echo "Binary saved to ${SHARED_DIR}/extended-platform-tests"
        ls -la "${SHARED_DIR}/extended-platform-tests"

        # Mark that fork binary should be used
        echo "true" > "${SHARED_DIR}/use-tests-private-fork"
      from: tests-private-builder
      resources:
        requests:
          cpu: "3"
          memory: 12Gi
    test:
    - as: run-tests-from-fork
      cli: latest
      commands: |
        # Use the fork binary built in the pre step
        FORK_BINARY="${SHARED_DIR}/extended-platform-tests"

        if [[ -f "${FORK_BINARY}" ]]; then
          echo "Using fork binary from: ${FORK_BINARY}"
          chmod +x "${FORK_BINARY}"

          # Show fork info
          if [[ -f "${SHARED_DIR}/tests-private-fork-info.txt" ]]; then
            echo "=== Fork Information ==="
            cat "${SHARED_DIR}/tests-private-fork-info.txt"
            echo "========================"
            cp "${SHARED_DIR}/tests-private-fork-info.txt" "${ARTIFACT_DIR}/"
          fi
        else
          echo "ERROR: Fork binary not found at ${FORK_BINARY}"
          echo "Contents of SHARED_DIR:"
          ls -la "${SHARED_DIR}/"
          exit 1
        fi

        # Run the tests using the fork binary
        echo "Running tests with fork binary..."
        cd /tmp

        # Build test list
        SCENARIOS="${TEST_SCENARIOS:-sig-kata.*Kata Author}"
        FILTERS="${TEST_FILTERS:-~DisconnectedOnly&;~Disruptive&}"
        TIMEOUT="${TEST_TIMEOUT:-90}"
        PARALLEL="${TEST_PARALLEL:-1}"

        echo "Test scenarios: ${SCENARIOS}"
        echo "Test filters: ${FILTERS}"

        # Get test cases
        TEST_CASES=$("${FORK_BINARY}" run all --dry-run 2>/dev/null | \
          grep -E "${SCENARIOS}" | \
          grep -v -E "^#" || true)

        if [[ -z "${TEST_CASES}" ]]; then
          echo "No test cases matched the scenario filter"
          "${FORK_BINARY}" run all --dry-run 2>/dev/null | head -50
          exit 1
        fi

        echo "Found $(echo "${TEST_CASES}" | wc -l) test cases"
        echo "${TEST_CASES}" > "${ARTIFACT_DIR}/test-cases.txt"

        # Run tests
        "${FORK_BINARY}" run --max-parallel-tests "${PARALLEL}" \
          --timeout "${TIMEOUT}m" \
          -o "${ARTIFACT_DIR}/e2e-tests.txt" \
          --junit-dir "${ARTIFACT_DIR}/junit" \
          -- "${TEST_CASES}" || true

        echo "Test results saved to ${ARTIFACT_DIR}/"
        ls -la "${ARTIFACT_DIR}/"
      from: cli
      resources:
        requests:
          cpu: "1"
          memory: 1Gi
    workflow: sandboxed-containers-operator-e2e-aws
  timeout: 24h0m0s
- as: aws-ipi-coco
  cron: 0 0 31 2 1
  steps:
    cluster_profile: aws-sandboxed-containers-operator
    env:
      AWS_REGION_OVERRIDE: us-east-2
      CATALOG_SOURCE_IMAGE: quay.io/redhat-user-workloads/ose-osc-tenant/osc-test-fbc:1.11.2-1768223136
      CATALOG_SOURCE_NAME: brew-catalog
      ENABLE_MUST_GATHER: "true"
      ENABLEPEERPODS: "true"
      EXPECTED_OPERATOR_VERSION: 1.11.2
      INITDATA: ""
      INSTALL_KATA_RPM: "true"
      KATA_RPM_VERSION: 3.17.0-3.rhaos4.19.el9
      MUST_GATHER_IMAGE: registry.redhat.io/openshift-sandboxed-containers/osc-must-gather-rhel9:latest
      MUST_GATHER_ON_FAILURE_ONLY: "false"
      RUNTIMECLASS: kata-remote
      SLEEP_DURATION: 0h
      TEST_FILTERS: ~DisconnectedOnly&;~Disruptive&
      TEST_RELEASE_TYPE: Pre-GA
      TEST_SCENARIOS: sig-kata.*Kata Author
      TEST_TIMEOUT: "120"
      TRUSTEE_URL: https://kbs-service-trustee-operator-system.apps.trustee-1.0.azure.sandboxedcontainers.com
      WORKLOAD_TO_TEST: coco
    pre:
    - as: build-tests-private-fork
      commands: |
        echo "============================================"
        echo "Building openshift-tests-private from fork"
        echo "============================================"

        # Clone the fork
        TESTS_PRIVATE_DIR="/tmp/openshift-tests-private"
        git clone --depth=1 --branch=beforeOTE \
          https://github.com/tbuskey/openshift-tests-private.git \
          "${TESTS_PRIVATE_DIR}"
        cd "${TESTS_PRIVATE_DIR}"

        # Log git info for verification
        echo "Fork: https://github.com/tbuskey/openshift-tests-private"
        echo "Branch: beforeOTE"
        echo "Commit: $(git rev-parse HEAD)"
        echo "Commit Msg: $(git log -1 --format=%s)"

        # Save git info to shared dir for later steps
        {
          echo "Fork: https://github.com/tbuskey/openshift-tests-private"
          echo "Branch: beforeOTE"
          echo "Commit: $(git rev-parse HEAD)"
          echo "Date: $(git log -1 --format=%ci)"
          echo "Message: $(git log -1 --format=%s)"
        } > "${SHARED_DIR}/tests-private-fork-info.txt"

        # Build
        echo "Building extended-platform-tests..."
        make go-mod-tidy
        make all

        # Copy binary to shared dir
        cp ./bin/extended-platform-tests "${SHARED_DIR}/"
        chmod +x "${SHARED_DIR}/extended-platform-tests"

        echo "Binary saved to ${SHARED_DIR}/extended-platform-tests"
        ls -la "${SHARED_DIR}/extended-platform-tests"

        # Mark that fork binary should be used
        echo "true" > "${SHARED_DIR}/use-tests-private-fork"
      from: tests-private-builder
      resources:
        requests:
          cpu: "3"
          memory: 12Gi
    test:
    - as: run-tests-from-fork
      cli: latest
      commands: |
        # Use the fork binary built in the pre step
        FORK_BINARY="${SHARED_DIR}/extended-platform-tests"

        if [[ -f "${FORK_BINARY}" ]]; then
          echo "Using fork binary from: ${FORK_BINARY}"
          chmod +x "${FORK_BINARY}"

          # Show fork info
          if [[ -f "${SHARED_DIR}/tests-private-fork-info.txt" ]]; then
            echo "=== Fork Information ==="
            cat "${SHARED_DIR}/tests-private-fork-info.txt"
            echo "========================"
            cp "${SHARED_DIR}/tests-private-fork-info.txt" "${ARTIFACT_DIR}/"
          fi
        else
          echo "ERROR: Fork binary not found at ${FORK_BINARY}"
          echo "Contents of SHARED_DIR:"
          ls -la "${SHARED_DIR}/"
          exit 1
        fi

        # Run the tests using the fork binary
        echo "Running tests with fork binary..."
        cd /tmp

        # Build test list
        SCENARIOS="${TEST_SCENARIOS:-sig-kata.*Kata Author}"
        FILTERS="${TEST_FILTERS:-~DisconnectedOnly&;~Disruptive&}"
        TIMEOUT="${TEST_TIMEOUT:-90}"
        PARALLEL="${TEST_PARALLEL:-1}"

        echo "Test scenarios: ${SCENARIOS}"
        echo "Test filters: ${FILTERS}"

        # Get test cases
        TEST_CASES=$("${FORK_BINARY}" run all --dry-run 2>/dev/null | \
          grep -E "${SCENARIOS}" | \
          grep -v -E "^#" || true)

        if [[ -z "${TEST_CASES}" ]]; then
          echo "No test cases matched the scenario filter"
          "${FORK_BINARY}" run all --dry-run 2>/dev/null | head -50
          exit 1
        fi

        echo "Found $(echo "${TEST_CASES}" | wc -l) test cases"
        echo "${TEST_CASES}" > "${ARTIFACT_DIR}/test-cases.txt"

        # Run tests
        "${FORK_BINARY}" run --max-parallel-tests "${PARALLEL}" \
          --timeout "${TIMEOUT}m" \
          -o "${ARTIFACT_DIR}/e2e-tests.txt" \
          --junit-dir "${ARTIFACT_DIR}/junit" \
          -- "${TEST_CASES}" || true

        echo "Test results saved to ${ARTIFACT_DIR}/"
        ls -la "${ARTIFACT_DIR}/"
      from: cli
      resources:
        requests:
          cpu: "1"
          memory: 1Gi
    workflow: sandboxed-containers-operator-e2e-aws
  timeout: 24h0m0s
- as: e2e-tests-private-fork
  cron: 0 0 31 2 1
  steps:
    cluster_profile: azure-qe
    env:
      BASE_DOMAIN: qe.azure.devcluster.openshift.com
    test:
    - as: test-from-fork
      cli: latest
      commands: |
        # Clone your fork of openshift-tests-private
        TESTS_PRIVATE_DIR="/go/src/github.com/openshift/openshift-tests-private"
        mkdir -p "$(dirname ${TESTS_PRIVATE_DIR})"
        git clone --depth=1 --branch=beforeOTE \
          https://github.com/tbuskey/openshift-tests-private.git \
          "${TESTS_PRIVATE_DIR}"
        cd "${TESTS_PRIVATE_DIR}"

        # Verify and log git info (shows in job logs)
        echo "============================================"
        echo "VERIFICATION: Fork and Branch Information"
        echo "============================================"
        echo "Expected: https://github.com/tbuskey/openshift-tests-private @ beforeOTE"
        echo "Actual Remote: $(git remote get-url origin)"
        echo "Actual Branch: $(git branch --show-current)"
        echo "Actual Commit: $(git rev-parse HEAD)"
        echo "Commit Date:   $(git log -1 --format=%ci)"
        echo "Commit Msg:    $(git log -1 --format=%s)"
        echo "============================================"

        # Save git info to artifacts -> artifacts/test-from-fork/git-info.txt
        {
          echo "=== Git Repository Verification ==="
          echo "Expected Remote: https://github.com/tbuskey/openshift-tests-private"
          echo "Expected Branch: beforeOTE"
          echo ""
          echo "=== Actual Values ==="
          echo "Remote URL: $(git remote get-url origin)"
          echo "Branch: $(git branch --show-current)"
          echo "Commit SHA: $(git rev-parse HEAD)"
          echo "Commit Date: $(git log -1 --format=%ci)"
          echo "Commit Author: $(git log -1 --format='%an <%ae>')"
          echo ""
          echo "=== Commit Details ==="
          git log -1 --format=full
          echo ""
          echo "=== Recent Commits ==="
          git log -10 --oneline
        } > "${ARTIFACT_DIR}/git-info.txt"

        # Save git remote info -> artifacts/test-from-fork/git-remote.txt
        git remote -v > "${ARTIFACT_DIR}/git-remote.txt"

        # Build tests from your fork
        echo "Building openshift-tests-private..."
        make go-mod-tidy
        make all

        # Verify binary was built -> artifacts/test-from-fork/binary-info.txt
        {
          echo "=== Binary Information ==="
          echo "Binary path: ${TESTS_PRIVATE_DIR}/bin/extended-platform-tests"
          ls -la ./bin/extended-platform-tests
          echo ""
          echo "=== Binary Version ==="
          ./bin/extended-platform-tests version 2>&1 || echo "Version command not available"
        } > "${ARTIFACT_DIR}/binary-info.txt"

        # Run sig-kata tests (dry-run example) -> artifacts/test-from-fork/test-results.txt
        ./bin/extended-platform-tests run all \
          --dry-run \
          -o "${ARTIFACT_DIR}/test-results.txt"

        echo "Artifacts saved to ${ARTIFACT_DIR}/"
        ls -la "${ARTIFACT_DIR}/"
      from: tests-private-builder
      resources:
        requests:
          cpu: "3"
          memory: 12Gi
    workflow: cucushift-installer-rehearse-azure-ipi
  timeout: 24h0m0s
zz_generated_metadata:
  branch: devel
  org: openshift
  repo: sandboxed-containers-operator
  variant: downstream-candidate418
