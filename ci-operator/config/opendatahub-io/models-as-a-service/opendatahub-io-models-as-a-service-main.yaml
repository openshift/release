build_root:
  project_image:
    dockerfile_literal: |-
      FROM registry.access.redhat.com/ubi9/go-toolset:1.25
      USER 0
      RUN yum install -y --nodocs --allowerasing jq httpd-tools
      RUN curl -s "https://raw.githubusercontent.com/kubernetes-sigs/kustomize/master/hack/install_kustomize.sh" | bash
      RUN mv kustomize /usr/local/bin/
      RUN yum clean all && rm -rf /var/cache/yum
      RUN ln -s /cli/oc /usr/bin/kubectl
      RUN ln -s /usr/bin/python3 /usr/bin/python
images:
- context_dir: maas-api/
  dockerfile_path: Dockerfile
  to: maas-api
promotion:
  to:
  - namespace: opendatahub-io
    tag: latest
releases:
  latest:
    release:
      architecture: multi
      channel: stable
      version: "4.19"
resources:
  '*':
    limits:
      memory: 4Gi
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- always_run: false
  as: e2e-test-maas-api
  skip_if_only_changed: ^docs/|\.md$|^(?:.*/)?(?:\.gitignore|OWNERS|PROJECT|LICENSE)$|^\.github/
  steps:
    cluster_profile: aws-opendatahub
    env:
      BASE_DOMAIN: openshift-ci-aws.rhaiseng.com
      HYPERSHIFT_AWS_REGION: us-west-2
      HYPERSHIFT_NODE_COUNT: "3"
    test:
    - ref: idp-htpasswd
    - as: e2e-maas-api-openshift
      cli: latest
      commands: |-
        source "${SHARED_DIR}/runtime_env"
        first_user=$(echo "$USERS" | cut -d',' -f1)
        IFS=':' read USERNAME PASSWORD <<< "$first_user"
        API_URL=$(oc whoami --show-server)
        oc login "$API_URL" --username="$USERNAME" --password="$PASSWORD" --insecure-skip-tls-verify
        oc whoami
        echo "=== Checking user type ==="
        # Check if cluster-admin
        if oc auth can-i '*' '*' --all-namespaces 2>/dev/null; then
          echo "User type: CLUSTER-ADMIN"
        else
          echo "User type: NON-ADMIN"
        fi
        export USERNAME PASSWORD
        ./test/e2e/scripts/prow_run_smoke_test.sh
      dependencies:
      - env: MAAS_API_IMAGE
        name: maas-api
      from: src
      resources:
        requests:
          cpu: 500m
          memory: 512Mi
      timeout: 15m0s
    workflow: hypershift-hostedcluster-workflow
- always_run: false
  as: pr-image-mirror-maas-api
  skip_if_only_changed: ^docs/|\.md$|^(?:.*/)?(?:\.gitignore|OWNERS|PROJECT|LICENSE)$|^\.github/
  steps:
    dependencies:
      SOURCE_IMAGE_REF: maas-api
    env:
      IMAGE_REPO: maas-api
    workflow: opendatahub-io-ci-image-mirror
- always_run: false
  as: merge-image-mirror-maas-api
  postsubmit: true
  skip_if_only_changed: ^docs/|\.md$|^(?:.*/)?(?:\.gitignore|OWNERS|PROJECT|LICENSE)$|^\.github/
  steps:
    dependencies:
      SOURCE_IMAGE_REF: maas-api
    env:
      IMAGE_REPO: maas-api
      RELEASE_VERSION: latest
    workflow: opendatahub-io-ci-image-mirror
zz_generated_metadata:
  branch: main
  org: opendatahub-io
  repo: models-as-a-service
