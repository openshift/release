build_root:
  project_image:
    dockerfile_literal: |-
      FROM registry.access.redhat.com/ubi9/ubi
      RUN dnf install -y git && dnf clean all
images:
- dockerfile_literal: |-
    FROM src
    USER root
    # Install base packages and Python
    RUN dnf install -y python3.11 python3.11-pip jq && dnf clean all && \
        alternatives --install /usr/bin/python3 python3 /usr/bin/python3.11 20
    # Install Playwright system dependencies (browser libraries)
    RUN dnf install -y \
        nspr nss nss-util atk at-spi2-atk cups-libs libdrm \
        libX11 libXcomposite libXdamage libXext libXrandr \
        libxcb libxkbcommon mesa-libgbm pango alsa-lib \
        gtk3 ca-certificates && \
        dnf clean all
    # Install Python packages including playwright
    RUN python3 -m pip install --no-cache-dir pytest pyyaml requests pytest-playwright && \
        playwright install chromium
    # Install CLI tools
    RUN curl -sL https://github.com/mikefarah/yq/releases/latest/download/yq_linux_amd64 -o /usr/local/bin/yq && \
        chmod +x /usr/local/bin/yq && \
        curl -sL https://get.helm.sh/helm-v4.0.4-linux-amd64.tar.gz | tar xz -C /tmp && \
        mv /tmp/linux-amd64/helm /usr/local/bin/helm && \
        curl -sL https://mirror.openshift.com/pub/openshift-v4/clients/ocp/stable/openshift-client-linux.tar.gz | tar xz -C /usr/local/bin oc kubectl
  from: src
  to: cost-onprem-test
releases:
  latest:
    release:
      architecture: amd64
      channel: fast
      version: "4.20"
resources:
  '*':
    limits:
      memory: 4Gi
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- as: e2e
  cluster_claim:
    architecture: amd64
    cloud: aws
    owner: openshift-ci
    product: ocp
    timeout: 1h0m0s
    version: "4.20"
  run_if_changed: ^(cost-onprem/|scripts/|tests/|openshift-values\.yaml)
  steps:
    test:
    - ref: insights-onprem-minio-deploy
    - ref: insights-onprem-cost-onprem-chart-e2e
    workflow: insights-onprem-cost-onprem-chart-claim
zz_generated_metadata:
  branch: main
  org: insights-onprem
  repo: cost-onprem-chart
