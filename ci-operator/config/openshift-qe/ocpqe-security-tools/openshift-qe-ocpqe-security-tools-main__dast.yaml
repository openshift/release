base_images:
  base:
    name: "4.17"
    namespace: ocp
    tag: cli
build_root:
  project_image:
    dockerfile_literal: |
      FROM registry.access.redhat.com/ubi9/python-311
      USER root
      ENV GOVERSION=1.21.7
      RUN yum install -y diffutils gcc git jq make openssl python python-pip && \
          yum clean all && rm -rf /var/cache/dnf/*
      # Install Go. This version will only be used for unit tests. The
      # official builds are done via their own container image Dockerfiles
      RUN rm -rf /usr/local/go && \
          curl -fsSL https://go.dev/dl/go${GOVERSION}.linux-amd64.tar.gz | tar -C /usr/local -xzf -
      ENV PATH=$PATH:/usr/local/go/bin
      RUN curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 && \
          chmod 700 get_helm.sh && \
          ./get_helm.sh
      RUN pip install virtualenv
images:
- dockerfile_literal: |
    FROM src
    COPY oc /usr/bin/oc
    RUN ln -s /usr/bin/oc /usr/bin/kubectl
  from: src
  inputs:
    base:
      paths:
      - destination_dir: .
        source_path: /usr/bin/oc
  to: ocp-qe-ci-dast
releases:
  latest:
    candidate:
      product: ocp
      stream: nightly
      version: "4.17"
resources:
  '*':
    requests:
      cpu: 100m
      memory: 200Mi
tests:
- always_run: false
  as: security-first-half
  steps:
    allow_skip_on_success: true
    cluster_profile: aws-perfscale-qe
    env:
      API_URL_LIST: admissionregistration.k8s.io/v1 apiextensions.k8s.io/v1 apiregistration.k8s.io/v1
        apiserver.openshift.io/v1 apps.openshift.io/v1 apps/v1 authentication.k8s.io/v1
        authorization.k8s.io/v1 authorization.openshift.io/v1 autoscaling.openshift.io/v1
        autoscaling.openshift.io/v1beta1 autoscaling/v1 autoscaling/v2
      BASE_DOMAIN: qe.devcluster.openshift.com
    test:
    - ref: openshift-qe-ocpqe-security-tools-dast
    workflow: openshift-qe-installer-aws
  timeout: 3h0m0s
- always_run: false
  as: security-test
  steps:
    env:
      API_URL_LIST: admissionregistration.k8s.io/v1
    test:
    - ref: openshift-qe-ocpqe-security-tools-dast
  timeout: 1h0m0s
zz_generated_metadata:
  branch: main
  org: openshift-qe
  repo: ocpqe-security-tools
  variant: dast
