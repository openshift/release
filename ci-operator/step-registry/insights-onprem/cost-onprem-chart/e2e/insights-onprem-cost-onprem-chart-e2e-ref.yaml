ref:
  as: insights-onprem-cost-onprem-chart-e2e
  from: cost-onprem-test
  commands: insights-onprem-cost-onprem-chart-e2e-commands.sh
  resources:
    requests:
      cpu: 100m
      memory: 200Mi
  env:
  - name: DEPLOY_S4
    default: "true"
    documentation: "Set to 'true' to deploy S4 storage. When false, storage is handled externally or not required."
  - name: S4_NAMESPACE
    default: "s4-test"
    documentation: "Namespace for S4 deployment when DEPLOY_S4=true"
  - name: COST_MGMT_CHANNEL
    default: "stable"
    documentation: "OLM channel for Cost Management Operator (stable, alpha, etc.)"
  - name: COST_MGMT_SOURCE
    default: "redhat-operators"
    documentation: "CatalogSource for Cost Management Operator"
  - name: OPERATOR_INSTALL_TIMEOUT
    default: "300"
    documentation: "Maximum time in seconds to wait for Cost Management Operator to install"
  - name: SKIP_COST_MGMT_INSTALL
    default: "false"
    documentation: "Set to 'true' to skip Cost Management Operator installation"
  - name: VERBOSE
    default: "true"
    documentation: "Enable verbose output from deployment script"
  documentation: |-
    This step runs the cost-onprem e2e tests by executing the
    deploy-test-cost-onprem.sh script from the cost-onprem-chart repository.
    
    It handles:
    - Dependency installation (yq, kubectl, helm, oc)
    - S4 object storage deployment (when DEPLOY_S4=true)
    - Cost Management Operator installation (without hardcoded version)
    - RHBK deployment, Strimzi/Kafka setup, Helm chart installation
    - TLS configuration and JWT authentication testing
    
    Set DEPLOY_S4=true to deploy S4 storage. By default (DEPLOY_S4=false),
    storage is handled externally or not required.