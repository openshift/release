chain:
  as: agent-ibmz-sno-install
  env:
    - name: CLUSTER_NAME
      documentation: 'Agent Cluster Name'
    - name: BASEDOMAIN
      documentation: 'Base domain for SNO cluster'
    - name: IC_CLI_VERSION
      documentation: 'IBM Cloud CLI version'
    - name: IC_REGION
      documentation: 'IBM Cloud Region'
  steps:
    - as: agent-ibmz-sno-installer
      cli: latest
      from: installer
      commands: |-
        set -ex
        echo "Checking the installer version"
        openshift-install version
        installer_path=$(which openshift-install)
        cp ${installer_path} ${SHARED_DIR}/openshift-install
      resources:
        requests:
          cpu: 100m
          memory: 100Mi
      timeout: 30m
      grace_period: 10m
    - ref: agent-ibmz-sno-create
  documentation: |-
    This chain fetches the openshift-install binary and stores it in a shared directory and then uses it to create an SNO cluster
    on IBMZ(s390x) architecture using ibmcloud.