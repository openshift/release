workflow:
  as: agent-e2e-compact-ipv4-iso-no-registry
  steps:
    allow_best_effort_post_steps: true
    allow_skip_on_success: true
    env:
      DEVSCRIPTS_CONFIG: |
        AGENT_E2E_TEST_SCENARIO=COMPACT_IPV4
        AGENT_E2E_TEST_BOOT_MODE=ISO_NO_REGISTRY
        AGENT_CLEANUP_ISO_BUILDER_CACHE_LOCAL_DEV=true
      DEVSCRIPTS_TARGET: agent
    pre:
    - ref: ofcir-acquire
    - ref: ipi-install-rbac
    - ref: baremetalds-devscripts-ibm
    - ref: baremetalds-devscripts-proxy
    - ref: ipi-install-hosted-loki
    - ref: baremetalds-devscripts-setup
      timeout: 3h
    test:
      - chain: agent-test
    post:
      - chain: agent-post
  documentation: |-
    This workflow executes the common end-to-end test suite on a compact cluster provisioned by running agent installer.
    It also adds a couple of nodes after the cluster has been successfully deployed.
