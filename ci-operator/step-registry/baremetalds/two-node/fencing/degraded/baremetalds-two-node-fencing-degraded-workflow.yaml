workflow:
  as: baremetalds-two-node-fencing-degraded
  steps:
    allow_skip_on_success: true
    allow_best_effort_post_steps: true
    cluster_profile: equinix-edge-enablement
    pre:
      - chain: baremetalds-ofcir-pre
      - chain: baremetalds-two-node-fencing-post-install
    test:
      - chain: baremetalds-ipi-test
    post:
      - chain: baremetalds-ofcir-post
    env:
      DEGRADED_NODE: "true"
      DEVSCRIPTS_CONFIG: |
        BMC_DRIVER=redfish
        FEATURE_SET="TechPreviewNoUpgrade"
        IP_STACK=v4
        MASTER_DISK=100
        MASTER_MEMORY=32768
        MASTER_VCPU=8
        NUM_MASTERS=2
        NUM_WORKERS=0
      SKIP_READINESS_CHECKS: "true"
      TEST_ARGS: |
        --disable-monitor=etcd-log-analyzer,node-lifecycle,on-prem-haproxy,on-prem-keepalived,initial-and-final-operator-log-scraper,apiserver-incluster-availability,kubelet-log-collector,audit-log-analyzer,metrics-endpoints-down,alert-summary-serializer,cpu-metric-collector,pod-network-avalibility,service-type-load-balancer-availability,ingress-availability,pathological-event-analyzer,legacy-test-framework-invariants,operator-state-analyzer,legacy-cvo-invariants,apiserver-external-availability,azure-metrics-collector,etcd-disk-metrics-intervals,high-cpu-test-analyzer
        --cluster-stability=Disruptive
      TEST_SKIPS: \[Conformance\]\[sig-api-machinery\]\[Feature:APIServer\] local
        kubeconfig \\"check-endpoints\.kubeconfig\\" should be present in all kube-apiserver
        containers \[Suite:openshift/conformance/parallel/minimal\]\|\[Conformance\]\[sig-api-machinery\]\[Feature:APIServer\]
        local kubeconfig \\"control-plane-node\.kubeconfig\\" should be present in
        all kube-apiserver containers \[Suite:openshift/conformance/parallel/minimal\]\|\[Conformance\]\[sig-api-machinery\]\[Feature:APIServer\]
        local kubeconfig \\"lb-ext\.kubeconfig\\" should be present on all masters
        and work \[Suite:openshift/conformance/parallel/minimal\]\|\[Conformance\]\[sig-api-machinery\]\[Feature:APIServer\]
        local kubeconfig \\"lb-int\.kubeconfig\\" should be present on all masters
        and work \[Suite:openshift/conformance/parallel/minimal\]\|\[Conformance\]\[sig-api-machinery\]\[Feature:APIServer\]
        local kubeconfig \\"localhost-recovery\.kubeconfig\\" should be present on
        all masters and work \[Suite:openshift/conformance/parallel/minimal\]\|\[Conformance\]\[sig-api-machinery\]\[Feature:APIServer\]
        local kubeconfig \\"localhost\.kubeconfig\\" should be present on all masters
        and work \[Suite:openshift/conformance/parallel/minimal\]\|\[sig-api-machinery\]\[Feature:APIServer\]\[Late\]
        kubelet terminates kube-apiserver gracefully extended \[Suite:openshift/conformance/parallel\]\|\[sig-arch\]\[Early\]
        Managed cluster should \[apigroup:config\.openshift\.io\] start all core operators
        \|\[sig-architecture\] Conformance Tests should have at least two untainted
        nodes \[Conformance\] \[Suite:openshift/conformance/parallel/minimal\] \[Suite:k8s\]\|\[sig-cli\]
        oc adm must-gather runs successfully for audit logs\|\[sig-cli\] oc adm node-logs
        \[Suite:openshift/conformance/parallel\]\|\[sig-etcd\] etcd cluster has the
        same number of master nodes and voting members from the endpoints configmap
        \[Early\]\[apigroup:config\.openshift\.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-instrumentation\]
        Prometheus \[apigroup:image\.openshift\.io\] when installed on the cluster
        shouldn't report any alerts in firing state apart from Watchdog and AlertmanagerReceiversNotConfigured
        \[Early\]\[apigroup:config\.openshift\.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        Network Policies when using openshift ovn-kubernetes allow ingress traffic
        to one pod from a particular namespace in L2 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        Network Policies when using openshift ovn-kubernetes allow ingress traffic
        to one pod from a particular namespace in L3 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        Network Policies when using openshift ovn-kubernetes pods within namespace
        should be isolated when deny policy is present in L2 dualstack primary UDN
        \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        Network Policies when using openshift ovn-kubernetes pods within namespace
        should be isolated when deny policy is present in L3 dualstack primary UDN
        \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using ClusterUserDefinedNetwork
        can perform east/west traffic between nodes for two pods connected over a
        L2 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using ClusterUserDefinedNetwork
        can perform east/west traffic between nodes two pods connected over a L3 primary
        UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using ClusterUserDefinedNetwork
        isolates overlapping CIDRs with L2 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using ClusterUserDefinedNetwork
        isolates overlapping CIDRs with L3 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using NetworkAttachmentDefinitions
        can perform east/west traffic between nodes for two pods connected over a
        L2 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using NetworkAttachmentDefinitions
        can perform east/west traffic between nodes two pods connected over a L3 primary
        UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using NetworkAttachmentDefinitions
        isolates overlapping CIDRs with L2 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using NetworkAttachmentDefinitions
        isolates overlapping CIDRs with L3 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using UserDefinedNetwork can perform
        east/west traffic between nodes for two pods connected over a L2 primary UDN
        \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using UserDefinedNetwork can perform
        east/west traffic between nodes two pods connected over a L3 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using UserDefinedNetwork isolates
        overlapping CIDRs with L2 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[OCPFeatureGate:NetworkSegmentation\]\[Feature:UserDefinedPrimaryNetworks\]
        when using openshift ovn-kubernetes created using UserDefinedNetwork isolates
        overlapping CIDRs with L3 primary UDN \[Suite:openshift/conformance/parallel\]\|\[sig-node\]
        Managed cluster should verify that nodes have no unexpected reboots \[Late\]
        \[Suite:openshift/conformance/parallel\]\|\[sig-node\]\[apigroup:config\.openshift\.io\]
        CPU Partitioning node validation should have correct cpuset and cpushare set
        in crio containers \[Suite:openshift/conformance/parallel\]\|\[sig-instrumentation]
        Prometheus [apigroup:config\.openshift\.io] when installed on the cluster
        shouldn't report\|\[sig-architecture] Conformance Tests should have at least
        two untainted nodes\|\[sig-etcd]\[apigroup:config\.openshift\.io]\[OCPFeatureGate:DualReplica]
        Two Node with Fencing should have podman etcd containers running on each node\|\[sig-cli\]
        oc adm must-gather runs successfully \[apigroup:config\.openshift\.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-cli\]
        oc adm must-gather oc adm inspect should support since and sincetim\|\[sig-cli\]
        oc adm must-gather Verify logs generated are included in the must-gather directory
        when running the oc adm must-gather command timeout\|\[sig-cli\] oc adm must-gather
        must-gather support since and since-time flags timeout\|\[sig-cli\] oc adm
        must-gather run the must-gather command with own name space\|\[sig-instrumentation]
        Prometheus .* should start and expose a secured proxy and unsecured metrics\|\[Disruptive\]
      TEST_SUITE: openshift/two-node
      ENABLE_HYPERVISOR_SSH_CONFIG: "true"
  documentation: |-
    This workflow executes a Two Node OpenShift with Fencing (TNF) cluster installation with degraded fencing.
