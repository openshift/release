workflow:
  as: cucushift-installer-rehearse-azure-aks-hypershift-image-registry
  steps:
    pre:
      - chain: cucushift-installer-rehearse-azure-aks-hypershift-base-provision
      - ref: cucushift-hypershift-extended-enable-guest
    test:
      - ref: cucushift-hypershift-extended-health-check
    post:
      - ref: cucushift-hypershift-extended-disable-guest
      - chain: cucushift-installer-rehearse-azure-aks-hypershift-base-deprovision
    env:
      - AKS_ADDONS: "azure-keyvault-secrets-provider"
  documentation: |-
    Creates and destroys a hypershift cluster on AKS management cluster