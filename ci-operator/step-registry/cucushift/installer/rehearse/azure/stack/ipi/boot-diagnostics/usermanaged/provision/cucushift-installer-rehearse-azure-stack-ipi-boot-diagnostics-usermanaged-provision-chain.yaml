chain:
  as: cucushift-installer-rehearse-azure-stack-ipi-boot-diagnostics-usermanaged-provision
  steps:
  - chain: ipi-conf-azurestack
  - ref: azure-provision-storage-account
  - ref: ipi-conf-azure-bootdiagnostics
  - ref: ipi-conf-azurestack-creds
  - ref: ipi-conf-azurestack-rhcos
  - ref: ipi-conf-additional-ca-azurestack
  - chain: ipi-install
  - ref: enable-qe-catalogsource
  - chain: cucushift-installer-check
  - ref: cucushift-installer-check-azure-cpms
  - ref: cucushift-installer-check-azure-boot-diagnostics
  env:
  - name: AZURE_CONTROL_PLANE_BOOT_DIAGNOSTICS_TYPE
    default: "userManaged"
    documentation: |-
      Specify boot diagnostics type for controlplane machines
      Value: Disabled, UserManaged
      if not specify in install-config, default behavior is Managed on control plane nodes.
  - name: AZURESTACK_ENDPOINT
    default: 'https://management.mtcazs.wwtatc.com'
    documentation: |-
      The Azure Stack Hub Endpoint to connect to.
  - name: AZURE_STORAGE_ACCOUNT_KIND
    default: "Storage"
    documentation: |-
      The Azure Stack Hub only support Storage kind Storage Account
  - name: SUFFIX_ENDPOINT
    default: "mtcazs.wwtatc.com"
    documentation: |-
      The endpoint suffix for storage accounts.
  - name: RHCOS_VHD_RESOURCE_GROUP
    default: "rhcosvhd"
    documentation: |-
      The resource group of boot image vhd.
  - name: RHCOS_VHD_STORAGE_ACCOUNT
    default: "vhdsaqe"
    documentation: |-
      The storage aaccount of boot image vhd.
  - name: BASE_DOMAIN_RESOURCE_GROUP_NAME
    default: "os4-common"
    documentation: |-
      The base domain resource group name
  - name: BOOT_DIAGNOSTICS
    default: "false"
    documentation: "Inject boot diagnostics for *worker* nodes, configured via manifests during installation. Disable it in this workflow to test installer behavior."
  documentation: |-
    Create an IPI cluster on Azure for QE e2e tests.
    Configure userManaged boot diagnostics in install-config. Applicable on 4.19+.
