workflow:
  as: sandboxed-containers-operator-e2e-aws
  steps:
    env:
      TEST_PARALLEL: 1
      COMPUTE_NODE_REPLICAS: 2
      COMPUTE_NODE_TYPE: "t3a.xlarge"
      CONTROL_PLANE_INSTANCE_TYPE: "t3a.xlarge"
      CONTROL_PLANE_REPLICAS: 3
      SPOT_INSTANCES: "false"
      FORCE_SUCCESS_EXIT: "no"
      MUST_GATHER_IMAGE: "registry.redhat.io/openshift-sandboxed-containers/osc-must-gather-rhel9:latest"
      MUST_GATHER_TIMEOUT: "35m"
      ENABLE_MUST_GATHER: "true"
      MUST_GATHER_ON_FAILURE_ONLY: "true"
    pre:
    - chain: ipi-conf-aws
    - chain: aws-provision-iam-user-minimal-permission
    - ref: sandboxed-containers-operator-aws-region-override
    - chain: ipi-install
    - chain: sandboxed-containers-operator-pre
    post:
    - ref: cucushift-installer-wait
      timeout: 12h10m0s
      best_effort: true
      optional_on_success: true
    - ref: sandboxed-containers-operator-gather-must-gather
    - ref: sandboxed-containers-operator-post
    - chain: ipi-aws-post
    test:
    - ref: openshift-extended-test
  documentation: |-
    This workflow run openshift-extented-test on an AWS cluster with
    the sandboxed containers deployed.
    AWS_REGION_OVERRIDE from sandboxed-containers-operator-aws-region-override
    defines the region to create the cluster in.
