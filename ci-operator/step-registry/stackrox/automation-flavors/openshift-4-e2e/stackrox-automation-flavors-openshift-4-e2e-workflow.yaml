workflow:
  as: stackrox-automation-flavors-openshift-4-e2e
  steps:
    pre:
    - as: openshift-4-create
      commands: |
        [[ -n "${OPENSHIFT_VERSION:-} "]] || {
          echo "ERROR: Expect a defined OPENSHIFT_VERSION"
          exit 1
        }
        /usr/bin/openshift-ci.sh create openshift-4 "${OPENSHIFT_VERSION}"
      credentials:
      - mount_path: /tmp/vault/stackrox-automation-flavors
        name: stackrox-automation-flavors
        namespace: test-credentials
      env:
      - name: OPENSHIFT_VERSION
        default: ''
      from: openshift-4
      resources:
        requests:
          cpu: 2000m
          memory: 4000Mi
    test:
    - ref: stackrox-e2e
    post:
    - as: openshift-4-destroy
      commands: |
        /usr/bin/openshift-ci.sh destroy openshift-4
      credentials:
      - mount_path: /tmp/vault/stackrox-automation-flavors
        name: stackrox-automation-flavors
        namespace: test-credentials
      from: openshift-4
      resources:
        requests:
          cpu: 2000m
          memory: 4000Mi
  documentation: |-
    A stackrox workflow to execute e2e QA tests in an Openshift 4 cluster.
