workflow:
  as: aws-neuron-operator-e2e-rosa
  steps:
    env:
      # ROSA HCP configuration
      HOSTED_CP: "true"
      ENABLE_BYOVPC: "true"
      ZONES_COUNT: "2"
      
      # Default compute pool (inf2.xlarge)
      COMPUTE_MACHINE_TYPE: "inf2.xlarge"
      REPLICAS: "2"
      
      # Machine pool 1: Additional Inferentia (inf2.xlarge)
      MP_MACHINE_TYPE: "inf2.xlarge"
      MP_REPLICAS: "2"
      MP_LABELS: "workload=neuron-inference,feature.node.kubernetes.io/aws-neuron=true"
      MP_ZONE: ""  # Will use multiple AZs
      
      # Machine pool 2: Trainium (trn1.2xlarge) - created in test step
      MP2_MACHINE_TYPE: "trn1.2xlarge"
      MP2_REPLICAS: "2"
      MP2_LABELS: "workload=neuron-training,feature.node.kubernetes.io/aws-neuron=true"
      
      DISABLE_WORKLOAD_MONITORING: "false"
    
    pre:
      - chain: rosa-aws-sts-hcp-provision
      - ref: rosa-conf-machine-pool
      - ref: aws-neuron-operator-provision-trainium-pool
      - ref: osd-ccs-conf-idp-htpasswd-multi-users
      - ref: rosa-cluster-wait-ready-nodes
    
    test:
      - ref: aws-neuron-operator-test
    
    post:
      - chain: rosa-aws-sts-hcp-deprovision
      - ref: send-results-to-reportportal
  
  documentation: |-
    This workflow provisions a ROSA HCP cluster with AWS Neuron instances
    (Inferentia2 and Trainium1) and runs comprehensive Neuron operator tests
    including vLLM inference, metrics, and upgrade testing.
