workflow:
  as: rosa-aws-hcp-conformance
  steps:
    env:
      CHANNEL_GROUP: nightly
      HOSTED_CP: "true"
      OPENSHIFT_VERSION: "release:latest"
      REPLICAS: "3"
      SKIP_MONITOR_TEST: "true"
      TEST_SKIPS: >-
        etcd leader changes are not excessive\|
        Managed cluster should ensure platform components have system-\* priority class associated\|
        Managed cluster should set requests but not limits\|
        ocp payload should be based on existing source OLM version should contain the source commit id\|
        OLM should have imagePullPolicy:IfNotPresent on thier deployments\|
        users can manipulate groups\|
        well-known endpoint should be reachable\|
        builds installing subscription content\|
        The HAProxy router should expose prometheus metrics for a route\|
        oc adm must-gather runs successfully for audit logs\|
        OAuth server has the correct token and certificate fallback semantics\|
        OAuthClientWithRedirectURIs must validate request URIs according to oauth-client definition\|
        should be present on all masters and work\|
        when installed on the cluster should have a AlertmanagerReceiversNotConfigured alert in firing state\|
        API LBs follow \/readyz of kube-apiserver and stop sending requests before server shutdowns for external clients\|
        Node Lifecycle should run through the lifecycle of a node\|
        check registry.redhat.io is available and samples operator can import sample imagestreams
    pre:
      - chain: rosa-aws-sts-hcp-provision
      - ref: osd-ccs-conf-idp-htpasswd-multi-users
      - ref: rosa-cluster-wait-ready-nodes
    test:
      - chain: hypershift-conformance
    post:
      - ref: osd-gather-extra
      - chain: rosa-aws-sts-hcp-deprovision
      - ref: send-results-to-reportportal
  documentation: |-
    This workflow installs a rosa hcp cluster and performs openshift-tests conformance testing.
