workflow:
  as: rosa-aws-sts-conformance
  steps:
    env:
      CHANNEL_GROUP: nightly
      OPENSHIFT_VERSION: "release:latest"
      TEST_SKIPS: >-
        APIs for openshift.io must have stable versions\|
        Prometheus .* when installed on the cluster shouldn't report any alerts in firing state apart from Watchdog and AlertmanagerReceiversNotConfigured\|
        CRDs for openshift.io should have a status in the CRD schema\|
        prow job name should match platform type\|
        Services should be rejected for evicted pods\|
        CPU Partitioning cluster infrastructure should be configured correctly\|
        builds installing subscription content .* should succeed for RHEL 7 base images\|
        Managed cluster should only include cluster daemonsets that have maxUnavailable or maxSurge update of 10 percent or maxUnavailable of 33 percent\|
        CPU Partitioning cluster platform workloads should be annotated correctly for Deployments\|
        should create a pod with a tap interface\|
        local kubeconfig "lb-ext.kubeconfig" should be present on all masters and work\|
        CPU Partitioning cluster platform workloads should be annotated correctly for DaemonSets\|
        Prometheus .* when installed on the cluster should have a AlertmanagerReceiversNotConfigured alert in firing state\|
        The HAProxy router should expose prometheus metrics for a route\|
        Managed cluster should ensure platform components have system-\* priority class associated\|
        builds installing subscription content .* should succeed for RHEL 9 base images\|
        OAuthClientWithRedirectURIs must validate request URIs according to oauth-client definition\|
        oc observe works as expected with cluster operators\|
        Managed cluster should set requests but not limits\|
        users can manipulate groups\|
        Prometheus .* when installed on the cluster shouldn't have failing rules evaluation\|
        Prometheus .* when installed on the cluster should start and expose a secured proxy and unsecured metrics\|
        well-known endpoint should be reachable\|
        OAuth server has the correct token and certificate fallback semantics\|
        builds installing subscription content .* should succeed for RHEL 8 base images\|
        Managed cluster should ensure control plane pods do not run in best-effort QoS\|
        oc adm must-gather runs successfully for audit logs\|
        OpenShift alerting rules .* should have description and summary annotations\|
        Alerts shouldn't exceed the series limit of total series sent via telemetry from each cluster\|
        OpenShift alerting rules .* should have a runbook_url annotation if the alert is critical\|
        API LBs follow /readyz of kube-apiserver and stop sending requests before server shutdowns for external clients\|
        all registered tls artifacts must have no metadata violation regressions\|
        all tls artifacts must be registered
    pre:
    - chain: rosa-aws-sts-provision
    - ref: osd-ccs-conf-idp-htpasswd-multi-users
    - ref: rosa-cluster-wait-ready-nodes
    test:
    - ref: openshift-e2e-test
    post:
    - chain: rosa-aws-sts-deprovision
  documentation: |-
    This workflow installs a rosa sts cluster and performs openshift-tests conformance testing.
