workflow:
  as: openshift-e2e-ibmz-eco-csi-secrets-store-vault
  steps:
    pre:
    - ref: hypershift-mce-ibmz-create-s390xmgmt
    - ref: optional-operators-subscribe
    - ref: storage-create-csi-secrets-store
    - ref: storage-conf-wait-for-csi-driver
    - ref: storage-obj-save
    test:
    - as: test-e2e-vault
      cli: latest
      commands: |
        # the test assumes the default namespace is used
        oc project default
        make e2e-vault
      from: secrets-store-csi-driver-test
      resources:
        requests:
          cpu: 50m
          memory: 100Mi
    post:
    - ref: storage-obj-check
    - ref: storage-destroy-csi-secrets-store
    - ref: hypershift-mce-ibmz-destroy-s390x-mgmt
    env:
      CLUSTERCSIDRIVER: secrets-store.csi.k8s.io
      TRUECONDITIONS: SecretsStoreDriverNodeServiceControllerAvailable
      CLUSTER_NAME_PREFIX: csi-vault-test-s390x
      CONTROL_NODE_PROFILE: cz2-8x16
      COMPUTE_NODE_PROFILE: cz2-8x16
      CONTROL_NODE_COUNT: 3
      COMPUTE_NODE_COUNT: 2
      REGION: 'Frankfurt'
      RESOURCE_GROUP: 'hypershift'
      IC_CLI_VERSION: '2.36.0'
      CLUSTER_VERSION: "4.19.0"      
  documentation: |-
    The Openshift E2E Secrets Store workflow installs the Secrets Store CSI Driver Operator and executes the vault end-to-end tests from the operator repo.
