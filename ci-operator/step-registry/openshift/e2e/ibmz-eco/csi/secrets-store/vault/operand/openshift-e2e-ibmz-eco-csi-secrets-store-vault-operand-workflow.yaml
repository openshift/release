workflow:
  as: openshift-e2e-ibmz-eco-csi-secrets-store-vault-operand
  steps:
    pre:
    - ref: hypershift-mce-ibmz-create-s390xmgmt
    - ref: storage-create-csi-secrets-store-operand
    - ref: storage-obj-save
    - ref: openshift-e2e-ibmz-eco-csi-secrets-store-vault-create-license-secret
    test:
    - as: test-e2e-vault
      cli: latest
      commands: |
        # the test assumes the default namespace is used
        oc project default
        make e2e-vault
      from: secrets-store-csi-driver-test
      resources:
        requests:
          cpu: 50m
          memory: 100Mi
    post:
    - ref: storage-obj-check
    - ref: hypershift-mce-ibmz-destroy-s390x-mgmt
    env:
      CLUSTER_NAME_PREFIX: csi-vault-test-s390x
      CONTROL_NODE_PROFILE: bz2-8x32
      COMPUTE_NODE_PROFILE: bz2-8x32
      CONTROL_NODE_COUNT: 3
      COMPUTE_NODE_COUNT: 2
      REGION: 'Frankfurt'
      RESOURCE_GROUP: 'hypershift'
      IC_CLI_VERSION: '2.36.0'
      CLUSTER_VERSION: "4.19.0" 
  documentation: |-
    The Openshift E2E Secrets Store Operand workflow installs the Secrets Store CSI Driver operand and executes the upstream vault end-to-end tests.

