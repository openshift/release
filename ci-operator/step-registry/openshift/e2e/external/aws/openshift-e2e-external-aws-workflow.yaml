workflow:
  as: openshift-e2e-external-aws
  steps:
    pre:
    - chain: platform-external-cluster-aws-pre
    test:
    - ref: openshift-e2e-test
    post:
    - chain: gather
    - chain: platform-external-cluster-aws-post
    dependencies:
      OPENSHIFT_INSTALL_RELEASE_IMAGE_OVERRIDE: "release:initial"
      OPENSHIFT_UPGRADE_RELEASE_IMAGE_OVERRIDE: "release:latest"
    env:
      PROVIDER_NAME: aws
      PLATFORM_EXTERNAL_CCM_ENABLED: no
      BASE_DOMAIN: origin-ci-int-aws.dev.rhcloud.com
      # TODO(mtulio): tests failing in new e2e workflow using platform type external on AWS.
      # Those will be skipped to prevent delivering a failed job, and unblock developers to consume from
      # that workflow. The skips must be documented, and the following cards tracks the removal:
      # https://issues.redhat.com/browse/SPLAT-1628
      # https://issues.redhat.com/browse/OCPBUGS-29684
      TEST_SKIPS: >-
        \[sig-api-machinery\]\[Feature:ResourceQuota\] Object count check the quota after import-image with --all option \[Skipped:Disconnected\] \[Suite:openshift/conformance/parallel\]\|\[sig-arch\] ClusterOperators \[apigroup:config.openshift.io\] should define at least one namespace in their lists of related objects \[Suite:openshift/conformance/parallel\]\|\[sig-arch\] ClusterOperators \[apigroup:config.openshift.io\] should define at least one related object that is not a namespace \[Suite:openshift/conformance/parallel\]\|\[sig-arch\]\[Late\] clients should not use APIs that are removed in upcoming releases \[apigroup:apiserver.openshift.io\] \[Suite:openshift/conformance/parallel\]\|all registered tls artifacts must have no metadata violation regressions\|all tls artifacts must be registered\|collect certificate data\|\[sig-arch\] Managed cluster should ensure control plane pods do not run in best-effort QoS \[Suite:openshift/conformance/parallel\]\|\[sig-arch\] Managed cluster should set requests but not limits \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:HTPasswdAuth\] HTPasswd IDP should successfully configure htpasswd and be responsive \[apigroup:user.openshift.io\]\[apigroup:route.openshift.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:LDAP\] LDAP IDP should authenticate against an ldap server \[apigroup:user.openshift.io\]\[apigroup:route.openshift.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Headers\]\[apigroup:route.openshift.io\]\[apigroup:config.openshift.io\]\[apigroup:oauth.openshift.io\] expected headers returned from the authorize URL \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Headers\]\[apigroup:route.openshift.io\]\[apigroup:config.openshift.io\]\[apigroup:oauth.openshift.io\] expected headers returned from the grant URL \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Headers\]\[apigroup:route.openshift.io\]\[apigroup:config.openshift.io\]\[apigroup:oauth.openshift.io\] expected headers returned from the login URL for the allow all IDP \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Headers\]\[apigroup:route.openshift.io\]\[apigroup:config.openshift.io\]\[apigroup:oauth.openshift.io\] expected headers returned from the login URL for the bootstrap IDP \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Headers\]\[apigroup:route.openshift.io\]\[apigroup:config.openshift.io\]\[apigroup:oauth.openshift.io\] expected headers returned from the login URL for when there is only one IDP \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Headers\]\[apigroup:route.openshift.io\]\[apigroup:config.openshift.io\]\[apigroup:oauth.openshift.io\] expected headers returned from the logout URL \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Headers\]\[apigroup:route.openshift.io\]\[apigroup:config.openshift.io\]\[apigroup:oauth.openshift.io\] expected headers returned from the root URL \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Headers\]\[apigroup:route.openshift.io\]\[apigroup:config.openshift.io\]\[apigroup:oauth.openshift.io\] expected headers returned from the token request URL \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Headers\]\[apigroup:route.openshift.io\]\[apigroup:config.openshift.io\]\[apigroup:oauth.openshift.io\] expected headers returned from the token URL \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Token Expiration\] Using a OAuth client with a non-default token max age \[apigroup:oauth.openshift.io\] to generate tokens that do not expire works as expected when using a code authorization flow \[apigroup:user.openshift.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Token Expiration\] Using a OAuth client with a non-default token max age \[apigroup:oauth.openshift.io\] to generate tokens that do not expire works as expected when using a token authorization flow \[apigroup:user.openshift.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Token Expiration\] Using a OAuth client with a non-default token max age \[apigroup:oauth.openshift.io\] to generate tokens that expire shortly works as expected when using a code authorization flow \[apigroup:user.openshift.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] \[Token Expiration\] Using a OAuth client with a non-default token max age \[apigroup:oauth.openshift.io\] to generate tokens that expire shortly works as expected when using a token authorization flow \[apigroup:user.openshift.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-auth\]\[Feature:OAuthServer\] well-known endpoint should be reachable \[apigroup:route.openshift.io\] \[apigroup:oauth.openshift.io\] \[Suite:openshift/conformance/parallel\]\|\[sig-ci\] \[Early\] prow job name should match network type \[Suite:openshift/conformance/parallel\]\|\[sig-instrumentation\]\[Late\] OpenShift alerting rules \[apigroup:image.openshift.io\] should link to a valid URL if the runbook_url annotation is defined \[Suite:openshift/conformance/parallel\]\|\[sig-instrumentation\] Metrics should grab all metrics from kubelet /metrics/resource endpoint \[Suite:openshift/conformance/parallel\] \[Suite:k8s\]\|\[sig-network\] Conntrack should drop INVALID conntrack entries \[Privileged\] \[Suite:openshift/conformance/parallel\] \[Suite:k8s\]\|\[sig-network\]\[Feature:Router\] The HAProxy router should enable openshift-monitoring to pull metrics \[Skipped:Disconnected\] \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[Feature:Router\] The HAProxy router should expose a health check on the metrics port \[Skipped:Disconnected\] \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[Feature:Router\] The HAProxy router should expose prometheus metrics for a route \[apigroup:route.openshift.io\] \[Skipped:Disconnected\] \[Suite:openshift/conformance/parallel\]\|\[sig-network\]\[Feature:Router\] The HAProxy router should expose the profiling endpoints \[Skipped:Disconnected\] \[Suite:openshift/conformance/parallel\]\|\[sig-network\] Networking should provide Internet connection for containers \[Feature:Networking-IPv4\] \[Skipped:Disconnected\] \[Skipped:Proxy\] \[Skipped:azure\] \[Suite:openshift/conformance/parallel\] \[Suite:k8s\]\|\[sig-network\] Services should be rejected for evicted pods (no endpoints exist) \[Suite:openshift/conformance/parallel\] \[Suite:k8s\]\|\[sig-node\] Pods Extended Pod Container lifecycle evicted pods should be terminal \[Suite:openshift/conformance/parallel\] \[Suite:k8s\]
      # TODO(mtulio/elmiko): investigate why LB monitor test is triggered when platform type external without CCM.
      TEST_ARGS: '--disable-monitor=service-type-load-balancer-availability'
  documentation: |-
    The origin E2E workflow to validate clusters installed on AWS with platform type external.
