workflow:
  as: openshift-e2e-aws-ccm-techpreview
  steps:
    pre:
    - chain: ipi-conf-aws
    - ref: ingress-aws-conf-lbtype-nlb
    - chain: ipi-install
    - ref: ccm-gather-service-aws
    test:
    - ref: openshift-e2e-test
    post:
    - chain: gather-core-dump
    - ref: ccm-must-gather
    - chain: ipi-aws-post
    env:
      FEATURE_SET: TechPreviewNoUpgrade
      TEST_SKIPS: >-
        Managed cluster should \[apigroup:config.openshift.io\] start all core operators\|
        Alerts shouldn't report any unexpected alerts in firing or pending state\|
        Prometheus \[apigroup:image.openshift.io\] when installed on the cluster shouldn't report any alerts in firing state apart from Watchdog and AlertmanagerReceiversNotConfigured\|
        The HAProxy router should expose prometheus metrics for a route
  documentation: |-
    The Openshift E2E AWS workflow using CCM as a primary mean to initialize nodes and create external LoadBalancers.
    Executes the common end-to-end test suite on AWS to test updated cluster configuration.
    Uses TechPreviewNoUpgrade cluster configuration to test CCM functionality, furthermore
    it creates NLB for ingress controller to test CCM functionality using Security Groups, enforcing the default behavior
    of using Security Groups for NLB.
