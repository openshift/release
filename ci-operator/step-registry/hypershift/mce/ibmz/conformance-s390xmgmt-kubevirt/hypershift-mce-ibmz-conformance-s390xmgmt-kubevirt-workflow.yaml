workflow:
  as: hypershift-mce-ibmz-conformance-s390xmgmt-kubevirt      
  documentation: |-
    The HyperShift mce ibmz conformance workflow executes tests against a new ephemeral Hypershift kubevirt cluster
    created on ibmz Nodes to validate the cluster creation reaches completed state.
  steps:
    pre:
      - ref: hypershift-mce-ibmz-create-s390xmgmt
      - ref: hypershift-mce-ibmz-install-metallb
      - ref: hypershift-mce-ibmz-install-secondarydisk
      - ref: hypershift-kubevirt-install
      - ref: hypershift-kubevirt-install-odf
      - ref: hypershift-mce-install
      - ref: hypershift-mce-ibmz-create-hcpvirt

    test:
      - chain: hypershift-mce-ibmz-test

    post:
      - ref: hypershift-mce-ibmz-destroy-hcpvirt
      - ref: hypershift-mce-ibmz-destroy-s390x-mgmt
    env:
      HYPERSHIFT_BASEDOMAIN: 'hcpci.com'
      HYPERSHIFT_NODE_COUNT: 2
      IC_CLI_VERSION: '2.36.0'
      VSI_IMAGE_NAME: "ibm-ubuntu-22-04-5-minimal-s390x-6"
      IC_REGION: 'eu-gb'
      HC_NS: 'virt-ibmz'
      CONTROL_NODE_COUNT: 3
      COMPUTE_NODE_COUNT: 0
      CONTROL_NODE_PROFILE: "bz2-16x64"
      COMPUTE_NODE_PROFILE: "bz2-16x64"
      REGION: 'London'
      RESOURCE_GROUP: 'hypershift'
      ENABLE_NESTED_VIRT: "true" 
      #SKIP_MONITOR_TEST: "true"
      #TEST_SKIPS: >-
      # Kubectl client Simple pod should support exec through an HTTP proxy\|
      #  Managed cluster should have no crashlooping recycler pods over four minutes\|
      #  PersistentVolumes NFS when invoking the Recycle reclaim policy should test that a PV becomes Available and is clean after the PVC is deleted\|
      #  CSI Mock volume expansion CSI Volume expansion\|
      #  Services should have session affinity timeout work for NodePort service\|
      #  deploymentconfigs with multiple image change triggers should run a successful deployment with a trigger used by different containers\|
      #  deploymentconfigs with multiple image change triggers should run a successful deployment with multiple triggers\|
      #  deploymentconfigs when changing image change trigger should successfully trigger from an updated image\|
      #  oc new-app should succeed with a --name of 58 characters\|
      #  Image layer subresource should return layers from tagged images\|
      #  deploymentconfigs won't deploy RC with unresolved images when patched with empty image\|
      #  s2i build with a root user image should create a root build and pass with a privileged SCC\|
      #  The HAProxy router should be able to connect to a service that is idled because a GET on the route will unidle it\|
      #  build can reference a cluster service with a build being created from new-build should be able to run a build that references a cluster service\|
      #  oc tag should change image reference for internal images\|
      #  Services should be able to switch session affinity for NodePort service\|
      #  Services should have session affinity work for NodePort service\|
      #  Aggregator Should be able to support the 1.17 Sample API Server using the current Aggregator\|
      #  builds installing subscription content \[apigroup:build.openshift.io\] should succeed for RHEL 7 base images\|
      #  builds installing subscription content \[apigroup:build.openshift.io\] should succeed for RHEL 8 base images\|
      #  builds installing subscription content \[apigroup:build.openshift.io\] should succeed for RHEL 9 base images\|
      #  HTPasswd IDP should successfully configure htpasswd and be responsive
        