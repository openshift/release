workflow:
  as: hypershift-mce-ibmz-conformance
  documentation: |-
    The HyperShift mce ibmz conformance workflow executes tests against a new ephemeral Hypershift Agent cluster
    created on ibmz Nodes to validate the cluster creation reaches completed state.
  steps:
    pre:
      - ref: ingress-aws-nlb-manifest
      - chain: ipi-aws-pre
      - ref: hypershift-mce-install
      - chain: hypershift-mce-ibmz-create
    test:
      - chain: hypershift-mce-ibmz-test
      - chain: hypershift-conformance
    post:
      - chain: hypershift-mce-ibmz-destroy
      - chain: ipi-aws-post
    env:
      HYPERSHIFT_BASEDOMAIN: 'hcpci.com'
      HYPERSHIFT_NODE_COUNT: 2
      IC_CLI_VERSION: '2.16.1'
      IC_REGION: 'jp-tok'
      HC_NAME: 'hcp-ci'
      HC_NS: 'agent-ibmz'
      TEST_SKIPS: >-
        etcd leader changes are not excessive\|
        Kubectl client Simple pod should support exec through an HTTP proxy\|
        Managed cluster should have no crashlooping recycler pods over four minutes\|
        PersistentVolumes NFS when invoking the Recycle reclaim policy should test that a PV becomes Available and is clean after the PVC is deleted\|
        CSI Mock volume expansion CSI Volume expansion\|
        Services should have session affinity timeout work for NodePort service
