workflow:
  as: hypershift-mce-ibmz-conformance
  documentation: |-
    The HyperShift mce ibmz conformance workflow executes tests against a new ephemeral Hypershift Agent cluster
    created on ibmz Nodes to validate the cluster creation reaches completed state.
  steps:
    pre:
      - ref: ingress-aws-nlb-manifest
      - chain: ipi-aws-pre
      - ref: hypershift-mce-install
      - chain: hypershift-mce-ibmz-create
    test:
      - chain: hypershift-mce-ibmz-test
      - chain: hypershift-conformance
    post:
      - chain: hypershift-mce-ibmz-destroy
      - chain: ipi-aws-post
    env:
      HYPERSHIFT_BASEDOMAIN: 'hcpci.com'
      HYPERSHIFT_NODE_COUNT: 2
      IC_CLI_VERSION: '2.16.1'
      IC_REGION: 'jp-tok'
      HC_NS: 'agent-ibmz'
      TEST_SKIPS: >-
        etcd leader changes are not excessive\|
        Kubectl client Simple pod should support exec through an HTTP proxy\|
        Managed cluster should have no crashlooping recycler pods over four minutes\|
        PersistentVolumes NFS when invoking the Recycle reclaim policy should test that a PV becomes Available and is clean after the PVC is deleted\|
        CSI Mock volume expansion CSI Volume expansion\|
        Services should have session affinity timeout work for NodePort service\|
        deploymentconfigs with multiple image change triggers should run a successful deployment with a trigger used by different containers\|
        deploymentconfigs with multiple image change triggers should run a successful deployment with multiple triggers\|
        deploymentconfigs when changing image change trigger should successfully trigger from an updated image\|
        oc new-app should succeed with a --name of 58 characters\|
        Image layer subresource should return layers from tagged images\|
        deploymentconfigs won't deploy RC with unresolved images when patched with empty image\|
        s2i build with a root user image should create a root build and pass with a privileged SCC\|
        The HAProxy router should be able to connect to a service that is idled because a GET on the route will unidle it\|
        build can reference a cluster service with a build being created from new-build should be able to run a build that references a cluster service\|
        oc tag should change image reference for internal images\|
        Services should be able to switch session affinity for NodePort service\|
        Services should have session affinity work for NodePort service\|
        Aggregator Should be able to support the 1.17 Sample API Server using the current Aggregator\|
        Prometheus when installed on the cluster shouldn't report any alerts in firing state apart from Watchdog and AlertmanagerReceiversNotConfigured\|
        oc builds complex build webhooks CRUD \|
        Prometheus when installed on the cluster should start and expose a secured proxy and unsecured metrics\|
        expected headers returned from the root URL\|
        expected headers returned from the token UR\|
        expected headers returned from the token request URL\|
        HTPasswd IDP should successfully configure htpasswd and be responsive\|
        LDAP IDP should authenticate against an ldap server\|
        expected headers returned from the authorize URL\|
        Using a OAuth client with a non-default token max age to generate tokens that expire shortly works as expected when using a token authorization flow\|
        expected headers returned from the login URL for when there is only one IDP\|
        expected headers returned from the grant URL\|
        oc builds complex build start-build\|
        Prometheus when installed on the cluster should have non-Pod host cAdvisor metrics\|
        Using a OAuth client with a non-default token max age to generate tokens that do not expire works as expected when using a code authorization flow\|
        Prometheus when installed on the cluster shouldn't have failing rules evaluation\|
        Prometheus when using openshift ovn-kubernetes should ensure egressfirewall is created\|
        expected headers returned from the logout URL\|
        Using a OAuth client with a non-default token max age to generate tokens that do not expire works as expected when using a token authorization flow\|
        expected headers returned from the login URL for the allow all IDP\|
        Prometheus when installed on the cluster should provide ingress metrics\|
        expected headers returned from the login URL for the bootstrap IDP\|
        Using a OAuth client with a non-default token max age to generate tokens that expire shortly works as expected when using a code authorization flow\|
        Prometheus when installed on the cluster should provide named network metrics\|
        Prometheus when installed on the cluster should have a AlertmanagerReceiversNotConfigured alert in firing state\|
        OpenShift alerting rules should have description and summary annotations\|
        OpenShift alerting rules should link to an HTTP(S) location if the runbook_url annotation is defined\|
        OpenShift alerting rules should link to a valid URL if the runbook_url annotation is defined\|
        OpenShift alerting rules should have a runbook_url annotation if the alert is critical\|
        OpenShift alerting rules should have a valid severity label\|
        Managed cluster should report ready nodes the entire duration of the test run\|
        Alerts shouldn't exceed the series limit of total series sent via telemetry from each cluster\|
        Metrics should report short attach times\|
        Metrics should report short mount times

        
