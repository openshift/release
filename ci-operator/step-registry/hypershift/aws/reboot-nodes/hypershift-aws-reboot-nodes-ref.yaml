ref:
  as: hypershift-aws-reboot-nodes
  cli: latest
  from_image:
    namespace: ocp
    name: "4.21"
    tag: upi-installer
  commands: hypershift-aws-reboot-nodes-commands.sh
  credentials:
    - mount_path: /etc/hypershift-pool-aws-credentials
      name: hypershift-pool-aws-credentials
      namespace: test-credentials
  env:
    - default: ${SHARED_DIR}/management_cluster_kubeconfig
      name: KUBECONFIG
      documentation: "Path to the management cluster kubeconfig"
    - default: "true"
      name: REBOOT_ALL_NODES
      documentation: "If true, reboot all nodes (master+worker) for full cluster reboot. If false, reboot only worker nodes (default: true)"
    - default: "300"
      name: REBOOT_WAIT_TIME
      documentation: "Time in seconds to wait after triggering node reboot (default: 300s / 5min)"
    - default: "600"
      name: RECOVERY_WAIT_TIME
      documentation: "Time in seconds to wait for nodes to recover after reboot (default: 600s / 10min)"
  grace_period: 30m0s
  resources:
    requests:
      cpu: 100m
      memory: 100Mi
  timeout: 30m0s
  documentation: |-
    Reboots AWS management cluster nodes to verify OCPBUGS-61829 fix.

    This step reproduces the bug scenario:
      1. Hosting Cluster (management cluster) running HyperShift ✓ (pre-requisite)
      2. Hosted Cluster deployed ✓ (pre-requisite)
      3. Restart Hosting Cluster nodes (this step - simulates full cluster reboot)
      4. Observe Hosting Cluster recovery (this step - waits for nodes Ready)
      5. Observe Hosted Cluster state (this step - verifies control plane recovery)

    By default, reboots worker nodes where HyperShift control plane pods run.
    Set REBOOT_ALL_NODES=true to reboot all nodes (master+worker) for full cluster reboot.

    Verifies that control plane pods (especially openshift-apiserver) recover
    automatically without permission errors or manual intervention.
