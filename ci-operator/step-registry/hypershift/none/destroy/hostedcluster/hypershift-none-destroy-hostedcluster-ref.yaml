ref:
  as: hypershift-none-destroy-hostedcluster
  documentation: |-
    This step is used to destroy the none based hosted cluster that ia created on the AWS management cluster.
  cli: latest
  from_image:
    namespace: ocp
    name: "4.13"
    tag: hypershift-operator
  credentials:
    - mount_path: /etc/ci-pull-credentials
      name: ci-pull-credentials
      namespace: test-credentials
  commands: |-
    set -exuo pipefail
    
    hc_name="z-hc-$(echo -n $PROW_JOB_ID|cut -c-8)"

    echo "$(date) Triggering the hosted cluster $hc_name destruction in the namespace clusters_$hc_name"
    /usr/bin/hypershift destroy cluster none \
      --name $hc_name \
      --namespace "clusters-$hc_name" \
      --destroy-cloud-resources \
      --cluster-grace-period 40m
    echo "$(date) Successfully destroyed the hosted cluster $hc_name"
  resources:
    requests:
      cpu: 100m
      memory: 100Mi
  grace_period: 5m0s
  timeout: 45m0s