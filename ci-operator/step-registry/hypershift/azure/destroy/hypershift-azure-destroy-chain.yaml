chain:
  as: hypershift-azure-destroy
  steps:
    - as: destroy
      cli: latest
      env:
        - name: HYPERSHIFT_AZURE_LOCATION
          default: "eastus"
          documentation: "The Azure location of the cluster."
        - name: HYPERSHIFT_BASE_DOMAIN
          default: "hypershift.azure.devcluster.openshift.com"
          documentation: "The cluster's FQDN will be a subdomain of the base domain."
      commands: |-
        set -exuo pipefail

        CLUSTER_NAME="$(echo -n $PROW_JOB_ID|sha256sum|cut -c-20)"
        echo "$(date) Deleting HyperShift cluster ${CLUSTER_NAME}"
        bin/hypershift destroy cluster azure \
          --azure-creds="etc/hypershift-ci-jobs-azurecreds/credentials"  \
          --name ${CLUSTER_NAME} \
          --location ${HYPERSHIFT_AZURE_LOCATION} \
          --base-domain ${HYPERSHIFT_BASE_DOMAIN} \
          --cluster-grace-period 40m

        \echo "$(date) Finished deleting cluster"
      from: hypershift-operator
      grace_period: 5m0s
      resources:
        requests:
          cpu: 100m
          memory: 100Mi
      timeout: 45m0s
      credentials:
        - mount_path: /etc/hypershift-ci-jobs-azurecreds
          name: hypershift-ci-jobs-azurecreds
          namespace: test-credentials
