workflow:
  as: hypershift-gcp-gke-e2e
  documentation: |-
    The HyperShift GCP GKE e2e workflow provisions a GKE Autopilot cluster
    for use as a HyperShift Control Plane cluster and runs e2e tests.

    Pre phase:
    1. ipi-install-rbac: Grant image-puller permissions on build farm
    2. hypershift-gcp-gke-provision: Create GCP projects, VPC, and GKE cluster
    3. hypershift-gcp-gke-prerequisites: Install CRDs and cert-manager on GKE
    4. hypershift-install: Install the HyperShift operator
    5. hypershift-gcp-control-plane-setup: Configure GCP Workload Identity for PSC and ExternalDNS
    6. hypershift-gcp-hosted-cluster-setup: Create WIF and network infrastructure for hosted clusters

    Test phase:
    1. hypershift-gcp-run-e2e: Run e2e tests against the Control Plane cluster

    Post phase:
    1. hypershift-dump: Collect HyperShift artifacts for debugging
    2. hypershift-gcp-gke-deprovision: Delete GKE cluster and GCP projects
  steps:
    pre:
    - ref: ipi-install-rbac
    - ref: hypershift-gcp-gke-provision
    - ref: hypershift-gcp-gke-prerequisites
    - ref: hypershift-install
    - ref: hypershift-gcp-control-plane-setup
    - ref: hypershift-gcp-hosted-cluster-setup
    test:
    - ref: hypershift-gcp-run-e2e
    post:
    - chain: hypershift-dump
    - ref: hypershift-gcp-gke-deprovision
    env:
      CLOUD_PROVIDER: "GCP"
      GKE_REGION: "us-central1"
      GKE_RELEASE_CHANNEL: "stable"
      TECH_PREVIEW_NO_UPGRADE: "true"
      HYPERSHIFT_GCP_CI_PROJECT: "gcp-hcp-hypershift-ci"
      HYPERSHIFT_GCP_CI_DNS_ZONE: "hypershift-ci-zone"
      HYPERSHIFT_GCP_CI_DNS_DOMAIN: "hypershift-ci.gcp-hcp.openshiftapps.com"
