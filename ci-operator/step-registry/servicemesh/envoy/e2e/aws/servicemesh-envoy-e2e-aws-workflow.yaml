workflow:
  as: servicemesh-envoy-e2e-aws
  steps:
    pre:
    - ref: ipi-conf
    - ref: servicemesh-envoy-e2e-aws-conf
    - ref: ipi-install-rbac
    - ref: ipi-install-install
    - ref: servicemesh-envoy-e2e
    post:
    - chain: ipi-deprovision
    env:
      BASE_DOMAIN: "servicemesh.devcluster.openshift.com"
      MAISTRA_BUILDER_IMAGE: "" # value defined in config/maistra/istio tests steps env 
      CONTROL_PLANE_INSTANCE_TYPE: "m7g.xlarge" # reference: ci-operator/step-registry/ipi/conf/aws/ipi-conf-aws-ref.yaml
      COMPUTE_NODE_TYPE: "m7gd.8xlarge" # reference: ci-operator/step-registry/ipi/conf/aws/ipi-conf-aws-ref.yaml
      CONTROL_PLANE_REPLICAS: "1"
      COMPUTE_NODE_REPLICAS: "1"
      OCP_ARCH: "arm64"
      COMPUTE_NODE_ROOTVOLUME_SIZE: "300"
  documentation: |-
    The servicemesh-envoy-e2e-aws test workflow provides pre- and post- steps that create and
    clean an OpenShift cluster test namespace with a privileged configuration on AWS,
    allowing job authors to inject their own end-to-end test logic.
