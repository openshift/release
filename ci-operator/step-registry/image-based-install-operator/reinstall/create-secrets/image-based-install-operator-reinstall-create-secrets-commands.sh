#!/bin/bash

set -o nounset
set -o errexit
set -o pipefail

echo "************ image based install create identity secrets command ************"

source "${SHARED_DIR}/packet-conf.sh"

ssh "${SSHOPTS[@]}" "root@${IP}" bash - << "EOF"

# prepending each printed line with a timestamp
exec > >(awk '{ print strftime("[%Y-%m-%d %H:%M:%S]"), $0 }') 2>&1

set -xeo pipefail

cd /root/dev-scripts
source common.sh
source utils.sh
source network.sh

# Create namespace if it doesn't exist without throwing an error code
oc create namespace ibi-cluster --dry-run=client -oyaml | oc apply -f -

# Note: this must match the kubeconfig in the verify reinstall step
kubeconfig=$(cat << 'EOKUBECONFIG'
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURRRENDQWlpZ0F3SUJBZ0lJVTVhNWtPZ2Rlcmd3RFFZSktvWklodmNOQVFFTEJRQXdQakVTTUJBR0ExVUUKQ3hNSmIzQmxibk5vYVdaME1TZ3dKZ1lEVlFRREV4OXJkV0psTFdGd2FYTmxjblpsY2kxc2IyTmhiR2h2YzNRdApjMmxuYm1WeU1CNFhEVEkwTVRJd05URTROREEwTlZvWERUTTBNVEl3TXpFNE5EQTBOVm93UGpFU01CQUdBMVVFCkN4TUpiM0JsYm5Ob2FXWjBNU2d3SmdZRFZRUURFeDlyZFdKbExXRndhWE5sY25abGNpMXNiMk5oYkdodmMzUXQKYzJsbmJtVnlNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXp1VmozcXVjVG9UcAp2T3RhZ3BtbXJiSDZ1RGUvUkJQN0I0cFI0b0tNYjNVTjRXVVV0eWdhbDI0d1VnZlZqSFluZXJoV1RmMWRRZ2o5Ck9GOHNqeVMyZldLNXNTaFBBaDVmWkpGMjJvd1EyR3NrZHE0WEV5RWhkdW9TRlVEcDA1dWpjQmFIVFVzM2VkNVcKWXFiZ0tPSFQzNzJYcnovbzNkdjA1ZkE4TU5TdGoxd1VBbGROWitKUHYycmwvUzQySUs2ZmVPWUNaWW5oOXl5SQppOElVS0Y0WHUrWnNnWXpCSVV3MkJxSmw5Q1VHV3ZyT29NUUY2R2xITFBVZ0ZIcmRxUkN6cGNQQUpMUHlWZEFyCldMNENOSnpMeG83emZpTlc4RkdNVzdqVGZvUmtkWUZQMExDTkpQL3N3UnVNN3FzRlREREhXQ3REWEM1QnM0dXUKTWtmTXU4R3gxUUlEQVFBQm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FxUXdEd1lEVlIwVEFRSC9CQVV3QXdFQgovekFkQmdOVkhRNEVGZ1FVdFhDV29XRDluYVlWczIycXFUTmpsdjF5Unh3d0RRWUpLb1pJaHZjTkFRRUxCUUFECmdnRUJBRGlucitRL3BvK3ZxUFBHTmFnZ0IvMmtLVHhxSXlnWTY5L0ZRWVJqam43ZTJQNFZ4WjNRb0M3eXprM3gKR29IRG9jU3RYeDB5QitWNmxaS2RZRTlYSWhrMTB5Qk5qUXlLN0ZtNmZTc1cyR1k3LzIxK3ZwVGFKb0RJUnpNdQpReWs5bmhDd05VY3d6amFvOUh0dVdzSCt6Sk01c1Q1cEFUWmhwbFY4cHF2akI0eUZ3SlV4TzYyOVloQkRuNzJqCnNESzZJSXl6aDhrVDViT29tbEJ5OXA1dk55Y2NheWg5M2M3cWxDODFYUk1rZGc5NFVCQ1ZGeVdhNmNOc2lGNE8Kb1hsdE0vTitWYlFMVU1NbEJ0WEg5blBKeUpGbjQzSXVDeEFqdmh5T0hhc2NKMVJZUjJlZE80djE5azJ5ZnJycAplUGJMblFIMWIrYmdCWG9WWHlaWGgvN0xwams9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURURENDQWpTZ0F3SUJBZ0lJV084UklQK1FvazR3RFFZSktvWklodmNOQVFFTEJRQXdSREVTTUJBR0ExVUUKQ3hNSmIzQmxibk5vYVdaME1TNHdMQVlEVlFRREV5VnJkV0psTFdGd2FYTmxjblpsY2kxelpYSjJhV05sTFc1bApkSGR2Y21zdGMybG5ibVZ5TUI0WERUSTBNVEl3TlRFNE5EQTBObG9YRFRNME1USXdNekU0TkRBME5sb3dSREVTCk1CQUdBMVVFQ3hNSmIzQmxibk5vYVdaME1TNHdMQVlEVlFRREV5VnJkV0psTFdGd2FYTmxjblpsY2kxelpYSjIKYVdObExXNWxkSGR2Y21zdGMybG5ibVZ5TUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQwpBUUVBd3M2YUpLNmJvR3lEWktYRTBLVWltS2IxaGhvWHBCd1gvOCt3WUJjM05uUlJLZHlEd0htUXVna281UjJNClNJOVhtV3F0dVhtOHNnL1BXdFdZampoYUYvSThUZWJLT1I1N0wrMkFLVHNwTkd0SUN1WXN1eFVnSHNaY2d1OWQKWW8renM4dmhpS3V0QmI2S0dmemRURmtKVWF3cmRaRXdEV3pPZllRYzhEd1Bwb3NiamRCU1h0UFc4aGhMTDBtUgpmaS95RWhwcHpDQjgzU3ZEZmFOQ3g2dDkvQnNDU05JRXdqSHRRTmRCSWFRNG9rbExFVm5TUnFaWUJ4S2xCZVkzCkFmVnRlK3kxOTJYTDRlRjFvK091eVd6aTVGUXdJQjZOZlZFSkEwZUFHa2FCQm05Y3BmOFVkbkFpbTdyMFY1T2kKSlNSYk0xcWdFWHZyZDNmZkkyN1BiT0pRaXdJREFRQUJvMEl3UURBT0JnTlZIUThCQWY4RUJBTUNBcVF3RHdZRApWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVVpMTThUTUVKUU4yYURhbUNIb1NZKzZEZW9wY3dEUVlKCktvWklodmNOQVFFTEJRQURnZ0VCQUtZQlQvbTc0R1hsclV4V21xZVpmS0tJM2dMd0hLWWtyU0UyVWw5WXBTbVQKZHhSUFBaOG02WnpYTmViRW1PWHdLaGQxTHo2TlVjREt4UDRNYUk5T1VrVjdiQVlCc0pZZmJLR2ZMOWM4ZHpSTQpRYVErQzR6M29xVGNRUk9vcldsL21jQjIrdDJRVmtUY3d4WmRyeFk1QWVJZ29BUlEwQVlHdUNxeDVPbktFQXpnCklpbmxkMC8reVo3em0xWTFvK0VnanBvV3IweUFweHc4bnFxckRoQmJnMUNWQS9KcjZxS3NkMU04Y3RPcmVST1QKUEFMTjVQQ3lQTHFvTlh0QjhwNDdOLzZkdHFTaUdVZC8xOGhXY25XR1F2M1hweHdTdDhGYVRGbzU2STVnVDVpRwo2MkVUUUpjVWtZV0twaTB2WHVzUDU3amNBSUJOZHJycGJXdFVaSm9wU2lRPQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCi0tLS0tQkVHSU4gQ0VSVElGSUNBVEUtLS0tLQpNSUlETWpDQ0FocWdBd0lCQWdJSVljQ0kxenBIeElRd0RRWUpLb1pJaHZjTkFRRUxCUUF3TnpFU01CQUdBMVVFCkN4TUpiM0JsYm5Ob2FXWjBNU0V3SHdZRFZRUURFeGhyZFdKbExXRndhWE5sY25abGNpMXNZaTF6YVdkdVpYSXcKSGhjTk1qUXhNakExTVRnME1EUTFXaGNOTXpReE1qQXpNVGcwTURRMVdqQTNNUkl3RUFZRFZRUUxFd2x2Y0dWdQpjMmhwWm5ReElUQWZCZ05WQkFNVEdHdDFZbVV0WVhCcGMyVnlkbVZ5TFd4aUxYTnBaMjVsY2pDQ0FTSXdEUVlKCktvWklodmNOQVFFQkJRQURnZ0VQQURDQ0FRb0NnZ0VCQU15Mm1aTkFXV3dJbnJwczZUMER0Um1ZR1dOcXY5cVoKVWM2blRLRzdpT3l6bXluaStXZHE4ZWpqOWlOK05LT0p4WGdTbFVGeUd2NlYreE9IbWNTNzZEOVVGYkVDTElXNApNV3Z6YTN0YmRlc3Z3SHZ5aWdORWp2ZWtNQTB1L21NZ05JTTRrV0xnSDFyWmVZNCtYNkNmeFdtZ0dsQW9WblNICllLTEprYXFwRlowNHBSTGd1UkFzSEM3eG8xUDVGbDU5cDlRUUZrWU91TjZPRnc4S3ljcFlDTVAxaTI4aEF1UzYKTW4raXFjWWlLN0JhTjNrT3VJd0N6SkR3cElnTkxUNXFwUmhQbEZ6YXRoWVV2RFM0Zk5PWUhhakFnK1VFa1NoNgpiRVhFU3IvY1N5LzJ3QjJ5Q0diclFrWUgzNkN3bUE5M2ltNitmMDF0M0MzUW5qc1FXdktIVFkwQ0F3RUFBYU5DCk1FQXdEZ1lEVlIwUEFRSC9CQVFEQWdLa01BOEdBMVVkRXdFQi93UUZNQU1CQWY4d0hRWURWUjBPQkJZRUZDUmYKcVBFblZpdUJhUldVYU1VMjRHVGwxbGp1TUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFCZnBib1Y1NGtHWkczRQpZeUtkVDVVY1dONUtKeXQrbmJDWGwwTWUvRlY4Rmt1L0ZhL0ZGQmJmWlZYVTlwK05HNWtCWWFYelF2Tk8vTUJaCnVabUlUcUpJRmhlUFlwZGFWQm1FVTNZR3pkWjlvbjNFa3llaTY3U2FSMUc4NTEySzRndnM4YmQrYndobXpUZlQKb1dXcFBBM2ZueHA0aWhPK1lEaWR1K0EvTWd4cnBkYXVhek9PamFuRVpkb2lWSjErbDN5YjJvNmcvM09VQW9NVApUVHNldTdBdUJPNGNoWWs4WjV2M0tRdlpOT1cxblhKUjlEUmFzVHFNYlhDZmk5d0M2RUJEMzc0cXQyRWF4emJnCkRTZCtFVExWdWNPSXNJcytmVCtnWHF2VGNJeEhYV1hEQUEvRHNPbEVHU2pDZ3U2SnY3K1MxanV6TXg5bEJRZnYKZXRxdEZ1L0oKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQotLS0tLUJFR0lOIENFUlRJRklDQVRFLS0tLS0KTUlJREVEQ0NBZmlnQXdJQkFnSUlaTWRHbGVncmpZNHdEUVlKS29aSWh2Y05BUUVMQlFBd0pqRWtNQ0lHQTFVRQpBd3diYVc1bmNtVnpjeTF2Y0dWeVlYUnZja0F4TnpNek5ESTBNRFEyTUI0WERUSTBNVEl3TlRFNE5EQTBOMW9YCkRUSTJNVEl3TlRFNE5EQTBOMW93SmpFa01DSUdBMVVFQXd3YmFXNW5jbVZ6Y3kxdmNHVnlZWFJ2Y2tBeE56TXoKTkRJME1EUTJNSUlCSWpBTkJna3Foa2lHOXcwQkFRRUZBQU9DQVE4QU1JSUJDZ0tDQVFFQXdiRFBrbkNpK3RNRwpZZmlJY1Q4R1UyNzZ2WnBMcVNBNEhNa1BFeWZtNWpPdGdhMTBENHJRUjBCNU5kMyswZ05acHpJS1F1VHJXdk1PCmFMQjZYTEtVWXpEQXQ0N3EyVUlwbDdYQ0I2QWxlN0xUOUdEbGs0Z1J6d3hpcFQ3RzZFU1hQaXBtL3B0aDcwNlQKVVNTK09ZSFRhMXN2S1E2NFZxZXQvbUNQU3pXMEVKVEtwRURTMUE3RXkxMkxzbC9ZbG1JSEtxRE9ZeGNrSVNEZQpOS0Y2eTB3dlQvL1N6STAwWXBHRUphVFJVakRFdTJkY3MzbFFjZlZRTitkUTN3bHRXV3BaZWpoaENGdm9PT3ZZCk9wNmJBcGJVTXJ0OUpyU1NHYmQ3Sit1L1BHOU01U0lyU2xRcURaUlh6ZDhPdTBEYWNNdUNxV3hJZlpKSnBHNk0KdmZPWU9wVDJwUUlEQVFBQm8wSXdRREFPQmdOVkhROEJBZjhFQkFNQ0FxUXdEd1lEVlIwVEFRSC9CQVV3QXdFQgovekFkQmdOVkhRNEVGZ1FVbXd1N1kzc0Vmb0trMjF6TTc5MVh6RjhzRm1rd0RRWUpLb1pJaHZjTkFRRUxCUUFECmdnRUJBSTFQbnpWeVcwVHdaZC9MbTVPcFJZKzJoWWQvb21DYi9XdlNXNVp2aUMwbENKOFV3YXQ5MXVocjMwankKaDdoa2dKN1o4dW9HUW1MbjhOdjJxOS9CdElFSzA3YUpwT1RUNXpYalpSS0ZQL0J5S2lXdTFpcTFkekJ3N3N6awpwMHUrdWQ1aDl6eWp0NnpwNE5EOUN2VGo4Q1N6SXNyb0JRMG1ieGRqZ1d1MkY0MDRLZEhObnl6OTU5aUNkbXdxClpZZk5tOFk4RmJveWhjbFEwTHJVc1hER3ByWXVhRlBBRDd0NnNYOHhCQXM4MkthVzNCYTFBV0dVYlB3YVBGL08KU0lxSHJPM0U4L3dvbThFaklkSEJLRjNoQjZFbTZuS0ZnY3Zybk1hczFLZFh2NHhGaUtPUDZvY0V4bGc5WHhGWQoreFJxZFFNdUpMTjBpR1NzL1l0WUlqZFNGd1U9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
    server: https://api.ibi-cluster.redhat.com:6443
  name: ibi-cluster
contexts:
- context:
    cluster: ibi-cluster
    user: admin
  name: admin
current-context: admin
preferences: {}
users:
- name: admin
  user:
    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURaekNDQWsrZ0F3SUJBZ0lJTHlIOG1KZENsNk13RFFZSktvWklodmNOQVFFTEJRQXdOakVTTUJBR0ExVUUKQ3hNSmIzQmxibk5vYVdaME1TQXdIZ1lEVlFRREV4ZGhaRzFwYmkxcmRXSmxZMjl1Wm1sbkxYTnBaMjVsY2pBZQpGdzB5TkRFeU1EVXhPRFF3TkRaYUZ3MHpOREV5TURNeE9EUXdORGRhTURBeEZ6QVZCZ05WQkFvVERuTjVjM1JsCmJUcHRZWE4wWlhKek1SVXdFd1lEVlFRREV3eHplWE4wWlcwNllXUnRhVzR3Z2dFaU1BMEdDU3FHU0liM0RRRUIKQVFVQUE0SUJEd0F3Z2dFS0FvSUJBUURBcFRMZUNHYXo1ckFFR1NOSDJQeUg5ajN1MEtLSDlNeUhzTC9SU2pYVApGTFFmalpiNXI2UFhUSExCc3JIZCsrakxQN2xub1ZQd1pTdE93Z0dCOGxOTmdSY2w3WTV6NUpBNVdLUGNLdFlMCklDYnBSczEwMW9LZENrWkpiVHdkVjBtS0dyemxKRkZIemZHN25xY1IxOFZSTUNIc01VUEwySW1tUlByeDRpYloKNTRVV3ltWDFmNUhpMEJweEs3TmZoajV0dkFobGZZVGhvb2x4eDQzL3Y4M21MamhUdHhBTFpTS1NUSkgrY24wOQptTytIZTY5QStFbXhYR1BKYVJldDVHR2oxQWh1UGZYL3NTa3NHem9hZEhjM0VSMDVMakJhWVdRRmhmajZ6T3dzCjhLWmJ0SktYUHZyNWQ0K3dOOXlieU11Wld6OE9SencxN2w2MFhPMEZENlBEQWdNQkFBR2pmekI5TUE0R0ExVWQKRHdFQi93UUVBd0lGb0RBZEJnTlZIU1VFRmpBVUJnZ3JCZ0VGQlFjREFRWUlLd1lCQlFVSEF3SXdEQVlEVlIwVApBUUgvQkFJd0FEQWRCZ05WSFE0RUZnUVViTXhYZStyZGYrNS9OempjQVA0cWh6Q3ZzQ1V3SHdZRFZSMGpCQmd3CkZvQVVDelEyNmtvVzBoSmlBcVoxTllXU01zSGlCTDR3RFFZSktvWklodmNOQVFFTEJRQURnZ0VCQUtoTDFhcUcKSDUxZUp5anpIc1RXRDRpQVJ3bkpTQld3ZWRnRDhtU3FSRnNtc1VXL3A4ZjVNRWZmQlRKbCtOazJvNExhc2Y0WQpFQVFVc3FFZm1zQVZ5UjhRSmtMYXcyUEw0eWZtcG9qaG5TVGZJaVEzQ0JmTkdqNDVGR0Q5K0ZDVU80b1htSjBHCmdlREE2OGpFSU9TZ2I3T2YvWUQ5aU4wYkZrelZrRUlrT3NybE55VW9Gb3RJeGV2ZkJOZzFVeVpaUEZRWFRseTMKYjdqWmxlU0ZWUC9VSlFKbTdXVHBka0lnUlorM1dhblp3NWxnOTVyMVNISHZwbythak4vZGpiMytPem5OOE4xZApnY0puYUJZNG1oVy92Q1dVQnR3TnJmL0RNWTRxMjZSK1FveEREY2N1SjVOb29tazJQTDhlSVd2TUlwa3k2eE1FCk14OUFua1RQRXlLVmRrVT0KLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=
    client-key-data: LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFcEFJQkFBS0NBUUVBd0tVeTNnaG1zK2F3QkJralI5ajhoL1k5N3RDaWgvVE1oN0MvMFVvMTB4UzBINDJXCithK2oxMHh5d2JLeDNmdm95eis1WjZGVDhHVXJUc0lCZ2ZKVFRZRVhKZTJPYytTUU9WaWozQ3JXQ3lBbTZVYk4KZE5hQ25RcEdTVzA4SFZkSmlocTg1U1JSUjgzeHU1Nm5FZGZGVVRBaDdERkR5OWlKcGtUNjhlSW0yZWVGRnNwbAo5WCtSNHRBYWNTdXpYNFkrYmJ3SVpYMkU0YUtKY2NlTi83L041aTQ0VTdjUUMyVWlra3lSL25KOVBaanZoM3V2ClFQaEpzVnhqeVdrWHJlUmhvOVFJYmozMS83RXBMQnM2R25SM054RWRPUzR3V21Ga0JZWDQrc3pzTFBDbVc3U1MKbHo3NitYZVBzRGZjbThqTG1Wcy9Ea2M4TmU1ZXRGenRCUStqd3dJREFRQUJBb0lCQUM3VGVPdlRhdk5yclhreAppd3ZaeUhoYitHM21OTHVMVzNQWUdLZ011OHlWQ2J0cHRUcjM0SUZpeWJvZmIzQ2YzTlFhcHp4elVHM3NpWHhaClYvaDRLSnQ4TjE0MndodVZnU0VQVkxVZGpHMmo0UkZ1N2wzcURsR1J2OGYxVDFscWNDdXJtQ0t5a3pjNjdmbEcKOVNFM0szVXlsK3hMaFVrMVZ6QWRNRW8vU0daS25sNWFDRnF1cGtWSWsrMGQ1N1krNC9QZEtGNDNHbHNTd0szVApPUmxzaEM3ejZzelBNRTVsbnlpdFdZR2syWXRkbFk2WUNML255Z2tJMWtSTzl1V0FpRDNJUHBScDlZd01vZkIxCnJ1cnVaWGVTNHB1U2MxS3NrTG5VUE1OYkQ0Z05qdk9pMThLZ0FlMjRnRFllWjJ3ajcvRFlpcXpyWUF1S0JxNWgKQ0tQUmVGRUNnWUVBMW5ibC8veERwZkYrUWhRR3p6ZG1xTlp1Q01QK0F0L3NPVkVrQ0ttWVlDYWwwSlFzK093NwpSZmF1OU1EdDQ1R2ZNTWNJOG9LVjEwZ3NTL1JiWmlRK2FsNE4vQU11cjFWSVVtaWVNYzR3V1ZhT3FrWDQvNUN4CmQxNHhFRG1QVTZxV2Z3NTV0dmZzenF2dEF1Y2htUnVlbElVdFN4azhoV29oSHZ4cnVtZ2tpRjhDZ1lFQTVmU0QKRUxGcWNpbTJmWG1mbHozbnNFbXEwU0lxVzdFMjJPaWVoakdtQVRmRTdoV1VmR2RKeU5ZcTd2MTB2R0ZUc1I4TAphbTY3UUp5aGgwOURzOWdsRmc3bTI3YnZYR3k2a3B1ajNrZSt5b0UwL0xyQWVUOHg4Vjg1akVyM1NqcVl4NGtjCmRtdUwwdzJDbkwvYVMvSGpnU1o5N1M4bXVhUlUrYVU5clE0VmJ4MENnWUFMMkoxenVsZHlQeGllUmNUcWhVRGkKYXBYQlhqSVZycEM1eWNXWHhPWnB5VGkzZ0xmTE9DRStDQlk1NXI0OUo3b0hVN2NtemhmQXdIZlI2amx5TnVaTApzYzVMOFZFTzFrTWNhakx5eFZUZVdtMmU4aWFDMTFjMkpMbkpENlRmRmpraDQ0Yk5tSHc0SGo4RlBnY1pFZkY4CmVxNjV5emNRbDRBazJnU0pVMTlST1FLQmdRQ2ZiYmVVMGp4bnJDM2VybjBNQVpwcGFabXBaeE9SQUx0ekJVd3EKNDY4aE53WXN2djkwaExQdUx6WVMvZHg2WXN3QWgvS0ZOd0pTR0lZUTVzNmNtS1dWdG4wdUpaV3NNYUhrMVUxMgpaYTJNZnFvNjhrdFJoSlBlc2RPWFJiNVBVM0xySEUrRWRxbTVpS3RlZTlFZ1NETWdMb3l0N2J2ZWgyVjJzNjZnCkZaeWNyUUtCZ1FEUklQTi92MXQxSENFVGdSbDZwZUJ5WFhEMUlyb1VLWDZrejcxcWNWTU5sL1hYdFNJWDZrd3kKZXFnYUczWURYeGxzWWwzejk0aDAyNStMUE5Rdnl4S3E3bFdiUHNadS9GQzBtUE1UUlgwMzlhZDZscFdTSk51NwpVUFNRcWM1aUd0bmswcjdZRmpQeHcydGJQK01qV1JtUTB5WlFHclozck50MzdHdlpYM0JmL2c9PQotLS0tLUVORCBSU0EgUFJJVkFURSBLRVktLS0tLQo=
EOKUBECONFIG
)

b64_kubeconfig=$(echo "${kubeconfig}" | base64 -w 0)

tee <<EOSEC | oc create -f -
apiVersion: v1
data:
  kubeconfig: ${b64_kubeconfig}
kind: Secret
metadata:
  name: ibi-cluster-admin-kubeconfig
  namespace: ibi-cluster
  labels:
    image-based-installed.openshift.io/created: "true"
type: Opaque
EOSEC

tee <<EOSEC | oc create -f -
apiVersion: v1
data:
  password: SUFnSE4tYXZMWHAtc3YyWXEtN3hVVTg=
  username: a3ViZWFkbWlu
kind: Secret
metadata:
  name: ibi-cluster-admin-password
  namespace: ibi-cluster
  labels:
    image-based-installed.openshift.io/created: "true"
type: Opaque
EOSEC

pull_secret=$(cat $PULL_SECRET_FILE)
base_manifest='{
  "additionalTrustBundle": {
    "userCaBundle": "",
    "proxyConfigmapName": "",
    "proxyConfigmapBundle": ""
  },
  "api_version": 1,
  "base_domain": "redhat.com",
  "cluster_id": "5060b48d-da28-4d38-a361-aa850ababe6c",
  "cluster_name": "ibi-cluster",
  "hostname": "ostest-extraworker-0",
  "infra_id": "ibi-cluster-4t7rm",
  "kubeadmin_password_hash": "$2a$10$33JHQT/CnhIWUtqFjkXCWeuD4VAh6chmVx7Waxk3r/CoAkhta6HJK",
  "KubeconfigCryptoRetention": {
    "KubeAPICrypto": {
      "ServingCrypto": {
        "localhost_signer_private_key": "-----BEGIN RSA PRIVATE KEY-----\nMIIEpQIBAAKCAQEAzuVj3qucToTpvOtagpmmrbH6uDe/RBP7B4pR4oKMb3UN4WUU\ntygal24wUgfVjHYnerhWTf1dQgj9OF8sjyS2fWK5sShPAh5fZJF22owQ2Gskdq4X\nEyEhduoSFUDp05ujcBaHTUs3ed5WYqbgKOHT372Xrz/o3dv05fA8MNStj1wUAldN\nZ+JPv2rl/S42IK6feOYCZYnh9yyIi8IUKF4Xu+ZsgYzBIUw2BqJl9CUGWvrOoMQF\n6GlHLPUgFHrdqRCzpcPAJLPyVdArWL4CNJzLxo7zfiNW8FGMW7jTfoRkdYFP0LCN\nJP/swRuM7qsFTDDHWCtDXC5Bs4uuMkfMu8Gx1QIDAQABAoIBAQCnLB6IGy3PHAIp\nDhoyEKjnDDpDg3feMC7TpuYHGekTXgd7KcuVOqhR10zf20inmAjKVgwWNDSYWN8S\nH4THnKh/o7fa93Dvi08U2ZypdideVyQ9aOloIYsCpJs75RmKS+XBedKVl8MZi5dN\nWv0gy2gBDxZzGja0nTfCW1ynMBGVFSM1H/P7XsD8OTN97MUuKKGFpctMsZzlCOnN\n4T1Us9KZhIIKAsZlGFTYHBpbED3C3lrcH6mXINLHPWGbcSkV0XuOBIMJNbpps1rY\nTmzEXhy0nOM9WikaX1K9hW77AT+d/KAaPvALy0YH9ZgJRqeAwzFwj6/nc/NFDjME\njBOHFXG5AoGBAO+oW7zDaK1uAGfdPT4Ivqpj4mVM1bqw6F/sfxZZetiUJQWKrrXi\nFg/ezvYcKzL11eb3IqiSLrk2DVwwaMQ/9tfg8N/gStU4+bpq4+NH4+7nQVO1PKKz\nV7ECNDZkPZuehiIJKTErmh/0Pl27WYEzpHADTb7wZWq8r9K0cdUC79RzAoGBAN0B\nHv7mEv0aYWVPLAVG95Zp8C880mO/3wxduzxu3I8tXiAb7H8tFD2v7blZg+HTQGUB\nmCHevXXhF4Fnivw+q/TkBkegsf+si7Lri3NUR7G+/f4uB51FtHB6CIM6FezcENYg\nt9ZKTygWOQctXmkOHzVxk3szgNorYdPXBmD68JaXAoGBALo/6SuF4bAGsSIG+jVf\nrm3VOnjngaKZIb6KmSnRWHtAhpUL9kM79VFYIxd5RMlR7G6W2cSP9ufRbgibRpBd\n9YRIOGqEcSPMJ6gMshZMJIPiDQ705q67GgdiYxlyRb7PMAb7f5vK+viiZGWL2D9k\n1wKGTsF5KhgNk8b4nQ6iPaipAoGAAfL6lQDudfD/nucd2kYP9PGmPqRorpyImRFS\nj2vi4hhiViIo6c45+XlNvW6+rQUx8jIbZ2ERhrKfhHKnVSYwWg6Qx5zxNPIOoVtW\ndYPuxfCLSOybAJYWy08oOBARFW+zblAHjwpEvHPFuPx7cq2/NLd1t4ZywnnTeQzS\nb5SG/q0CgYEAw8lSHlmH0PD/nErZTHyAvk/z0y8loAXJFO0AHQ4oRXIC9sosXt1Q\nKGdYCvtAUUrEmqlvAzQX4Ey/9fxIjJesP+hyjiJ3duAUn4GP4ZOJUT7CWTYHaOH4\ncySiIXeWX+IrebGSRyVQWzk6DvqcpxBQNN5V19PwPpWznDS4jvBwq3I=\n-----END RSA PRIVATE KEY-----\n",
        "service_network_signer_private_key": "-----BEGIN RSA PRIVATE KEY-----\nMIIEogIBAAKCAQEAws6aJK6boGyDZKXE0KUimKb1hhoXpBwX/8+wYBc3NnRRKdyD\nwHmQugko5R2MSI9XmWqtuXm8sg/PWtWYjjhaF/I8TebKOR57L+2AKTspNGtICuYs\nuxUgHsZcgu9dYo+zs8vhiKutBb6KGfzdTFkJUawrdZEwDWzOfYQc8DwPposbjdBS\nXtPW8hhLL0mRfi/yEhppzCB83SvDfaNCx6t9/BsCSNIEwjHtQNdBIaQ4oklLEVnS\nRqZYBxKlBeY3AfVte+y192XL4eF1o+OuyWzi5FQwIB6NfVEJA0eAGkaBBm9cpf8U\ndnAim7r0V5OiJSRbM1qgEXvrd3ffI27PbOJQiwIDAQABAoIBACUnKAjE8FNpPqns\nX5v3UqDQftUDluyqmv0jzByXcOVGy8/zCYGk7bA9XPpNZ1rTU76jtNxB1nYTQ9Ws\nFPtSzgPxJAUrdffs00uxvRaf/NzNdSD3AyLvBYA5Dp2+Lw5EH96zjKD3NPl6fHY2\nXrJX7MoRzvwOI5772Gnhz28V1VpKqgUuYlglSZu+E6UIe2RxLbmMroxAOoMwWyAt\nuVZbdwO6S8z5xHfEwLNxjgpnZaYyRmWW/OV/IHHrj3Jxc/lZ03e1xWc+8VUu6JHW\nVzuLY2gVS6P2k4xHIYQscJ29UO2tqJ1qGaTCBu3sgfFF1fxekIuq6kwgD6HSMxpo\naam8nbECgYEA88gK0AJImBT9NuPSYih5bA2eM2oLpC2Y4xDBBnusfyPkSgL+j8RU\n5SN3ja/qgqgt5W6P2/eA2AM8LbEzwkhJAmAP8KzWMXYp06S49T6jbpsg1ZHodxYW\ngfVh5wYA7K53h4o3Fi80A1Jcq2S3em8qQ5FZuHqexOboMEl1V6ckO/MCgYEAzJIr\nhHsRsSvNfKWAELIiik3Cmxe813gHvQrnFEDraEzz5dv8WYkIGE/LXO4+rTLc+jEm\nHptrbPIUf1wNUw63pWN7VlJGg0tfMrmnb6BSJlK7DN0FKrlYmUwUfBgP8eIlS7Ia\nD9/5Ihf1J8scErFGfZXuL2Wo3bGFCLuhb7MZNwkCgYBf0Dnfs2YQz/8NudEQX1QJ\n0fhhwMY+iuVSKV2UTLtpZRPuuuqOWt37CUuN1pxXKf6P9Dp6e/aZ7/uRAdqT+5Em\na9cYAvZUjlq2IkHHsgzOBg6LokM5uuaxwV3vTP7EB3ZXQU2RXJAW1iIyAu3SIyr7\nT39x8E/Cl/aeM+D4yGqHXQKBgDNoRAFNv/tqy3+YQ19utFlXAyFgTLdE1YT++WTQ\nj5etRtkrd/W0BtG9M5iN0jhKANfqg+7LFarSBq6enkaR+zpXjoX5tPiHd0vS9a2K\ndzpkLdckr4i1/PrA8KDilxcswjyMbBozKXMU3Cl80/gqjlE+3RUSEeZsFsdEB2R/\neEWpAoGAbJoIcGcVPpayYjFyJ5cmHynARn/w+cU31Pn7WtkPMMJE+fxu7IbuSSqg\nTPAoad+TGpcaqwx5CcwU3N38fDaPfrF8RO5YdX9dkgYzUfx8/Vsr/6I0KtGY1rBk\nY8bbhztzbU6jMyAK/+QoNUKmhzdnJhsgISNIATqx834nAvTajUU=\n-----END RSA PRIVATE KEY-----\n",
        "loadbalancer_external_signer_private_key": "-----BEGIN RSA PRIVATE KEY-----\nMIIEogIBAAKCAQEAzLaZk0BZbAieumzpPQO1GZgZY2q/2plRzqdMobuI7LObKeL5\nZ2rx6OP2I340o4nFeBKVQXIa/pX7E4eZxLvoP1QVsQIshbgxa/Nre1t16y/Ae/KK\nA0SO96QwDS7+YyA0gziRYuAfWtl5jj5foJ/FaaAaUChWdIdgosmRqqkVnTilEuC5\nECwcLvGjU/kWXn2n1BAWRg643o4XDwrJylgIw/WLbyEC5Loyf6KpxiIrsFo3eQ64\njALMkPCkiA0tPmqlGE+UXNq2FhS8NLh805gdqMCD5QSRKHpsRcRKv9xLL/bAHbII\nZutCRgffoLCYD3eKbr5/TW3cLdCeOxBa8odNjQIDAQABAoIBAFDTuAdf3O6+6I0K\n+3xPvm2AlGWgfGe/KYHCpIsnFIUA1T7Qk1C19RXTDBgveHEpsIIcNDpG50mlxiCL\n5ba7ypNWi8n75cBWXY0V61YlYoWdsQ4/USbBJwG4HhDWgTJ6QMGe0CiN/VNNkqUL\nE47EBpoR0NHdW2VfHlSn6Y/MevA7/IpdstgyJueFiw0kQAsqlYwf+m86k6QNUouH\ngc5HugO7yMbSn8Adb/+v0adcmS/Ya2KLLhwBx9nzQgMVNNGRqi+Zucx1UVhiBlQH\n8mQFaALxaCHbEFxLATvLZO4AJViLL3nUdDIfzJeKvbw8x48h8787f2UHzp3JrELp\nEMJj3IECgYEA4/qRvOZKWCv0hH/Tnxb5rOSs7GU5/SfJClKuwrw7q4K2yE03ah4V\nDT0r0KYPvKUvkVhlOrUA4HdZuCuOCBmwPMKf/LlMzDv01B/oUNRkEY3MppJrXhXO\neyEjSUYy/WBgPy4CG9Khaxq89Ls7oHKTJ69xjX7jq4Z5dz/l0jf87KkCgYEA5d/5\nN7PnZNxcWRf7Y0LR5KDl978k4Wa+LYid52sXz3gJVUpm5m5sojicvwPVfEG47Djl\nKWX8szI2heH8PMfncce8t4Nt9b8ucVdGHbYS4m5b85wYFt0OWIVCxkJ8RqQrsesE\nq5MFqxdGbuIv38pi88+7IV5llpQvH5M7wHQN5EUCgYBcALLv2MAH9TUog62TdmIs\nM9zVScStNXEciWGdlPk/rfC1xPOoD5vPS/Bys5GGP+OCdHnlx0YjUAcVG/6lpjhJ\nTQHjq6Qih8+2C2pltFDuBJuiXVSXE5XQev8SgxHwzwQIezi+obIi1xeKbEUT6ykX\nyuW4hIy8m/hI97B3tcCMgQKBgARXpMeOmHJpTz1HnLIVUw20lGOHstSnMjR9/i2e\n8kYzCEoaK7Nypo6x7xQUqHW+cBXWRU3w5UMlUa5ZxIAJbq/RjBkTXIJl6CSv910c\nUWMBnq8NZc8YweqeKdLA8sQK2eB0hhQPpO3EdMonb6wUkKX2aJyKwfSEPBemmlxa\nVODZAoGAWEa2iRWRYm35ACVpHMrDpNLqno5ky2XP77dy+Gb6e0mxGS2A47zBngvR\nD5hajpUjx75b2w+veUpbTO65sZRPajZdk2duprR8VHmiuD1FvU4aDuFEoJhtiosH\nlssatxT/WCGtQ+/y4HstlCYNvHqHQoJfm/08Sbn6FER0KmZfiIY=\n-----END RSA PRIVATE KEY-----\n"
      },
      "ClientAuthCrypto": {
        "admin_ca_certificate": "-----BEGIN CERTIFICATE-----\nMIIDMDCCAhigAwIBAgIIAItigrtpytkwDQYJKoZIhvcNAQELBQAwNjESMBAGA1UE\nCxMJb3BlbnNoaWZ0MSAwHgYDVQQDExdhZG1pbi1rdWJlY29uZmlnLXNpZ25lcjAe\nFw0yNDEyMDUxODQwNDZaFw0zNDEyMDMxODQwNDZaMDYxEjAQBgNVBAsTCW9wZW5z\naGlmdDEgMB4GA1UEAxMXYWRtaW4ta3ViZWNvbmZpZy1zaWduZXIwggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDNj8NbgrTlZhgx3+u+U0gPxtKOs2QNe/GB\nH0gRe1nCsFuC8K7B+lkiNn9STl8ga16dLZkKZK5UIL7hGAldrqYO4uP9UoTwAnDn\nzb5NqqYEoTB+MmiDsAJ0ZnIMWZFW88zdpTHBNeO0B91zWXz5cpXJwD8jtXEf80x5\nSRktIFL6YhMdUD2E8M+zcDnMb5MkpgcnuI2J6+TwLfg45ciZl9ldevYPuVuzgnJ5\nm1rZjDidNlJfYvSevPV6N4LeuqiRn686PATPN/wWhH+c8CGQP9UFgSvrYnYhFjbq\nOExskYTUvXTUm/0V9GJrpO3xG1khtl8LdtGUZPYNoq4t88BS3SrJAgMBAAGjQjBA\nMA4GA1UdDwEB/wQEAwICpDAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBQLNDbq\nShbSEmICpnU1hZIyweIEvjANBgkqhkiG9w0BAQsFAAOCAQEAa+4JDQ7VGYdpZOxB\nCYfHMzCNKk7V26RAWAADXIVmRRqnxP8PosMeYDxytUyScpSWZVBFzESOQB97f6An\nnWfP14yWQCUORvOeZgI9ORDpOd14ghDPw1OQN7XqEVWfUzvTfO/GxpH83G4qrd2I\nz2IAf2QYR4Vei3J5o6Yngo95ULHUXhUQCwHm2RcZgz6JrTV0Xj0oZ4NsKqdd7C5F\nF0aLdo8sFikx/vzt7W2vpb+rcSp8m4CvL+dFZHCZ9a0Y3z7CGdxJCxrEfNo9i7Qy\nQ+oTtALIokuKDgAj0cBvffhXmbS9JeB+RFUjxkNIpQ93PzPEIDZvp2GZG4HSPASU\nU3390w==\n-----END CERTIFICATE-----\n"
      }
    },
    "IngresssCrypto": {
      "ingress_ca": "-----BEGIN RSA PRIVATE KEY-----\nMIIEpgIBAAKCAQEAwbDPknCi+tMGYfiIcT8GU276vZpLqSA4HMkPEyfm5jOtga10\nD4rQR0B5Nd3+0gNZpzIKQuTrWvMOaLB6XLKUYzDAt47q2UIpl7XCB6Ale7LT9GDl\nk4gRzwxipT7G6ESXPipm/pth706TUSS+OYHTa1svKQ64Vqet/mCPSzW0EJTKpEDS\n1A7Ey12Lsl/YlmIHKqDOYxckISDeNKF6y0wvT//SzI00YpGEJaTRUjDEu2dcs3lQ\ncfVQN+dQ3wltWWpZejhhCFvoOOvYOp6bApbUMrt9JrSSGbd7J+u/PG9M5SIrSlQq\nDZRXzd8Ou0DacMuCqWxIfZJJpG6MvfOYOpT2pQIDAQABAoIBAQC9ZLmjlNYY802z\ncMViDuGNpeAyk/RVvPaBVyyRa5wBDxkiy0vIgtDkSyv6u0cXbkU1Et4ryRJGDZLS\nVXZgvBIS57IaCvqjVGm9OfIvaK4eRZ+xvyndV9kqHw86S6dNqPxGwkmRvrhFuwyb\n9JS5QLRNrozv1b/0o+Oj8CFNxoZ7Cnu41rNVjUKkHFfRvL+fVNNWRQwksZ8txrz0\nk+2ac4415TPm5C25LHTcUwja1clydpJSlvjXw2kW/NCW33CR5ENuyUUeo9gOdDdP\nZ3lt/kVO7nHmE773gWuBT/87VfBIcd5TgGXSR9WjYS1ETmyBkZwV0k5PoMa9LIM3\nA9BXPNRBAoGBAMLU8e8rNefV/ceJxJyyRtpY1aUR0QUz8xIbO1dBUmq/EIULP81h\n1jQqRGbG09ngRDPK7bGZah8zLjgRff2Xc/a7Rk8MBZlLU8lEcGAklvNKnoUZjoJ3\nYxYC/EExLfKIOSI8gBZCImVgp9XnxQi2SD2MkwubRspJ+ZwNC58zZNRxAoGBAP6A\nJi1qNsbMOThzlDGSdU++7rnCWinPjsGv/PdsM55AApRc9tL9SZVy38MnbAhdX1Od\nyQDO0b6b9plMKhKzdkAnkCdTjVuur7yXCW4qsn9oiBc4ia8GwP6EuKY496JVAggo\nXwD9BrPPm91oH8eEkPcxKBxrF9jUWoyCxyFDgU91AoGBAKbrceuKhcB+YdKWgdAO\nHQ3slf26ae2fOF0G36w91rKFx010+dCoRbCjlb7IEbDUpxoIfeRun7DjVHHM6rhd\nDYkRoYcPsaxIERyaefyk3H7MK0u1PZchWc7998iSrd7gPrLKSqLHPljEmoZ07yYr\npXC2AzUqb1fYUPYVZyOaEITBAoGBAMpLGI2O2L2KRY1uqYQB04ewz9cN+lczqVih\nx+Tvt9P5M1O01Wj+dgf6CIz5//BiL8yqJcSjoKrvE8Pke6jjx4HVMMthqYIPx5aT\nQ6ay/7EwaMR0Z1SdfLiSzKcrrwL0qSnM1T9W4IX65vzFsEUKRaSHCUgVhB4RJWx8\n40W4f8elAoGBAJmisYgVb+rlEWvMmIGeoVj4bxWUf1T9v+XfJnqSXmW1VZdKwxxq\nZMsWs/M49q7xbkzoEzrwsIGXXWRq0MkOShQc6d1YkSJDJSWmTmGL23FlveBqyRVH\nuzrid8drO3P/29DYu2g/96KWDTn1tsAp/sub1CVZWypSt92g5BMQaVOG\n-----END RSA PRIVATE KEY-----\n",
      "ingress_certificate_cn": "ingress-operator@1733424046"
    }
  },
  "release_registry": "quay.io"
}'

encoded_manifest=$(echo $base_manifest | jq --arg ps "$pull_secret" '. + {pull_secret: $ps}' | base64 --wrap=0)

echo '{
    "apiVersion": "v1",
    "data": {},
    "kind": "Secret",
    "metadata": {
        "labels": {
            "image-based-installed.openshift.io/created": "true"
        },
        "name": "ibi-cluster-seed-reconfiguration",
        "namespace": "ibi-cluster"
    },
    "type": "Opaque"
}' | jq --arg manifest "$encoded_manifest" '.data."manifest.json" = $manifest' | oc create -f -
EOF
