#!/bin/bash

set -o nounset
set -o errexit
set -o pipefail

echo "************ image based install create identity secrets command ************"

source "${SHARED_DIR}/packet-conf.sh"

ssh "${SSHOPTS[@]}" "root@${IP}" bash - << "EOF"

# prepending each printed line with a timestamp
exec > >(awk '{ print strftime("[%Y-%m-%d %H:%M:%S]"), $0 }') 2>&1

set -xeo pipefail

cd /root/dev-scripts
source common.sh
source utils.sh
source network.sh

# Create namespace if it doesn't exist without throwing an error code
oc create namespace ibi-cluster --dry-run=client -oyaml | oc apply -f -

# Note: this must match the kubeconfig in the verify reinstall step
tee <<EOSEC | oc create -f -
apiVersion: v1
data:
  kubeconfig: Y2x1c3RlcnM6Ci0gY2x1c3RlcjoKICAgIGNlcnRpZmljYXRlLWF1dGhvcml0eS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VSUlJFTkRRV2xwWjBGM1NVSkJaMGxKVlRWaE5XdFBaMlJsY21kM1JGRlpTa3R2V2tsb2RtTk9RVkZGVEVKUlFYZFFha1ZUVFVKQlIwRXhWVVVLUTNoTlNtSXpRbXhpYms1dllWZGFNRTFUWjNkS1oxbEVWbEZSUkVWNE9YSmtWMHBzVEZkR2QyRllUbXhqYmxwc1kya3hjMkl5VG1oaVIyaDJZek5SZEFwak1teHVZbTFXZVUxQ05GaEVWRWt3VFZSSmQwNVVSVFJPUkVFd1RsWnZXRVJVVFRCTlZFbDNUWHBGTkU1RVFUQk9WbTkzVUdwRlUwMUNRVWRCTVZWRkNrTjRUVXBpTTBKc1ltNU9iMkZYV2pCTlUyZDNTbWRaUkZaUlVVUkZlRGx5WkZkS2JFeFhSbmRoV0U1c1kyNWFiR05wTVhOaU1rNW9Za2RvZG1NelVYUUtZekpzYm1KdFZubE5TVWxDU1dwQlRrSm5hM0ZvYTJsSE9YY3dRa0ZSUlVaQlFVOURRVkU0UVUxSlNVSkRaMHREUVZGRlFYcDFWbW96Y1hWalZHOVVjQXAyVDNSaFozQnRiWEppU0RaMVJHVXZVa0pRTjBJMGNGSTBiMHROWWpOVlRqUlhWVlYwZVdkaGJESTBkMVZuWmxacVNGbHVaWEpvVjFSbU1XUlJaMm81Q2s5R09ITnFlVk15WmxkTE5YTlRhRkJCYURWbVdrcEdNakp2ZDFFeVIzTnJaSEUwV0VWNVJXaGtkVzlUUmxWRWNEQTFkV3BqUW1GSVZGVnpNMlZrTlZjS1dYRmlaMHRQU0ZRek56Slljbm92YnpOa2RqQTFaa0U0VFU1VGRHb3hkMVZCYkdST1dpdEtVSFl5Y213dlV6UXlTVXMyWm1WUFdVTmFXVzVvT1hsNVNRcHBPRWxWUzBZMFdIVXJXbk5uV1hwQ1NWVjNNa0p4U213NVExVkhWM1p5VDI5TlVVWTJSMnhJVEZCVlowWkljbVJ4VWtONmNHTlFRVXBNVUhsV1pFRnlDbGRNTkVOT1NucE1lRzgzZW1acFRsYzRSa2ROVnpkcVZHWnZVbXRrV1VaUU1FeERUa3BRTDNOM1VuVk5OM0Z6UmxSRVJFaFhRM1JFV0VNMVFuTTBkWFVLVFd0bVRYVTRSM2d4VVVsRVFWRkJRbTh3U1hkUlJFRlBRbWRPVmtoUk9FSkJaamhGUWtGTlEwRnhVWGRFZDFsRVZsSXdWRUZSU0M5Q1FWVjNRWGRGUWdvdmVrRmtRbWRPVmtoUk5FVkdaMUZWZEZoRFYyOVhSRGx1WVZsV2N6SXljWEZVVG1wc2RqRjVVbmgzZDBSUldVcExiMXBKYUhaalRrRlJSVXhDVVVGRUNtZG5SVUpCUkdsdWNpdFJMM0J2SzNaeFVGQkhUbUZuWjBJdk1tdExWSGh4U1hsbldUWTVMMFpSV1ZKcWFtNDNaVEpRTkZaNFdqTlJiME0zZVhwck0zZ0tSMjlJUkc5alUzUlllREI1UWl0V05teGFTMlJaUlRsWVNXaHJNVEI1UWs1cVVYbExOMFp0Tm1aVGMxY3lSMWszTHpJeEszWndWR0ZLYjBSSlVucE5kUXBSZVdzNWJtaERkMDVWWTNkNmFtRnZPVWgwZFZkelNDdDZTazAxYzFRMWNFRlVXbWh3YkZZNGNIRjJha0kwZVVaM1NsVjRUell5T1Zsb1FrUnVOekpxQ25ORVN6WkpTWGw2YURoclZEVmlUMjl0YkVKNU9YQTFkazU1WTJOaGVXZzVNMk0zY1d4RE9ERllVazFyWkdjNU5GVkNRMVpHZVZkaE5tTk9jMmxHTkU4S2IxaHNkRTB2VGl0V1lsRk1WVTFOYkVKMFdFZzVibEJLZVVwR2JqUXpTWFZEZUVGcWRtaDVUMGhoYzJOS01WSlpVakpsWkU4MGRqRTVheko1Wm5KeWNBcGxVR0pNYmxGSU1XSXJZbWRDV0c5V1dIbGFXR2d2TjB4d2FtczlDaTB0TFMwdFJVNUVJRU5GVWxSSlJrbERRVlJGTFMwdExTMEtMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VSVVJFTkRRV3BUWjBGM1NVSkJaMGxKVjA4NFVrbFFLMUZ2YXpSM1JGRlpTa3R2V2tsb2RtTk9RVkZGVEVKUlFYZFNSRVZUVFVKQlIwRXhWVVVLUTNoTlNtSXpRbXhpYms1dllWZGFNRTFUTkhkTVFWbEVWbEZSUkVWNVZuSmtWMHBzVEZkR2QyRllUbXhqYmxwc1kya3hlbHBZU2pKaFYwNXNURmMxYkFwa1NHUjJZMjF6ZEdNeWJHNWliVlo1VFVJMFdFUlVTVEJOVkVsM1RsUkZORTVFUVRCT2JHOVlSRlJOTUUxVVNYZE5la1UwVGtSQk1FNXNiM2RTUkVWVENrMUNRVWRCTVZWRlEzaE5TbUl6UW14aWJrNXZZVmRhTUUxVE5IZE1RVmxFVmxGUlJFVjVWbkprVjBwc1RGZEdkMkZZVG14amJscHNZMmt4ZWxwWVNqSUtZVmRPYkV4WE5XeGtTR1IyWTIxemRHTXliRzVpYlZaNVRVbEpRa2xxUVU1Q1oydHhhR3RwUnpsM01FSkJVVVZHUVVGUFEwRlJPRUZOU1VsQ1EyZExRd3BCVVVWQmQzTTJZVXBMTm1KdlIzbEVXa3RZUlRCTFZXbHRTMkl4YUdodldIQkNkMWd2T0N0M1dVSmpNMDV1VWxKTFpIbEVkMGh0VVhWbmEyODFVakpOQ2xOSk9WaHRWM0YwZFZodE9ITm5MMUJYZEZkWmFtcG9ZVVl2U1RoVVpXSkxUMUkxTjB3ck1rRkxWSE53VGtkMFNVTjFXWE4xZUZWblNITmFZMmQxT1dRS1dXOHJlbk00ZG1ocFMzVjBRbUkyUzBkbWVtUlVSbXRLVldGM2NtUmFSWGRFVjNwUFpsbFJZemhFZDFCd2IzTmlhbVJDVTFoMFVGYzRhR2hNVERCdFVncG1hUzk1Uldod2NIcERRamd6VTNaRVptRk9RM2cyZERrdlFuTkRVMDVKUlhkcVNIUlJUbVJDU1dGUk5HOXJiRXhGVm01VFVuRmFXVUo0UzJ4Q1pWa3pDa0ZtVm5SbEsza3hPVEpZVERSbFJqRnZLMDkxZVZkNmFUVkdVWGRKUWpaT1psWkZTa0V3WlVGSGEyRkNRbTA1WTNCbU9GVmtia0ZwYlRkeU1GWTFUMmtLU2xOU1lrMHhjV2RGV0haeVpETm1aa2t5TjFCaVQwcFJhWGRKUkVGUlFVSnZNRWwzVVVSQlQwSm5UbFpJVVRoQ1FXWTRSVUpCVFVOQmNWRjNSSGRaUkFwV1VqQlVRVkZJTDBKQlZYZEJkMFZDTDNwQlpFSm5UbFpJVVRSRlJtZFJWVnBNVFRoVVRVVktVVTR5WVVSaGJVTkliMU5aS3paRVpXOXdZM2RFVVZsS0NrdHZXa2xvZG1OT1FWRkZURUpSUVVSblowVkNRVXRaUWxRdmJUYzBSMWhzY2xWNFYyMXhaVnBtUzB0Sk0yZE1kMGhMV1d0eVUwVXlWV3c1V1hCVGJWUUtaSGhTVUZCYU9HMDJXbnBZVG1WaVJXMVBXSGRMYUdReFRIbzJUbFZqUkV0NFVEUk5ZVWs1VDFWclZqZGlRVmxDYzBwWlptSkxSMlpNT1dNNFpIcFNUUXBSWVZFclF6UjZNMjl4VkdOUlVrOXZjbGRzTDIxalFqSXJkREpSVm10VVkzZDRXbVJ5ZUZrMVFXVkpaMjlCVWxFd1FWbEhkVU54ZURWUGJrdEZRWHBuQ2tscGJteGtNQzhyZVZvM2VtMHhXVEZ2SzBWbmFuQnZWM0l3ZVVGd2VIYzRibkZ4Y2tSb1FtSm5NVU5XUVM5S2NqWnhTM05rTVUwNFkzUlBjbVZTVDFRS1VFRk1UalZRUTNsUVRIRnZUbGgwUWpod05EZE9MelprZEhGVGFVZFZaQzh4T0doWFkyNVhSMUYyTTFod2VIZFRkRGhHWVZSR2J6VTJTVFZuVkRWcFJ3bzJNa1ZVVVVwalZXdFpWMHR3YVRCMldIVnpVRFUzYW1OQlNVSk9aSEp5Y0dKWGRGVmFTbTl3VTJsUlBRb3RMUzB0TFVWT1JDQkRSVkpVU1VaSlEwRlVSUzB0TFMwdENpMHRMUzB0UWtWSFNVNGdRMFZTVkVsR1NVTkJWRVV0TFMwdExRcE5TVWxFVFdwRFEwRm9jV2RCZDBsQ1FXZEpTVmxqUTBreGVuQkllRWxSZDBSUldVcExiMXBKYUhaalRrRlJSVXhDVVVGM1RucEZVMDFDUVVkQk1WVkZDa040VFVwaU0wSnNZbTVPYjJGWFdqQk5VMFYzU0hkWlJGWlJVVVJGZUdoeVpGZEtiRXhYUm5kaFdFNXNZMjVhYkdOcE1YTlphVEY2WVZka2RWcFlTWGNLU0doalRrMXFVWGhOYWtFeFRWUm5NRTFFVVRGWGFHTk9UWHBSZUUxcVFYcE5WR2N3VFVSUk1WZHFRVE5OVWtsM1JVRlpSRlpSVVV4RmQyeDJZMGRXZFFwak1taHdXbTVSZUVsVVFXWkNaMDVXUWtGTlZFZEhkREZaYlZWMFdWaENjR015Vm5sa2JWWjVURmQ0YVV4WVRuQmFNalZzWTJwRFEwRlRTWGRFVVZsS0NrdHZXa2xvZG1OT1FWRkZRa0pSUVVSblowVlFRVVJEUTBGUmIwTm5aMFZDUVUxNU1tMWFUa0ZYVjNkSmJuSndjelpVTUVSMFVtMVpSMWRPY1hZNWNWb0tWV00yYmxSTFJ6ZHBUM2w2YlhsdWFTdFhaSEU0WldwcU9XbE9LMDVMVDBwNFdHZFRiRlZHZVVkMk5sWXJlRTlJYldOVE56WkVPVlZHWWtWRFRFbFhOQXBOVjNaNllUTjBZbVJsYzNaM1NIWjVhV2RPUldwMlpXdE5RVEIxTDIxTlowNUpUVFJyVjB4blNERnlXbVZaTkN0WU5rTm1lRmR0WjBkc1FXOVdibE5JQ2xsTFRFcHJZWEZ3Umxvd05IQlNUR2QxVWtGelNFTTNlRzh4VURWR2JEVTVjRGxSVVVacldVOTFUalpQUm5jNFMzbGpjRmxEVFZBeGFUSTRhRUYxVXpZS1RXNHJhWEZqV1dsTE4wSmhUak5yVDNWSmQwTjZTa1IzY0VsblRreFVOWEZ3VW1oUWJFWjZZWFJvV1ZWMlJGTTBaazVQV1VoaGFrRm5LMVZGYTFOb05ncGlSVmhGVTNJdlkxTjVMekozUWpKNVEwZGljbEZyV1Vnek5rTjNiVUU1TTJsdE5pdG1NREYwTTBNelVXNXFjMUZYZGt0SVZGa3dRMEYzUlVGQllVNURDazFGUVhkRVoxbEVWbEl3VUVGUlNDOUNRVkZFUVdkTGEwMUJPRWRCTVZWa1JYZEZRaTkzVVVaTlFVMUNRV1k0ZDBoUldVUldVakJQUWtKWlJVWkRVbVlLY1ZCRmJsWnBkVUpoVWxkVllVMVZNalJIVkd3eGJHcDFUVUV3UjBOVGNVZFRTV0l6UkZGRlFrTjNWVUZCTkVsQ1FWRkNabkJpYjFZMU5HdEhXa2N6UlFwWmVVdGtWRFZWWTFkT05VdEtlWFFyYm1KRFdHd3dUV1V2UmxZNFJtdDFMMFpoTDBaR1FtSm1XbFpZVlRsd0swNUhOV3RDV1dGWWVsRjJUazh2VFVKYUNuVmFiVWxVY1VwSlJtaGxVRmx3WkdGV1FtMUZWVE5aUjNwa1dqbHZiak5GYTNsbGFUWTNVMkZTTVVjNE5URXlTelJuZG5NNFltUXJZbmRvYlhwVVpsUUtiMWRYY0ZCQk0yWnVlSEEwYVdoUEsxbEVhV1IxSzBFdlRXZDRjbkJrWVhWaGVrOVBhbUZ1UlZwa2IybFdTakVyYkRONVlqSnZObWN2TTA5VlFXOU5WQXBVVkhObGRUZEJkVUpQTkdOb1dXczRXalYyTTB0UmRscE9UMWN4YmxoS1VqbEVVbUZ6VkhGTllsaERabWs1ZDBNMlJVSkVNemMwY1hReVJXRjRlbUpuQ2tSVFpDdEZWRXhXZFdOUFNYTkpjeXRtVkN0bldIRjJWR05KZUVoWVYxaEVRVUV2UkhOUGJFVkhVMnBEWjNVMlNuWTNLMU14YW5WNlRYZzViRUpSWm5ZS1pYUnhkRVoxTDBvS0xTMHRMUzFGVGtRZ1EwVlNWRWxHU1VOQlZFVXRMUzB0TFFvdExTMHRMVUpGUjBsT0lFTkZVbFJKUmtsRFFWUkZMUzB0TFMwS1RVbEpSRVZFUTBOQlptbG5RWGRKUWtGblNVbGFUV1JIYkdWbmNtcFpOSGRFVVZsS1MyOWFTV2gyWTA1QlVVVk1RbEZCZDBwcVJXdE5RMGxIUVRGVlJRcEJkM2RpWVZjMWJtTnRWbnBqZVRGMlkwZFdlVmxZVW5aamEwRjRUbnBOZWs1RVNUQk5SRkV5VFVJMFdFUlVTVEJOVkVsM1RsUkZORTVFUVRCT01XOVlDa1JVU1RKTlZFbDNUbFJGTkU1RVFUQk9NVzkzU21wRmEwMURTVWRCTVZWRlFYZDNZbUZYTlc1amJWWjZZM2t4ZG1OSFZubFpXRkoyWTJ0QmVFNTZUWG9LVGtSSk1FMUVVVEpOU1VsQ1NXcEJUa0puYTNGb2EybEhPWGN3UWtGUlJVWkJRVTlEUVZFNFFVMUpTVUpEWjB0RFFWRkZRWGRpUkZCcmJrTnBLM1JOUndwWlptbEpZMVE0UjFVeU56WjJXbkJNY1ZOQk5FaE5hMUJGZVdadE5XcFBkR2RoTVRCRU5ISlJVakJDTlU1a015c3daMDVhY0hwSlMxRjFWSEpYZGsxUENtRk1RalpZVEV0VldYcEVRWFEwTjNFeVZVbHdiRGRZUTBJMlFXeGxOMHhVT1VkRWJHczBaMUo2ZDNocGNGUTNSelpGVTFoUWFYQnRMM0IwYURjd05sUUtWVk5USzA5WlNGUmhNWE4yUzFFMk5GWnhaWFF2YlVOUVUzcFhNRVZLVkV0d1JVUlRNVUUzUlhreE1reHpiQzlaYkcxSlNFdHhSRTlaZUdOclNWTkVaUXBPUzBZMmVUQjNkbFF2TDFONlNUQXdXWEJIUlVwaFZGSlZha1JGZFRKa1kzTXpiRkZqWmxaUlRpdGtVVE4zYkhSWFYzQmFaV3BvYUVOR2RtOVBUM1paQ2s5d05tSkJjR0pWVFhKME9VcHlVMU5IWW1RM1NpdDFMMUJIT1UwMVUwbHlVMnhSY1VSYVVsaDZaRGhQZFRCRVlXTk5kVU54VjNoSlpscEtTbkJITmswS2RtWlBXVTl3VkRKd1VVbEVRVkZCUW04d1NYZFJSRUZQUW1kT1ZraFJPRUpCWmpoRlFrRk5RMEZ4VVhkRWQxbEVWbEl3VkVGUlNDOUNRVlYzUVhkRlFnb3Zla0ZrUW1kT1ZraFJORVZHWjFGVmJYZDFOMWt6YzBWbWIwdHJNakY2VFRjNU1WaDZSamh6Um0xcmQwUlJXVXBMYjFwSmFIWmpUa0ZSUlV4Q1VVRkVDbWRuUlVKQlNURlFibnBXZVZjd1ZIZGFaQzlNYlRWUGNGSlpLekpvV1dRdmIyMURZaTlYZGxOWE5WcDJhVU13YkVOS09GVjNZWFE1TVhWb2NqTXdhbmtLYURkb2EyZEtOMW80ZFc5SFVXMU1iamhPZGpKeE9TOUNkRWxGU3pBM1lVcHdUMVJVTlhwWWFscFNTMFpRTDBKNVMybFhkVEZwY1RGa2VrSjNOM042YXdwd01IVXJkV1ExYURsNmVXcDBObnB3TkU1RU9VTjJWR280UTFONlNYTnliMEpSTUcxaWVHUnFaMWQxTWtZME1EUkxaRWhPYm5sNk9UVTVhVU5rYlhkeENscFpaazV0T0ZrNFJtSnZlV2hqYkZFd1RISlZjMWhFUjNCeVdYVmhSbEJCUkRkME5uTllPSGhDUVhNNE1rdGhWek5DWVRGQlYwZFZZbEIzWVZCR0wwOEtVMGx4U0hKUE0wVTRMM2R2YlRoRmFrbGtTRUpMUmpOb1FqWkZiVFp1UzBablkzWnliazFoY3pGTFpGaDJOSGhHYVV0UFVEWnZZMFY0YkdjNVdIaEdXUW9yZUZKeFpGRk5kVXBNVGpCcFIxTnpMMWwwV1VscVpGTkdkMVU5Q2kwdExTMHRSVTVFSUVORlVsUkpSa2xEUVZSRkxTMHRMUzBLCiAgICBzZXJ2ZXI6IGh0dHBzOi8vYXBpLmliaS1jbHVzdGVyLm15ZG9tYWluLmNvbTo2NDQzCiAgbmFtZTogaWJpLWNsdXN0ZXIKY29udGV4dHM6Ci0gY29udGV4dDoKICAgIGNsdXN0ZXI6IGliaS1jbHVzdGVyCiAgICB1c2VyOiBhZG1pbgogIG5hbWU6IGFkbWluCmN1cnJlbnQtY29udGV4dDogYWRtaW4KcHJlZmVyZW5jZXM6IHt9CnVzZXJzOgotIG5hbWU6IGFkbWluCiAgdXNlcjoKICAgIGNsaWVudC1jZXJ0aWZpY2F0ZS1kYXRhOiBMUzB0TFMxQ1JVZEpUaUJEUlZKVVNVWkpRMEZVUlMwdExTMHRDazFKU1VSYWVrTkRRV3NyWjBGM1NVSkJaMGxKVEhsSU9HMUtaRU5zTmsxM1JGRlpTa3R2V2tsb2RtTk9RVkZGVEVKUlFYZE9ha1ZUVFVKQlIwRXhWVVVLUTNoTlNtSXpRbXhpYms1dllWZGFNRTFUUVhkSVoxbEVWbEZSUkVWNFpHaGFSekZ3WW1reGNtUlhTbXhaTWpsMVdtMXNia3hZVG5CYU1qVnNZMnBCWlFwR2R6QjVUa1JGZVUxRVZYaFBSRkYzVGtSYVlVWjNNSHBPUkVWNVRVUk5lRTlFVVhkT1JHUmhUVVJCZUVaNlFWWkNaMDVXUWtGdlZFUnVUalZqTTFKc0NtSlVjSFJaV0U0d1dsaEtlazFTVlhkRmQxbEVWbEZSUkVWM2VIcGxXRTR3V2xjd05sbFhVblJoVnpSM1oyZEZhVTFCTUVkRFUzRkhVMGxpTTBSUlJVSUtRVkZWUVVFMFNVSkVkMEYzWjJkRlMwRnZTVUpCVVVSQmNGUk1aVU5IWVhvMWNrRkZSMU5PU0RKUWVVZzVhak4xTUV0TFNEbE5lVWh6VEM5U1UycFlWQXBHVEZGbWFscGlOWEkyVUZoVVNFeENjM0pJWkNzcmFreFFOMnh1YjFaUWQxcFRkRTkzWjBkQ09HeE9UbWRTWTJ3M1dUVjZOVXBCTlZkTFVHTkxkRmxNQ2tsRFluQlNjekV3TVc5TFpFTnJXa3BpVkhka1ZqQnRTMGR5ZW14S1JrWkllbVpITjI1eFkxSXhPRlpTVFVOSWMwMVZVRXd5U1cxdFVsQnllRFJwWWxvS05UUlZWM2x0V0RGbU5VaHBNRUp3ZUVzM1RtWm9halYwZGtGb2JHWlpWR2h2YjJ4NGVEUXpMM1k0TTIxTWFtaFVkSGhCVEZwVFMxTlVTa2dyWTI0d09RcHRUeXRJWlRZNVFTdEZiWGhZUjFCS1lWSmxkRFZIUjJveFFXaDFVR1pZTDNOVGEzTkhlbTloWkVoak0wVlNNRFZNYWtKaFdWZFJSbWhtYWpaNlQzZHpDamhMV21KMFNrdFlVSFp5TldRMEszZE9PWGxpZVUxMVdsZDZPRTlTZW5jeE4ydzJNRmhQTUVaRU5sQkVRV2ROUWtGQlIycG1la0k1VFVFMFIwRXhWV1FLUkhkRlFpOTNVVVZCZDBsR2IwUkJaRUpuVGxaSVUxVkZSbXBCVlVKblozSkNaMFZHUWxGalJFRlJXVWxMZDFsQ1FsRlZTRUYzU1hkRVFWbEVWbEl3VkFwQlVVZ3ZRa0ZKZDBGRVFXUkNaMDVXU0ZFMFJVWm5VVlZpVFhoWVpTdHlaR1lyTlM5T2VtcGpRVkEwY1doNlEzWnpRMVYzU0hkWlJGWlNNR3BDUW1kM0NrWnZRVlZEZWxFeU5tdHZWekJvU21sQmNWb3hUbGxYVTAxelNHbENURFIzUkZGWlNrdHZXa2xvZG1OT1FWRkZURUpSUVVSblowVkNRVXRvVERGaGNVY0tTRFV4WlVwNWFucEljMVJYUkRScFFWSjNia3BUUWxkM1pXUm5SRGh0VTNGU1JuTnRjMVZYTDNBNFpqVk5SV1ptUWxSS2JDdE9hekp2TkV4aGMyWTBXUXBGUVZGVmMzRkZabTF6UVZaNVVqaFJTbXRNWVhjeVVFdzBlV1p0Y0c5cWFHNVRWR1pKYVZFelEwSm1Ua2RxTkRWR1IwUTVLMFpEVlU4MGIxaHRTakJIQ21kbFJFRTJPR3BGU1U5VFoySTNUMll2V1VRNWFVNHdZa1pyZWxaclJVbHJUM055YkU1NVZXOUdiM1JKZUdWMlprSk9aekZWZVZwYVVFWlJXRlJzZVRNS1lqZHFXbXhsVTBaV1VDOVZTbEZLYlRkWFZIQmthMGxuVWxvck0xZGhibHAzTld4bk9UVnlNVk5JU0had2J5dGhhazR2WkdwaU15dFBlbTVPT0U0eFpBcG5ZMHB1WVVKWk5HMW9WeTkyUTFkVlFuUjNUbkptTDBSTldUUnhNalpTSzFGdmVFUkVZMk4xU2pWT2IyOXRhekpRVERobFNWZDJUVWx3YTNrMmVFMUZDazE0T1VGdWExUlFSWGxMVm1SclZUMEtMUzB0TFMxRlRrUWdRMFZTVkVsR1NVTkJWRVV0TFMwdExRbz0KICAgIGNsaWVudC1rZXktZGF0YTogTFMwdExTMUNSVWRKVGlCU1UwRWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRcE5TVWxGY0VGSlFrRkJTME5CVVVWQmQwdFZlVE5uYUcxeksyRjNRa0pyYWxJNWFqaG9MMWs1TjNSRGFXZ3ZWRTFvTjBNdk1GVnZNVEI0VXpCSU5ESlhDaXRoSzJveE1IaDVkMkpMZURObWRtOTVlaXMxV2paR1ZEaEhWWEpVYzBsQ1oyWktWRlJaUlZoS1pUSlBZeXRUVVU5V2FXb3pRM0pYUTNsQmJUWlZZazRLWkU1aFEyNVJjRWRUVnpBNFNGWmtTbWxvY1RnMVUxSlNVamd6ZUhVMU5tNUZaR1pHVlZSQmFEZEVSa1I1T1dsS2NHdFVOamhsU1cweVpXVkdSbk53YkFvNVdDdFNOSFJCWVdOVGRYcFlORmtyWW1KM1NWcFlNa1UwWVV0S1kyTmxUaTgzTDA0MWFUUTBWVGRqVVVNeVZXbHJhM2xTTDI1S09WQmFhblpvTTNWMkNsRlFhRXB6Vm5ocWVWZHJXSEpsVW1odk9WRkpZbW96TVM4M1JYQk1Rbk0yUjI1U00wNTRSV1JQVXpSM1YyMUdhMEpaV0RRcmMzcHpURkJEYlZjM1UxTUtiSG8zTml0WVpWQnpSR1pqYlRocVRHMVdjeTlFYTJNNFRtVTFaWFJHZW5SQ1VTdHFkM2RKUkVGUlFVSkJiMGxDUVVNM1ZHVlBkbFJoZGs1eWNsaHJlQXBwZDNaYWVVaG9ZaXRITTIxT1RIVk1Wek5RV1VkTFowMTFPSGxXUTJKMGNIUlVjak0wU1VacGVXSnZabUl6UTJZelRsRmhjSHA0ZWxWSE0zTnBXSGhhQ2xZdmFEUkxTblE0VGpFME1uZG9kVlpuVTBWUVZreFZaR3BITW1vMFVrWjFOMnd6Y1VSc1IxSjJPR1l4VkRGc2NXTkRkWEp0UTB0NWEzcGpOamRtYkVjS09WTkZNMHN6Vlhsc0szaE1hRlZyTVZaNlFXUk5SVzh2VTBkYVMyNXNOV0ZEUm5GMWNHdFdTV3NyTUdRMU4xa3JOQzlRWkV0R05ETkhiSE5UZDBzelZBcFBVbXh6YUVNM2VqWnplbEJOUlRWc2JubHBkRmRaUjJzeVdYUmtiRmsyV1VOTUwyNTVaMnRKTVd0U1R6bDFWMEZwUkROSlVIQlNjRGxaZDAxdlprSXhDbkoxY25WYVdHVlROSEIxVTJNeFMzTnJURzVWVUUxT1lrUTBaMDVxZGs5cE1UaExaMEZsTWpSblJGbGxXakozYWpjdlJGbHBjWHB5V1VGMVMwSnhOV2dLUTB0UVVtVkdSVU5uV1VWQk1XNWliQzh2ZUVSd1prWXJVV2hSUjNwNlpHMXhUbHAxUTAxUUswRjBMM05QVmtWclEwdHRXVmxEWVd3d1NsRnpLMDkzTndwU1ptRjFPVTFFZERRMVIyWk5UV05KT0c5TFZqRXdaM05UTDFKaVdtbFJLMkZzTkU0dlFVMTFjakZXU1ZWdGFXVk5ZelIzVjFaaFQzRnJXRFF2TlVONENtUXhOSGhGUkcxUVZUWnhWMlozTlRWMGRtWnplbkYyZEVGMVkyaHRVblZsYkVsVmRGTjRhemhvVjI5b1NIWjRjblZ0WjJ0cFJqaERaMWxGUVRWbVUwUUtSVXhHY1dOcGJUSm1XRzFtYkhvemJuTkZiWEV3VTBseFZ6ZEZNakpQYVdWb2FrZHRRVlJtUlRkb1YxVm1SMlJLZVU1WmNUZDJNVEIyUjBaVWMxSTRUQXBoYlRZM1VVcDVhR2d3T1VSek9XZHNSbWMzYlRJM1luWllSM2syYTNCMWFqTnJaU3Q1YjBVd0wweHlRV1ZVT0hnNFZqZzFha1Z5TTFOcWNWbDROR3RqQ21SdGRVd3dkekpEYmt3dllWTXZTR3BuVTFvNU4xTTRiWFZoVWxVcllWVTVjbEUwVm1KNE1FTm5XVUZNTWtveGVuVnNaSGxRZUdsbFVtTlVjV2hWUkdrS1lYQllRbGhxU1ZaeWNFTTFlV05YV0hoUFduQjVWR2t6WjB4bVRFOURSU3REUWxrMU5YSTBPVW8zYjBoVk4yTnRlbWhtUVhkSVpsSTJhbXg1VG5WYVRBcHpZelZNT0ZaRlR6RnJUV05oYWt4NWVGWlVaVmR0TW1VNGFXRkRNVEZqTWtwTWJrcEVObFJtUm1wcmFEUTBZazV0U0hjMFNHbzRSbEJuWTFwRlprWTRDbVZ4TmpWNWVtTlJiRFJCYXpKblUwcFZNVGxTVDFGTFFtZFJRMlppWW1WVk1HcDRibkpETTJWeWJqQk5RVnB3Y0dGYWJYQmFlRTlTUVV4MGVrSlZkM0VLTkRZNGFFNTNXWE4yZGprd2FFeFFkVXg2V1ZNdlpIZzJXWE4zUVdndlMwWk9kMHBUUjBsWlVUVnpObU50UzFkV2RHNHdkVXBhVjNOTllVaHJNVlV4TWdwYVlUSk5abkZ2TmpocmRGSm9TbEJsYzJSUFdGSmlOVkJWTTB4eVNFVXJSV1J4YlRWcFMzUmxaVGxGWjFORVRXZE1iM2wwTjJKMlpXZ3lWakp6TmpabkNrWmFlV055VVV0Q1oxRkVVa2xRVGk5Mk1YUXhTRU5GVkdkU2JEWndaVUo1V0ZoRU1VbHliMVZMV0RacmVqY3hjV05XVFU1c0wxaFlkRk5KV0RacmQza0taWEZuWVVjeldVUlllR3h6V1d3emVqazBhREF5TlN0TVVFNVJkbmw0UzNFM2JGZGlVSE5hZFM5R1F6QnRVRTFVVWxnd016bGhaRFpzY0ZkVFNrNTFOd3BWVUZOUmNXTTFhVWQwYm1zd2NqZFpSbXBRZUhjeWRHSlFLMDFxVjFKdFVUQjVXbEZIY2xvemNrNTBNemRIZGxwWU0wSm1MMmM5UFFvdExTMHRMVVZPUkNCU1UwRWdVRkpKVmtGVVJTQkxSVmt0TFMwdExRbz0K
kind: Secret
metadata:
  name: ibi-cluster-admin-kubeconfig
  namespace: ibi-cluster
  labels:
    image-based-installed.openshift.io/created: "true"
type: Opaque
EOSEC

tee <<EOSEC | oc create -f -
apiVersion: v1
data:
  password: SUFnSE4tYXZMWHAtc3YyWXEtN3hVVTg=
  username: a3ViZWFkbWlu
kind: Secret
metadata:
  name: ibi-cluster-admin-password
  namespace: ibi-cluster
  labels:
    image-based-installed.openshift.io/created: "true"
type: Opaque
EOSEC

pull_secret=$(cat $PULL_SECRET_FILE)
base_manifest='{
  "additionalTrustBundle": {
    "userCaBundle": "",
    "proxyConfigmapName": "",
    "proxyConfigmapBundle": ""
  },
  "api_version": 1,
  "base_domain": "mydomain.com",
  "cluster_id": "5060b48d-da28-4d38-a361-aa850ababe6c",
  "cluster_name": "ibi-cluster",
  "hostname": "ostest-extraworker-0",
  "infra_id": "ibi-cluster-4t7rm",
  "kubeadmin_password_hash": "$2a$10$33JHQT/CnhIWUtqFjkXCWeuD4VAh6chmVx7Waxk3r/CoAkhta6HJK",
  "KubeconfigCryptoRetention": {
    "KubeAPICrypto": {
      "ServingCrypto": {
        "localhost_signer_private_key": "-----BEGIN RSA PRIVATE KEY-----\nMIIEpQIBAAKCAQEAzuVj3qucToTpvOtagpmmrbH6uDe/RBP7B4pR4oKMb3UN4WUU\ntygal24wUgfVjHYnerhWTf1dQgj9OF8sjyS2fWK5sShPAh5fZJF22owQ2Gskdq4X\nEyEhduoSFUDp05ujcBaHTUs3ed5WYqbgKOHT372Xrz/o3dv05fA8MNStj1wUAldN\nZ+JPv2rl/S42IK6feOYCZYnh9yyIi8IUKF4Xu+ZsgYzBIUw2BqJl9CUGWvrOoMQF\n6GlHLPUgFHrdqRCzpcPAJLPyVdArWL4CNJzLxo7zfiNW8FGMW7jTfoRkdYFP0LCN\nJP/swRuM7qsFTDDHWCtDXC5Bs4uuMkfMu8Gx1QIDAQABAoIBAQCnLB6IGy3PHAIp\nDhoyEKjnDDpDg3feMC7TpuYHGekTXgd7KcuVOqhR10zf20inmAjKVgwWNDSYWN8S\nH4THnKh/o7fa93Dvi08U2ZypdideVyQ9aOloIYsCpJs75RmKS+XBedKVl8MZi5dN\nWv0gy2gBDxZzGja0nTfCW1ynMBGVFSM1H/P7XsD8OTN97MUuKKGFpctMsZzlCOnN\n4T1Us9KZhIIKAsZlGFTYHBpbED3C3lrcH6mXINLHPWGbcSkV0XuOBIMJNbpps1rY\nTmzEXhy0nOM9WikaX1K9hW77AT+d/KAaPvALy0YH9ZgJRqeAwzFwj6/nc/NFDjME\njBOHFXG5AoGBAO+oW7zDaK1uAGfdPT4Ivqpj4mVM1bqw6F/sfxZZetiUJQWKrrXi\nFg/ezvYcKzL11eb3IqiSLrk2DVwwaMQ/9tfg8N/gStU4+bpq4+NH4+7nQVO1PKKz\nV7ECNDZkPZuehiIJKTErmh/0Pl27WYEzpHADTb7wZWq8r9K0cdUC79RzAoGBAN0B\nHv7mEv0aYWVPLAVG95Zp8C880mO/3wxduzxu3I8tXiAb7H8tFD2v7blZg+HTQGUB\nmCHevXXhF4Fnivw+q/TkBkegsf+si7Lri3NUR7G+/f4uB51FtHB6CIM6FezcENYg\nt9ZKTygWOQctXmkOHzVxk3szgNorYdPXBmD68JaXAoGBALo/6SuF4bAGsSIG+jVf\nrm3VOnjngaKZIb6KmSnRWHtAhpUL9kM79VFYIxd5RMlR7G6W2cSP9ufRbgibRpBd\n9YRIOGqEcSPMJ6gMshZMJIPiDQ705q67GgdiYxlyRb7PMAb7f5vK+viiZGWL2D9k\n1wKGTsF5KhgNk8b4nQ6iPaipAoGAAfL6lQDudfD/nucd2kYP9PGmPqRorpyImRFS\nj2vi4hhiViIo6c45+XlNvW6+rQUx8jIbZ2ERhrKfhHKnVSYwWg6Qx5zxNPIOoVtW\ndYPuxfCLSOybAJYWy08oOBARFW+zblAHjwpEvHPFuPx7cq2/NLd1t4ZywnnTeQzS\nb5SG/q0CgYEAw8lSHlmH0PD/nErZTHyAvk/z0y8loAXJFO0AHQ4oRXIC9sosXt1Q\nKGdYCvtAUUrEmqlvAzQX4Ey/9fxIjJesP+hyjiJ3duAUn4GP4ZOJUT7CWTYHaOH4\ncySiIXeWX+IrebGSRyVQWzk6DvqcpxBQNN5V19PwPpWznDS4jvBwq3I=\n-----END RSA PRIVATE KEY-----\n",
        "service_network_signer_private_key": "-----BEGIN RSA PRIVATE KEY-----\nMIIEogIBAAKCAQEAws6aJK6boGyDZKXE0KUimKb1hhoXpBwX/8+wYBc3NnRRKdyD\nwHmQugko5R2MSI9XmWqtuXm8sg/PWtWYjjhaF/I8TebKOR57L+2AKTspNGtICuYs\nuxUgHsZcgu9dYo+zs8vhiKutBb6KGfzdTFkJUawrdZEwDWzOfYQc8DwPposbjdBS\nXtPW8hhLL0mRfi/yEhppzCB83SvDfaNCx6t9/BsCSNIEwjHtQNdBIaQ4oklLEVnS\nRqZYBxKlBeY3AfVte+y192XL4eF1o+OuyWzi5FQwIB6NfVEJA0eAGkaBBm9cpf8U\ndnAim7r0V5OiJSRbM1qgEXvrd3ffI27PbOJQiwIDAQABAoIBACUnKAjE8FNpPqns\nX5v3UqDQftUDluyqmv0jzByXcOVGy8/zCYGk7bA9XPpNZ1rTU76jtNxB1nYTQ9Ws\nFPtSzgPxJAUrdffs00uxvRaf/NzNdSD3AyLvBYA5Dp2+Lw5EH96zjKD3NPl6fHY2\nXrJX7MoRzvwOI5772Gnhz28V1VpKqgUuYlglSZu+E6UIe2RxLbmMroxAOoMwWyAt\nuVZbdwO6S8z5xHfEwLNxjgpnZaYyRmWW/OV/IHHrj3Jxc/lZ03e1xWc+8VUu6JHW\nVzuLY2gVS6P2k4xHIYQscJ29UO2tqJ1qGaTCBu3sgfFF1fxekIuq6kwgD6HSMxpo\naam8nbECgYEA88gK0AJImBT9NuPSYih5bA2eM2oLpC2Y4xDBBnusfyPkSgL+j8RU\n5SN3ja/qgqgt5W6P2/eA2AM8LbEzwkhJAmAP8KzWMXYp06S49T6jbpsg1ZHodxYW\ngfVh5wYA7K53h4o3Fi80A1Jcq2S3em8qQ5FZuHqexOboMEl1V6ckO/MCgYEAzJIr\nhHsRsSvNfKWAELIiik3Cmxe813gHvQrnFEDraEzz5dv8WYkIGE/LXO4+rTLc+jEm\nHptrbPIUf1wNUw63pWN7VlJGg0tfMrmnb6BSJlK7DN0FKrlYmUwUfBgP8eIlS7Ia\nD9/5Ihf1J8scErFGfZXuL2Wo3bGFCLuhb7MZNwkCgYBf0Dnfs2YQz/8NudEQX1QJ\n0fhhwMY+iuVSKV2UTLtpZRPuuuqOWt37CUuN1pxXKf6P9Dp6e/aZ7/uRAdqT+5Em\na9cYAvZUjlq2IkHHsgzOBg6LokM5uuaxwV3vTP7EB3ZXQU2RXJAW1iIyAu3SIyr7\nT39x8E/Cl/aeM+D4yGqHXQKBgDNoRAFNv/tqy3+YQ19utFlXAyFgTLdE1YT++WTQ\nj5etRtkrd/W0BtG9M5iN0jhKANfqg+7LFarSBq6enkaR+zpXjoX5tPiHd0vS9a2K\ndzpkLdckr4i1/PrA8KDilxcswjyMbBozKXMU3Cl80/gqjlE+3RUSEeZsFsdEB2R/\neEWpAoGAbJoIcGcVPpayYjFyJ5cmHynARn/w+cU31Pn7WtkPMMJE+fxu7IbuSSqg\nTPAoad+TGpcaqwx5CcwU3N38fDaPfrF8RO5YdX9dkgYzUfx8/Vsr/6I0KtGY1rBk\nY8bbhztzbU6jMyAK/+QoNUKmhzdnJhsgISNIATqx834nAvTajUU=\n-----END RSA PRIVATE KEY-----\n",
        "loadbalancer_external_signer_private_key": "-----BEGIN RSA PRIVATE KEY-----\nMIIEogIBAAKCAQEAzLaZk0BZbAieumzpPQO1GZgZY2q/2plRzqdMobuI7LObKeL5\nZ2rx6OP2I340o4nFeBKVQXIa/pX7E4eZxLvoP1QVsQIshbgxa/Nre1t16y/Ae/KK\nA0SO96QwDS7+YyA0gziRYuAfWtl5jj5foJ/FaaAaUChWdIdgosmRqqkVnTilEuC5\nECwcLvGjU/kWXn2n1BAWRg643o4XDwrJylgIw/WLbyEC5Loyf6KpxiIrsFo3eQ64\njALMkPCkiA0tPmqlGE+UXNq2FhS8NLh805gdqMCD5QSRKHpsRcRKv9xLL/bAHbII\nZutCRgffoLCYD3eKbr5/TW3cLdCeOxBa8odNjQIDAQABAoIBAFDTuAdf3O6+6I0K\n+3xPvm2AlGWgfGe/KYHCpIsnFIUA1T7Qk1C19RXTDBgveHEpsIIcNDpG50mlxiCL\n5ba7ypNWi8n75cBWXY0V61YlYoWdsQ4/USbBJwG4HhDWgTJ6QMGe0CiN/VNNkqUL\nE47EBpoR0NHdW2VfHlSn6Y/MevA7/IpdstgyJueFiw0kQAsqlYwf+m86k6QNUouH\ngc5HugO7yMbSn8Adb/+v0adcmS/Ya2KLLhwBx9nzQgMVNNGRqi+Zucx1UVhiBlQH\n8mQFaALxaCHbEFxLATvLZO4AJViLL3nUdDIfzJeKvbw8x48h8787f2UHzp3JrELp\nEMJj3IECgYEA4/qRvOZKWCv0hH/Tnxb5rOSs7GU5/SfJClKuwrw7q4K2yE03ah4V\nDT0r0KYPvKUvkVhlOrUA4HdZuCuOCBmwPMKf/LlMzDv01B/oUNRkEY3MppJrXhXO\neyEjSUYy/WBgPy4CG9Khaxq89Ls7oHKTJ69xjX7jq4Z5dz/l0jf87KkCgYEA5d/5\nN7PnZNxcWRf7Y0LR5KDl978k4Wa+LYid52sXz3gJVUpm5m5sojicvwPVfEG47Djl\nKWX8szI2heH8PMfncce8t4Nt9b8ucVdGHbYS4m5b85wYFt0OWIVCxkJ8RqQrsesE\nq5MFqxdGbuIv38pi88+7IV5llpQvH5M7wHQN5EUCgYBcALLv2MAH9TUog62TdmIs\nM9zVScStNXEciWGdlPk/rfC1xPOoD5vPS/Bys5GGP+OCdHnlx0YjUAcVG/6lpjhJ\nTQHjq6Qih8+2C2pltFDuBJuiXVSXE5XQev8SgxHwzwQIezi+obIi1xeKbEUT6ykX\nyuW4hIy8m/hI97B3tcCMgQKBgARXpMeOmHJpTz1HnLIVUw20lGOHstSnMjR9/i2e\n8kYzCEoaK7Nypo6x7xQUqHW+cBXWRU3w5UMlUa5ZxIAJbq/RjBkTXIJl6CSv910c\nUWMBnq8NZc8YweqeKdLA8sQK2eB0hhQPpO3EdMonb6wUkKX2aJyKwfSEPBemmlxa\nVODZAoGAWEa2iRWRYm35ACVpHMrDpNLqno5ky2XP77dy+Gb6e0mxGS2A47zBngvR\nD5hajpUjx75b2w+veUpbTO65sZRPajZdk2duprR8VHmiuD1FvU4aDuFEoJhtiosH\nlssatxT/WCGtQ+/y4HstlCYNvHqHQoJfm/08Sbn6FER0KmZfiIY=\n-----END RSA PRIVATE KEY-----\n"
      },
      "ClientAuthCrypto": {
        "admin_ca_certificate": "-----BEGIN CERTIFICATE-----\nMIIDMDCCAhigAwIBAgIIAItigrtpytkwDQYJKoZIhvcNAQELBQAwNjESMBAGA1UE\nCxMJb3BlbnNoaWZ0MSAwHgYDVQQDExdhZG1pbi1rdWJlY29uZmlnLXNpZ25lcjAe\nFw0yNDEyMDUxODQwNDZaFw0zNDEyMDMxODQwNDZaMDYxEjAQBgNVBAsTCW9wZW5z\naGlmdDEgMB4GA1UEAxMXYWRtaW4ta3ViZWNvbmZpZy1zaWduZXIwggEiMA0GCSqG\nSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDNj8NbgrTlZhgx3+u+U0gPxtKOs2QNe/GB\nH0gRe1nCsFuC8K7B+lkiNn9STl8ga16dLZkKZK5UIL7hGAldrqYO4uP9UoTwAnDn\nzb5NqqYEoTB+MmiDsAJ0ZnIMWZFW88zdpTHBNeO0B91zWXz5cpXJwD8jtXEf80x5\nSRktIFL6YhMdUD2E8M+zcDnMb5MkpgcnuI2J6+TwLfg45ciZl9ldevYPuVuzgnJ5\nm1rZjDidNlJfYvSevPV6N4LeuqiRn686PATPN/wWhH+c8CGQP9UFgSvrYnYhFjbq\nOExskYTUvXTUm/0V9GJrpO3xG1khtl8LdtGUZPYNoq4t88BS3SrJAgMBAAGjQjBA\nMA4GA1UdDwEB/wQEAwICpDAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBQLNDbq\nShbSEmICpnU1hZIyweIEvjANBgkqhkiG9w0BAQsFAAOCAQEAa+4JDQ7VGYdpZOxB\nCYfHMzCNKk7V26RAWAADXIVmRRqnxP8PosMeYDxytUyScpSWZVBFzESOQB97f6An\nnWfP14yWQCUORvOeZgI9ORDpOd14ghDPw1OQN7XqEVWfUzvTfO/GxpH83G4qrd2I\nz2IAf2QYR4Vei3J5o6Yngo95ULHUXhUQCwHm2RcZgz6JrTV0Xj0oZ4NsKqdd7C5F\nF0aLdo8sFikx/vzt7W2vpb+rcSp8m4CvL+dFZHCZ9a0Y3z7CGdxJCxrEfNo9i7Qy\nQ+oTtALIokuKDgAj0cBvffhXmbS9JeB+RFUjxkNIpQ93PzPEIDZvp2GZG4HSPASU\nU3390w==\n-----END CERTIFICATE-----\n"
      }
    },
    "IngresssCrypto": {
      "ingress_ca": "-----BEGIN RSA PRIVATE KEY-----\nMIIEpgIBAAKCAQEAwbDPknCi+tMGYfiIcT8GU276vZpLqSA4HMkPEyfm5jOtga10\nD4rQR0B5Nd3+0gNZpzIKQuTrWvMOaLB6XLKUYzDAt47q2UIpl7XCB6Ale7LT9GDl\nk4gRzwxipT7G6ESXPipm/pth706TUSS+OYHTa1svKQ64Vqet/mCPSzW0EJTKpEDS\n1A7Ey12Lsl/YlmIHKqDOYxckISDeNKF6y0wvT//SzI00YpGEJaTRUjDEu2dcs3lQ\ncfVQN+dQ3wltWWpZejhhCFvoOOvYOp6bApbUMrt9JrSSGbd7J+u/PG9M5SIrSlQq\nDZRXzd8Ou0DacMuCqWxIfZJJpG6MvfOYOpT2pQIDAQABAoIBAQC9ZLmjlNYY802z\ncMViDuGNpeAyk/RVvPaBVyyRa5wBDxkiy0vIgtDkSyv6u0cXbkU1Et4ryRJGDZLS\nVXZgvBIS57IaCvqjVGm9OfIvaK4eRZ+xvyndV9kqHw86S6dNqPxGwkmRvrhFuwyb\n9JS5QLRNrozv1b/0o+Oj8CFNxoZ7Cnu41rNVjUKkHFfRvL+fVNNWRQwksZ8txrz0\nk+2ac4415TPm5C25LHTcUwja1clydpJSlvjXw2kW/NCW33CR5ENuyUUeo9gOdDdP\nZ3lt/kVO7nHmE773gWuBT/87VfBIcd5TgGXSR9WjYS1ETmyBkZwV0k5PoMa9LIM3\nA9BXPNRBAoGBAMLU8e8rNefV/ceJxJyyRtpY1aUR0QUz8xIbO1dBUmq/EIULP81h\n1jQqRGbG09ngRDPK7bGZah8zLjgRff2Xc/a7Rk8MBZlLU8lEcGAklvNKnoUZjoJ3\nYxYC/EExLfKIOSI8gBZCImVgp9XnxQi2SD2MkwubRspJ+ZwNC58zZNRxAoGBAP6A\nJi1qNsbMOThzlDGSdU++7rnCWinPjsGv/PdsM55AApRc9tL9SZVy38MnbAhdX1Od\nyQDO0b6b9plMKhKzdkAnkCdTjVuur7yXCW4qsn9oiBc4ia8GwP6EuKY496JVAggo\nXwD9BrPPm91oH8eEkPcxKBxrF9jUWoyCxyFDgU91AoGBAKbrceuKhcB+YdKWgdAO\nHQ3slf26ae2fOF0G36w91rKFx010+dCoRbCjlb7IEbDUpxoIfeRun7DjVHHM6rhd\nDYkRoYcPsaxIERyaefyk3H7MK0u1PZchWc7998iSrd7gPrLKSqLHPljEmoZ07yYr\npXC2AzUqb1fYUPYVZyOaEITBAoGBAMpLGI2O2L2KRY1uqYQB04ewz9cN+lczqVih\nx+Tvt9P5M1O01Wj+dgf6CIz5//BiL8yqJcSjoKrvE8Pke6jjx4HVMMthqYIPx5aT\nQ6ay/7EwaMR0Z1SdfLiSzKcrrwL0qSnM1T9W4IX65vzFsEUKRaSHCUgVhB4RJWx8\n40W4f8elAoGBAJmisYgVb+rlEWvMmIGeoVj4bxWUf1T9v+XfJnqSXmW1VZdKwxxq\nZMsWs/M49q7xbkzoEzrwsIGXXWRq0MkOShQc6d1YkSJDJSWmTmGL23FlveBqyRVH\nuzrid8drO3P/29DYu2g/96KWDTn1tsAp/sub1CVZWypSt92g5BMQaVOG\n-----END RSA PRIVATE KEY-----\n",
      "ingress_certificate_cn": "ingress-operator@1733424046"
    }
  },
  "release_registry": "quay.io"
}'

encoded_manifest=$(echo $base_manifest | jq --arg ps "$pull_secret" '. + {pull_secret: $ps}' | base64 --wrap=0)

echo '{
    "apiVersion": "v1",
    "data": {},
    "kind": "Secret",
    "metadata": {
        "labels": {
            "image-based-installed.openshift.io/created": "true"
        },
        "name": "ibi-cluster-seed-reconfiguration",
        "namespace": "ibi-cluster"
    },
    "type": "Opaque"
}' | jq --arg manifest "$encoded_manifest" '.data."manifest.json" = $manifest' | oc create -f -
EOF
