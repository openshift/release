kind: BuildConfig
apiVersion: build.openshift.io/v1
metadata:
  namespace: ci
  name: qci-pruner
spec:
  successfulBuildsHistoryLimit: 1
  failedBuildsHistoryLimit: 2
  output:
    pushSecret:
      name: registry-push-credentials-ci-images-mirror
    to:
      kind: DockerImage
      name: quay.io/openshift/ci:ci_qci-pruner_latest
  source:
    dockerfile: |
      FROM registry.access.redhat.com/ubi9/python-312:latest
      RUN mkdir /tmp/bin && curl -L --fail -v https://mirror.openshift.com/pub/openshift-v4/$(uname -m)/clients/ocp/stable-4.20/openshift-client-linux.tar.gz | tar xvzf - -C /tmp/bin/ oc && \
        chmod ug+x /tmp/bin/oc
      ENV PATH="/tmp/bin:${PATH}"
      RUN wget https://raw.githubusercontent.com/openshift/release/refs/heads/master/hack/qci_registry_pruner.py && chmod +x ./qci_registry_pruner.py
    type: Dockerfile
  strategy:
    type: Docker
