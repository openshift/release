kind: BuildConfig
apiVersion: build.openshift.io/v1
metadata:
  namespace: ci
  name: gcp-hcp-infra-terraform
spec:
  successfulBuildsHistoryLimit: 1
  failedBuildsHistoryLimit: 2
  output:
    pushSecret:
      name: registry-push-credentials-ci-images-mirror
    to:
      kind: DockerImage
      name: quay.io/openshift/ci:ci_gcp-hcp-infra-terraform_latest
  source:
    dockerfile: |
      FROM quay-proxy.ci.openshift.org/openshift/ci:ocp_builder_rhel-9-golang-1.25-openshift-4.21
      ARG TERRAFORM_VERSION
      ENV TF_PLUGIN_CACHE_DIR="/go/.terraform-cache"
      RUN mkdir -p --mode=2775 ${TF_PLUGIN_CACHE_DIR}
      RUN dnf config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo && \
          dnf install -y "terraform${TERRAFORM_VERSION:+-${TERRAFORM_VERSION}}"
    type: Dockerfile
  strategy:
    dockerStrategy:
      buildArgs:
      - name: TERRAFORM_VERSION
        value: "1.14.3-1"
      from:
        kind: ImageStreamTag
        name: "builder:rhel-9-golang-1.25-openshift-4.21"
        namespace: ocp
      imageOptimizationPolicy: SkipLayers
    type: Docker
  triggers:
  - type: ConfigChange
  - imageChange:
      from:
        kind: ImageStreamTag
        name: "builder:rhel-9-golang-1.25-openshift-4.21"
        namespace: ocp
    type: ImageChange
