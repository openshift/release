apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: namespace-ttl-controller
  annotations:
    keel.sh/policy: force
    keel.sh/matchTag: "true"
    keel.sh/trigger: poll
    keel.sh/pollSchedule: "@every 5m"
  name: namespace-ttl-controller
  namespace: ci
spec:
  replicas: 1
  selector:
    matchLabels:
      app: namespace-ttl-controller
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: namespace-ttl-controller
    spec:
      serviceAccount: namespace-ttl-controller
      nodeSelector:
        kubernetes.io/arch: amd64
      containers:
      - image: quay-proxy.ci.openshift.org/openshift/ci:ci_ci-ns-ttl-controller_latest
        name: namespace-ttl-controller
        imagePullPolicy: Always
        command:
        - /ci-ns-ttl-controller
        - --projected-token-file=/var/sa-token/token
        volumeMounts:
        - name: service-account-token
          mountPath: /var/sa-token
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          runAsNonRoot: true
          seccompProfile:
            type: RuntimeDefault
      volumes:
      - name: service-account-token
        projected:
          sources:
          - serviceAccountToken:
              path: token
