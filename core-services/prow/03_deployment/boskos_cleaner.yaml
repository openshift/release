# Boskos cleaner is needed to allow resources created out of dynamic resource lifecycle to
# be deleted.
# It is responsible for checking if resources that were created based on
# dynamic resource lifecycles have child resources defined in their userdata and if yes,
# mark those as to be deleted as well.
# Afterwards the resources are put into tombstone state which makes boskos delete them
# the next time it syncs its config.
apiVersion: apps/v1
kind: Deployment
metadata:
  name: boskos-cleaner
  labels:
    app: prow
    component: boskos-cleaner
  namespace: ci
spec:
  replicas: 3
  selector:
    matchLabels:
      component: boskos-cleaner
  template:
    metadata:
      labels:
        app: prow
        component: boskos-cleaner
    spec:
      priorityClassName: prow-critical
      serviceAccountName: boskos
      terminationGracePeriodSeconds: 300
      containers:
      - name: boskos-cleaner
        image: gcr.io/k8s-prow/boskos/cleaner:v20200220-040e18831
        args:
        - --cleaner-count=1
        - --boskos-url=http://boskos
        - --namespace=$(namespace)
        env:
        - name: MY_POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
