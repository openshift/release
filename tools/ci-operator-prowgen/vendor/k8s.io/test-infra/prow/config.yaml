plank:
  job_url_template: 'https://k8s-gubernator.appspot.com/build/kubernetes-jenkins/{{if eq .Spec.Type "presubmit"}}pr-logs/pull{{else if eq .Spec.Type "batch"}}pr-logs/pull{{else}}logs{{end}}{{if .Spec.Refs}}{{if ne .Spec.Refs.Org ""}}{{if ne .Spec.Refs.Org "kubernetes"}}/{{if and (eq .Spec.Refs.Org "kubernetes-sigs") (ne .Spec.Refs.Repo "poseidon")}}sigs.k8s.io{{else}}{{.Spec.Refs.Org}}{{end}}_{{.Spec.Refs.Repo}}{{else if ne .Spec.Refs.Repo "kubernetes"}}/{{.Spec.Refs.Repo}}{{end}}{{end}}{{end}}{{if eq .Spec.Type "presubmit"}}/{{with index .Spec.Refs.Pulls 0}}{{.Number}}{{end}}{{else if eq .Spec.Type "batch"}}/batch{{end}}/{{.Spec.Job}}/{{.Status.BuildID}}/'
  report_template: '[Full PR test history](https://k8s-gubernator.appspot.com/pr/{{if eq .Spec.Refs.Org "kubernetes"}}{{if eq .Spec.Refs.Repo "kubernetes"}}{{else}}{{.Spec.Refs.Repo}}/{{end}}{{else}}{{.Spec.Refs.Org}}_{{.Spec.Refs.Repo}}/{{end}}{{with index .Spec.Refs.Pulls 0}}{{.Number}}{{end}}). [Your PR dashboard](https://k8s-gubernator.appspot.com/pr/{{with index .Spec.Refs.Pulls 0}}{{.Author}}{{end}}). Please help us cut down on flakes by [linking to](https://git.k8s.io/community/contributors/devel/flaky-tests.md#filing-issues-for-flaky-tests) an [open issue](https://github.com/{{.Spec.Refs.Org}}/{{.Spec.Refs.Repo}}/issues?q=is:issue+is:open) when you hit one in your PR.'
  pod_pending_timeout: 60m
  default_decoration_config:
    timeout: 7200000000000 # 2h
    grace_period: 15000000000 # 15s
    utility_images:
      clonerefs: "registry.svc.ci.openshift.org/ci/clonerefs:latest"
      initupload: "registry.svc.ci.openshift.org/ci/initupload:latest"
      entrypoint: "registry.svc.ci.openshift.org/ci/entrypoint:latest"
      sidecar: "registry.svc.ci.openshift.org/ci/sidecar:latest"
    gcs_configuration:
      bucket: "kubernetes-jenkins"
      path_strategy: "legacy"
      default_org: "kubernetes"
      default_repo: "kubernetes"
    gcs_credentials_secret: "service-account"

sinker:
  resync_period: 1m
  max_prowjob_age: 48h
  max_pod_age: 30m

deck:
  tide_update_period: 1s
  hidden_repos:
  - kubernetes-security

prowjob_namespace: default
pod_namespace: test-pods
log_level: info

branch-protection:
  allow_disabled_policies: true  # TODO(fejta): remove, needed by k/website
  orgs:
    kubernetes:
      protect: true
      required_status_checks:
        contexts:
        - cla/linuxfoundation
      repos:
        api:
          restrictions:
            users: []
            teams:
            - stage-bots
        apiextensions-apiserver:
          restrictions:
            users: []
            teams:
            - stage-bots
        apimachinery:
          restrictions:
            users: []
            teams:
            - stage-bots
        apiserver:
          restrictions:
            users: []
            teams:
            - stage-bots
        client-go:
          restrictions:
            users: []
            teams:
            - stage-bots
        code-generator:
          restrictions:
            users: []
            teams:
            - stage-bots
        dashboard:
          required_pull_request_reviews:
            required_approving_review_count: 1
        dns:
          required_status_checks:
            strict: true
            contexts:
            - continuous-integration/travis-ci
          required_pull_request_reviews:
            required_approving_review_count: 1
        git-sync:
          enforce_admins: true
          required_status_checks:
            strict: true
          restrictions: # only allow admins
            users: []
            teams: []
        kompose:
          required_status_checks:
            contexts:
            - continuous-integration/travis-ci
          required_pull_request_reviews:
            required_approving_review_count: 1
        kubectl:
          required_status_checks:
            contexts:
            - continuous-integration/travis-ci
        kubernetes:
          restrictions: # only allow admins
            users: []
            teams: []
        kube-aggregator:
          restrictions:
            users: []
            teams:
            - stage-bots
        metrics:
          restrictions:
            users: []
            teams:
            - stage-bots
        org:
          restrictions: # only allow admins
            users: []
            teams: []
        repo-infra:
          required_status_checks:
            contexts:
            - continuous-integration/travis-ci
        sample-apiserver:
          restrictions:
            users: []
            teams:
            - stage-bots
        sample-controller:
          restrictions:
            users: []
            teams:
            - stage-bots
        utils:
          required_pull_request_reviews:
            required_approving_review_count: 1
          required_status_checks:
            contexts:
            - continuous-integration/travis-ci
        website:
          protect: false # TODO(fejta): protect all branches soon
          required_status_checks:
            contexts:
            - continuous-integration/travis-ci
          branches:
            master:
              protect: true
            release-1.4:
              protect: true
            release-1.5:
              protect: true
            release-1.6:
              protect: true
            release-1.7:
              protect: true
            release-1.8:
              protect: true
            release-1.9:
              protect: true
    kubernetes-csi:
      protect: true
      required_status_checks:
        contexts:
        - cla/linuxfoundation
      repos:
        csi-test:
          required_status_checks:
            contexts:
            - continuous-integration/travis-ci
        drivers:
          required_status_checks:
            contexts:
            - continuous-integration/travis-ci
        external-attacher:
          required_status_checks:
            contexts:
            - continuous-integration/travis-ci
        external-provisioner:
          required_status_checks:
            contexts:
            - continuous-integration/travis-ci
    kubernetes-sigs:
      protect: true
      required_status_checks:
        contexts:
        - cla/linuxfoundation

tide:
  queries:
  - orgs:
    - kubeflow
    labels:
    - lgtm
    - approved
    missingLabels:
    - do-not-merge
    - do-not-merge/hold
    - do-not-merge/invalid-owners-file
    - do-not-merge/work-in-progress
    - needs-ok-to-test
    - needs-rebase
  - repos:
    - helm/charts
    labels:
    - lgtm
    - approved
    - "cncf-cla: yes"
    missingLabels:
    - do-not-merge
    - do-not-merge/blocked-paths
    - do-not-merge/cherry-pick-not-approved
    - do-not-merge/hold
    - do-not-merge/invalid-owners-file
    - do-not-merge/release-note-label-needed
    - do-not-merge/work-in-progress
    - needs-ok-to-test
    - needs-rebase
  - repos:
    - kubernetes/client-go
    - kubernetes/cloud-provider-aws
    - kubernetes/cloud-provider-azure
    - kubernetes/cloud-provider-gcp
    - kubernetes/cloud-provider-openstack
    - kubernetes/cloud-provider-vsphere
    - kubernetes/cluster-registry
    - kubernetes/community
    - kubernetes/contrib
    - kubernetes/dashboard
    - kubernetes/examples
    - kubernetes/features
    - kubernetes/federation
    - kubernetes/gengo
    - kubernetes/heapster
    - kubernetes/ingress-nginx
    - kubernetes/kops
    - kubernetes/kube-deploy
    - kubernetes/kube-openapi
    - kubernetes/kube-state-metrics
    - kubernetes/kubeadm
    - kubernetes/kubernetes-docs-ja
    - kubernetes/kubernetes-docs-ko
    - kubernetes/kubernetes-template-project
    - kubernetes/minikube
    - kubernetes/node-problem-detector
    - kubernetes/org
    - kubernetes/perf-tests
    - kubernetes/publishing-bot
    - kubernetes/release
    - kubernetes/repo-infra
    - kubernetes/sig-release
    - kubernetes/steering
    - kubernetes/test-infra
    - kubernetes/website
    - kubernetes-csi/csi-test
    - kubernetes-csi/docs
    - kubernetes-csi/driver-registrar
    - kubernetes-csi/drivers
    - kubernetes-csi/external-attacher
    - kubernetes-csi/external-provisioner
    - kubernetes-csi/external-snapshotter
    - kubernetes-csi/kubernetes-csi.github.io
    - kubernetes-csi/livenessprobe
    - kubernetes-sigs/application
    - kubernetes-sigs/architecture-tracking
    - kubernetes-sigs/aws-encryption-provider
    - kubernetes-sigs/cluster-api
    - kubernetes-sigs/cluster-api-provider-aws
    - kubernetes-sigs/cluster-api-provider-gcp
    - kubernetes-sigs/cluster-api-provider-openstack
    - kubernetes-sigs/contributor-site
    - kubernetes-sigs/controller-runtime
    - kubernetes-sigs/controller-tools
    - kubernetes-sigs/gcp-compute-persistent-disk-csi-driver
    - kubernetes-sigs/gcp-filestore-csi-driver
    - kubernetes-sigs/kubebuilder
    - kubernetes-sigs/kustomize
    - client-go/unofficial-docs
    labels:
    - lgtm
    - approved
    - "cncf-cla: yes"
    missingLabels:
    - do-not-merge
    - do-not-merge/blocked-paths
    - do-not-merge/cherry-pick-not-approved
    - do-not-merge/hold
    - do-not-merge/invalid-owners-file
    - do-not-merge/release-note-label-needed
    - do-not-merge/work-in-progress
    - needs-ok-to-test
    - needs-rebase
  - repos:
    - kubernetes/kubectl
    labels:
    - "cncf-cla: yes"
    missingLabels:
    - do-not-merge/hold
    - do-not-merge/invalid-owners-file
    - do-not-merge/work-in-progress
    reviewApprovedRequired: true
  - repos:
    - kubernetes-sigs/federation-v2
    - kubernetes-sigs/kubeadm-dind-cluster
    - kubernetes-sigs/testing_frameworks
    - kubernetes-sigs/poseidon
    labels:
    - lgtm
    - approved
    - "cncf-cla: yes"
    missingLabels:
    - do-not-merge/hold
    - do-not-merge/invalid-owners-file
    - do-not-merge/work-in-progress
    - needs-ok-to-test
  - repos:
    - kubernetes-incubator/service-catalog
    labels:
    - lgtm
    - approved
    - "cncf-cla: yes"
    missingLabels:
    - do-not-merge/hold
    - do-not-merge/invalid-owners-file
    - do-not-merge/work-in-progress
    - needs-ok-to-test
    - needs-rebase
  merge_method:
    helm/charts: squash
    kubeflow: squash
    kubernetes/dashboard: squash
    kubernetes/kube-deploy: squash
    kubernetes/website: squash
    kubernetes/kubernetes-docs-ja: squash
    kubernetes/kubernetes-docs-ko: squash
    kubernetes-sigs/cluster-api: squash
    kubernetes-sigs/cluster-api-provider-aws: squash
    kubernetes-sigs/cluster-api-provider-gcp: squash
    kubernetes-sigs/cluster-api-provider-openstack: squash
    kubernetes-incubator/service-catalog: squash
  target_url: https://prow.k8s.io/tide.html

push_gateway:
  endpoint: pushgateway

presets:
# credential presets
- labels:
    preset-service-account: "true"
  env:
  - name: GOOGLE_APPLICATION_CREDENTIALS
    value: /etc/service-account/service-account.json
  volumes:
  - name: service
    secret:
      secretName: service-account
  volumeMounts:
  - name: service
    mountPath: /etc/service-account
    readOnly: true
- labels:
    preset-gke-alpha-service: "true"
  env:
  - name: GOOGLE_APPLICATION_CREDENTIALS
    value: /etc/service-account/service-account.json
  volumes:
  - name: service
    secret:
      secretName: gke-alpha-service-account
  volumeMounts:
  - name: service
    mountPath: /etc/service-account
    readOnly: true
- labels:
    preset-istio-service: "true"
  env:
  - name: GOOGLE_APPLICATION_CREDENTIALS
    value: /etc/service-account/istio-service-account.json
  volumes:
  - name: service
    secret:
      secretName: istio-service-account
  volumeMounts:
  - name: service
    mountPath: /etc/service-account
    readOnly: true
- labels:
    preset-k8s-ssh: "true"
  env:
  - name: USER
    value: prow
  - name: JENKINS_GCE_SSH_PRIVATE_KEY_FILE
    value: /etc/ssh-key-secret/ssh-private
  - name: JENKINS_GCE_SSH_PUBLIC_KEY_FILE
    value: /etc/ssh-key-secret/ssh-public
  volumes:
  - name: ssh
    secret:
      defaultMode: 0400
      secretName: ssh-key-secret
  volumeMounts:
  - name: ssh
    mountPath: /etc/ssh-key-secret
    readOnly: true
- labels:
    preset-aws-ssh: "true"
  env:
  - name: USER
    value: prow
  - name: JENKINS_AWS_SSH_PRIVATE_KEY_FILE
    value: /etc/aws-ssh/aws-ssh-private
  - name: JENKINS_AWS_SSH_PUBLIC_KEY_FILE
    value: /etc/aws-ssh/aws-ssh-public
  volumes:
  - name: aws-ssh
    secret:
      defaultMode: 0400
      secretName: aws-ssh-key-secret
  volumeMounts:
  - name: aws-ssh
    mountPath: /etc/aws-ssh
    readOnly: true
- labels:
    preset-aws-credential: "true"
  env:
  - name: JENKINS_AWS_CREDENTIALS_FILE
    value: /etc/aws-cred/credentials
  volumes:
  - name: aws-cred
    secret:
      defaultMode: 0400
      secretName: aws-cred-new
  volumeMounts:
  - name: aws-cred
    mountPath: /etc/aws-cred
    readOnly: true
# storage / caching presets
- labels:
    preset-bazel-scratch-dir: "true"
  env:
  - name: TEST_TMPDIR
    value: /bazel-scratch/.cache/bazel
  volumes:
  - name: bazel-scratch
    emptyDir: {}
  volumeMounts:
  - name: bazel-scratch
    mountPath: /bazel-scratch/.cache
- labels:
    preset-bazel-remote-cache-enabled: "true"
  env:
  - name: BAZEL_REMOTE_CACHE_ENABLED
    value: "true"
# docker-in-docker (with images/bootstrap) preset
# NOTE: using this also requires using that image,
# ensuring you run your test under either the ENTRYPOINT or:
# /usr/local/bin/runner my-test-command --foo --bar
# AND setting the following on your PodSpec:
# securityContext: 
#   privileged: true
- labels:
    preset-dind-enabled: "true"
  env:
  - name: DOCKER_IN_DOCKER_ENABLED
    value: "true"
  volumes:
  - name: docker-graph
    emptyDir: {}
  volumeMounts:
  - name: docker-graph
    mountPath: /docker-graph

presubmits:
  kubernetes/community:
  - name: pull-community-verify
    branches:
    - master
    always_run: true
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/gcloud-in-go:v20171113-192bec25
        args:
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"

  GoogleCloudPlatform/k8s-multicluster-ingress:
  - name: pull-kubernetes-multicluster-ingress-test
    branches:
    - master
    always_run: true
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--repo=github.com/GoogleCloudPlatform/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        volumeMounts:
        - name: coveralls
          mountPath: /etc/coveralls-token
          readOnly: true
      volumes:
      - name: coveralls
        secret:
          secretName: k8s-multicluster-ingress-coveralls-token

  kubernetes/federation:
  - name: pull-federation-bazel-test
    always_run: true
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bazelbuild:v20180201-0184a54dc-0.8.1
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--" # end bootstrap args, scenario args below
        - "--test=//... -//build/... -//vendor/..."
        - "--manual-test=//hack:verify-all"
        - "--test-args=--build_tag_filters=-e2e"
        - "--test-args=--test_tag_filters=-e2e"
        - "--test-args=--flaky_test_attempts=3"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"

  - name: pull-federation-e2e-gce
    always_run: true
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--repo=k8s.io/federation=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--root=/go/src/"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=110"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
  - name: pull-federation-verify
    always_run: true
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/gcloud-in-go:v20171113-192bec25
        args:
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"

  kubernetes/heapster:
  - name: pull-heapster-e2e
    always_run: true
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        securityContext:
          privileged: true
  - name: pull-heapster-unit
    always_run: true
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"

  kubernetes/cluster-registry:
  - name: pull-cluster-registry-verify-gensrc
    always_run: true
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "2Gi"
  - name: pull-cluster-registry-verify-gosrc
    always_run: true
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.8
        args:
        - "--job=$(JOB_NAME)"
        - "--root=/go/src"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        env:
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "2Gi"
  containerd/cri:
  - name: pull-cri-containerd-build
    always_run: true
    skip_branches:
    - v0.1
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-experimental
        args:
        - "--repo=github.com/containerd/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
    run_after_success:
    - name: pull-cri-containerd-node-e2e
      branches:
      - master
      always_run: true
      skip_report: false
      max_concurrency: 8
      labels:
        preset-service-account: "true"
        preset-k8s-ssh: "true"
      spec:
        containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
          args:
          - --root=/go/src
          - "--job=$(JOB_NAME)"
          - "--repo=k8s.io/kubernetes"
          - "--repo=github.com/containerd/$(REPO_NAME)=$(PULL_REFS)"
          - "--service-account=/etc/service-account/service-account.json"
          - "--upload=gs://kubernetes-jenkins/pr-logs"
          - "--timeout=90"
          - "--"
          - "--node-args=--image-config-file=/workspace/test-infra/jobs/e2e_node/containerd/cri-master/image-config.yaml -node-env=PULL_REFS=$(PULL_REFS)"
    - name: pull-cri-containerd-node-e2e
      branches:
      - release/1.0
      always_run: true
      skip_report: false
      max_concurrency: 8
      labels:
        preset-service-account: "true"
        preset-k8s-ssh: "true"
      spec:
        containers:
        - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
          args:
          - --root=/go/src
          - "--job=$(JOB_NAME)"
          - "--repo=k8s.io/kubernetes=release-1.10"
          - "--repo=github.com/containerd/$(REPO_NAME)=$(PULL_REFS)"
          - "--service-account=/etc/service-account/service-account.json"
          - "--upload=gs://kubernetes-jenkins/pr-logs"
          - "--timeout=90"
          - "--"
          - "--node-args=--image-config-file=/workspace/test-infra/jobs/e2e_node/containerd/cri-master/image-config.yaml -node-env=PULL_REFS=$(PULL_REFS)"

  - name: pull-cri-containerd-verify
    always_run: true
    skip_branches:
    - v0.1
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-experimental
        args:
        - "--repo=github.com/containerd/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"

  kubernetes/kubernetes:
  - name: pull-kubernetes-bazel-build
    always_run: true
    skip_branches:
    - release-1.10 # different bazel version
    - release-1.9 # need to cherry pick back https://github.com/kubernetes/kubernetes/pull/59251, possibly others
    - release-1.8 # different set of targets
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        - "--" # end bootstrap args, scenario args below
        - "--build=//... -//vendor/..."
        - "--release=//build/release-tars"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
    run_after_success:
    - name: pull-kubernetes-e2e-kubeadm-gce
      max_concurrency: 8
      skip_report: true
      run_if_changed: '^(cmd/kubeadm|build/debs).*$'
      skip_branches:
      - release-1.10 # different bazel version
      - release-1.9 # need to cherry pick back https://github.com/kubernetes/kubernetes/pull/59251, possibly others
      - release-1.8 # different set of targets
      labels:
        preset-service-account: "true"
        preset-k8s-ssh: "true"
      spec:
        containers:
        - image: gcr.io/k8s-testimages/e2e-kubeadm:v20180730-c8036c3a7
          args:
          - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
          - "--upload=gs://kubernetes-jenkins/pr-logs"
          - "--timeout=75"
          env:
          - name: SKIP_RELEASE_VALIDATION # See: https://github.com/kubernetes/kubernetes/pull/50391
            value: "true"
  - name: pull-kubernetes-bazel-build
    always_run: true
    branches:
    - release-1.10
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        - "--" # end bootstrap args, scenario args below
        - "--build=//... -//vendor/..."
        - "--release=//build/release-tars"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
    run_after_success:
    - name: pull-kubernetes-e2e-kubeadm-gce
      max_concurrency: 8
      skip_report: true
      run_if_changed: '^(cmd/kubeadm|build/debs).*$'
      branches:
      - release-1.10
      labels:
        preset-service-account: "true"
        preset-k8s-ssh: "true"
      spec:
        containers:
        - image: gcr.io/k8s-testimages/e2e-kubeadm:v20180730-c8036c3a7
          args:
          - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
          - "--upload=gs://kubernetes-jenkins/pr-logs"
          - "--timeout=75"
          env:
          - name: SKIP_RELEASE_VALIDATION # See: https://github.com/kubernetes/kubernetes/pull/50391
            value: "true"
  - name: pull-kubernetes-bazel-build
    always_run: true
    branches:
    - release-1.9
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bazelbuild:v20180201-0184a54dc-0.8.1
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        - "--" # end bootstrap args, scenario args below
        - "--build=//... -//vendor/..."
        - "--release=//build/release-tars"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
    run_after_success:
    - name: pull-kubernetes-e2e-kubeadm-gce
      max_concurrency: 8
      skip_report: true
      run_if_changed: '^(cmd/kubeadm|build/debs).*$'
      branches:
      - release-1.9
      labels:
        preset-service-account: "true"
        preset-k8s-ssh: "true"
      spec:
        containers:
        - image: gcr.io/k8s-testimages/e2e-kubeadm:v20180730-c8036c3a7
          args:
          - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
          - "--upload=gs://kubernetes-jenkins/pr-logs"
          - "--timeout=75"
          env:
          - name: SKIP_RELEASE_VALIDATION # See: https://github.com/kubernetes/kubernetes/pull/50391
            value: "true"
  - name: pull-kubernetes-bazel-build
    always_run: true
    branches:
    - release-1.8
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bazelbuild:v20180201-0184a54dc-0.6.1
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        - "--" # end bootstrap args, scenario args below
        - "--build=//cmd/... //pkg/... //federation/... //plugin/... //third_party/... //examples/... //test/... //vendor/k8s.io/..."
        - "--release=//build/release-tars"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
    run_after_success:
    - name: pull-kubernetes-e2e-kubeadm-gce
      max_concurrency: 8
      skip_report: true
      run_if_changed: '^(cmd/kubeadm|build/debs).*$'
      branches:
      - release-1.8
      labels:
        preset-service-account: "true"
        preset-k8s-ssh: "true"
      spec:
        containers:
        - image: gcr.io/k8s-testimages/e2e-kubeadm:v20180730-c8036c3a7
          args:
          - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
          - "--upload=gs://kubernetes-jenkins/pr-logs"
          - "--timeout=75"
          env:
          - name: SKIP_RELEASE_VALIDATION # See: https://github.com/kubernetes/kubernetes/pull/50391
            value: "true"

  - name: pull-kubernetes-bazel-test
    always_run: true
    skip_branches:
    - release-1.10 # different bazel version
    - release-1.9 # need to cherry pick back https://github.com/kubernetes/kubernetes/pull/59251, possibly others
    - release-1.8 # different set of targets
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        - "--" # end bootstrap args, scenario args below
        - "--test=//... -//build/... -//vendor/..."
        - "--manual-test=//hack:verify-all"
        - "--test-args=--config=unit"
        - "--test-args=--build_tag_filters=-e2e,-integration"
        - "--test-args=--test_tag_filters=-e2e,-integration"
        - "--test-args=--flaky_test_attempts=3"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-bazel-test
    always_run: true
    branches:
    - release-1.10
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        - "--" # end bootstrap args, scenario args below
        - "--test=//... -//build/... -//vendor/..."
        - "--manual-test=//hack:verify-all"
        - "--test-args=--config=unit"
        - "--test-args=--build_tag_filters=-e2e,-integration"
        - "--test-args=--test_tag_filters=-e2e,-integration"
        - "--test-args=--flaky_test_attempts=3"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-bazel-test
    always_run: true
    branches:
    - release-1.9
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bazelbuild:v20180201-0184a54dc-0.8.1
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        - "--" # end bootstrap args, scenario args below
        - "--test=//... -//build/... -//vendor/..."
        - "--manual-test=//hack:verify-all"
        - "--test-args=--build_tag_filters=-e2e,-integration"
        - "--test-args=--test_tag_filters=-e2e,-integration"
        - "--test-args=--flaky_test_attempts=3"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-bazel-test
    always_run: true
    branches:
    - release-1.8
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bazelbuild:v20180201-0184a54dc-0.6.1
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        - "--" # end bootstrap args, scenario args below
        - "--test=//cmd/... //pkg/... //federation/... //plugin/... //third_party/... //hack/... //vendor/k8s.io/..."
        - "--manual-test=//hack:verify-all"
        - "--test-args=--test_tag_filters=-integration"
        - "--test-args=--flaky_test_attempts=3"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-cross
    run_if_changed: '^(build\/|hack\/lib\/)|(Makefile)$'
    skip_branches:
    - release-1.9
    - release-1.8
    labels:
      preset-service-account: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            cpu: 7
            memory: "41Gi"

  - name: pull-kubernetes-cross
    # typecheck doesn't exist for < 1.10 currently, so we still run cross more often
    run_if_changed: '^(build\/|hack\/lib\/)|(Makefile)|(.*_(windows|linux|osx|unsupported)(_test)?\.go)$'
    branches:
    - release-1.8
    - release-1.9
    labels:
      preset-service-account: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            cpu: 7
            memory: "41Gi"

  - name: pull-kubernetes-cross-prow
    always_run: false
    labels:
      preset-service-account: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:latest
        imagePullPolicy: Always
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            cpu: 7
            memory: "41Gi"
  - name: pull-kubernetes-dind-e2e
    always_run: false
    skip_branches:
    - release-1.9
    - release-1.8
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--job=$(JOB_NAME)"
        - "--root=/go/src"
        - "--repo=k8s.io/kubernetes=$(PULL_REFS)"
        - "--repo=k8s.io/test-infra=master"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--scenario=dindind_execute"
        - "--"
        - "kubetest"
        - "--"
        - "--build=dind"
        - "--deployment=dind"
        - "--ginkgo-focus=\\[Conformance\\]"
        - "--ginkgo-skip=(DNS)|(NodeSelector)"
        - "--up"
        - "--test"
        - "--down"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
          capabilities:
            add: ["SYS_ADMIN"]
        volumeMounts:
        - mountPath: /lib/modules
          name: modules
          readOnly: true
        - mountPath: /sys/fs/cgroup
          name: cgroup
        resources:
          requests:
            # We can adjust this after we know the requirements.
            memory: "6Gi"
      volumes:
      - name: modules
        hostPath:
          path: /lib/modules
          type: Directory
      - name: cgroup
        hostPath:
          path: /sys/fs/cgroup
          type: Directory

  - name: pull-kubernetes-e2e-containerd-gce
    always_run: false
    branches:
    - master
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --repo=github.com/containerd/cri
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce
    always_run: true
    skip_branches:
    - release-1.10 # per-release image
    - release-1.9 # per-release image
    - release-1.8 # per-release image
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce
    always_run: true
    branches:
    - release-1.10
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce
    always_run: true
    # TODO(bentheelder): enforce this pattern (skip all releases) or implement
    # something better like https://github.com/kubernetes/test-infra/pull/4918
    branches:
    - release-1.9 # per-release image
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.9
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce
    always_run: true
    branches:
    - release-1.8
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.8
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-e2e-gce-100-performance
    always_run: true
    skip_report: false
    max_concurrency: 12
    branches:
    - master
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=120
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce-big-performance
    always_run: false
    max_concurrency: 1
    branches:
    - master
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=270
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-e2e-gce-device-plugin-gpu
    skip_branches:
    - release-1.10  # per-release image
    - release-1.9  # per-release image
    - release-1.8  # per-release image
    always_run: true
    skip_report: false
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce-device-plugin-gpu
    branches:
    - release-1.10  # per-release image
    always_run: true
    skip_report: false
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce-device-plugin-gpu
    branches:
    - release-1.9 # per-release image
    always_run: true
    skip_report: false
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.9
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce-device-plugin-gpu
    branches:
    - release-1.8
    always_run: true
    skip_report: false
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.8
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gce-large-performance
    always_run: false
    max_concurrency: 1
    branches:
    - master
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=570
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-e2e-gke
    always_run: false
    run_if_changed: '^(cluster/gce|cluster/addons).*$'
    # TODO(bentheelder): enforce this pattern (skip all releases) or implement
    # something better like https://github.com/kubernetes/test-infra/pull/4918
    skip_branches:
    - release-1.10 # per-release image
    - release-1.9 # per-release image
    - release-1.8 # per-release image
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gke
    always_run: false
    run_if_changed: '^(cluster/gce|cluster/addons).*$'
    branches:
    - release-1.10 # per-release image
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gke
    always_run: false
    run_if_changed: '^(cluster/gce|cluster/addons).*$'
    branches:
    - release-1.9 # per-release image
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.9
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gke
    always_run: false
    run_if_changed: '^(cluster/gce|cluster/addons).*$'
    branches:
    - release-1.8
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes=$(PULL_REFS)
        - --repo=k8s.io/release
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.8
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-e2e-gke-device-plugin-gpu
    skip_branches:
    - release-1.10  # per-release image
    - release-1.9  # per-release image
    - release-1.8  # per-release image
    always_run: false
    skip_report: false
    max_concurrency: 1
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gke-device-plugin-gpu
    branches:
    - release-1.10  # per-release image
    always_run: false
    skip_report: false
    max_concurrency: 1
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gke-device-plugin-gpu
    branches:
    - release-1.9  # per-release image
    always_run: false
    skip_report: false
    max_concurrency: 1
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.9
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-e2e-gke-device-plugin-gpu
    branches:
    - release-1.8  # per-release image
    always_run: false
    skip_report: false
    max_concurrency: 1
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.8
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-integration
    always_run: true
    labels:
      preset-service-account: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            cpu: 4
  - name: pull-kubernetes-integration-prow
    always_run: false
    labels:
      preset-service-account: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:latest
        imagePullPolicy: Always
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=60"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            cpu: 4
  - name: pull-kubernetes-kubemark-e2e-gce-big
    always_run: true
    skip_report: false
    max_concurrency: 12
    skip_branches:
    - release-1.10  # per-release image
    - release-1.9  # per-release image
    - release-1.8  # per-release image
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=120"
        # TODO(krzyzacy): Figure out bazel built kubemark image
        #env:
        # - name: KUBEMARK_BAZEL_BUILD
        # value: "y"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-kubemark-e2e-gce-big
    always_run: true
    skip_report: false
    max_concurrency: 12
    branches:
    - release-1.10  # per-release image
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=120"
        # TODO(krzyzacy): Figure out bazel built kubemark image
        #env:
        # - name: KUBEMARK_BAZEL_BUILD
        # value: "y"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-kubemark-e2e-gce-big
    always_run: true
    skip_report: false
    max_concurrency: 12
    branches:
    - release-1.9  # per-release image
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.9
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=120"
        # TODO(krzyzacy): Figure out bazel built kubemark image
        #env:
        # - name: KUBEMARK_BAZEL_BUILD
        # value: "y"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-kubemark-e2e-gce-big
    always_run: false
    skip_report: false
    max_concurrency: 12
    branches:
    - release-1.8
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.8
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=120"
        # TODO(krzyzacy): Figure out bazel built kubemark image
        #env:
        # - name: KUBEMARK_BAZEL_BUILD
        # value: "y"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-kubemark-e2e-gce-scale
    always_run: false
    max_concurrency: 1
    branches:
    - master
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=k8s.io/release"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=1220"
        # TODO(krzyzacy): Figure out bazel built kubemark image
        #env:
        # - name: KUBEMARK_BAZEL_BUILD
        # value: "y"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-local-e2e
    branches:
    - master
    always_run: false
    skip_report: false
    max_concurrency: 8
    run_if_changed: '(hyperkube|local-up-cluster)'
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=140"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true

  - name: pull-kubernetes-local-e2e-containerized
    branches:
    - master
    always_run: false
    skip_report: false
    run_if_changed: '^(pkg|cmd)/kubelet.*$'
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=140"
        env:
        - name: DOCKERIZE_KUBELET
          value: "true"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true

  - name: pull-kubernetes-node-e2e
    skip_branches:
    - release-1.10  # per-release image
    - release-1.9  # per-release image
    - release-1.8  # per-release image
    always_run: true
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - "--" # end bootstrap args, scenario args below
        - "--node-args=--image-config-file=/workspace/test-infra/jobs/e2e_node/image-config.yaml"
        ports:
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-node-e2e
    branches:
    - release-1.10  # per-release image
    always_run: true
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - "--" # end bootstrap args, scenario args below
        - "--node-args=--image-config-file=/workspace/test-infra/jobs/e2e_node/image-config.yaml"
        ports:
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-node-e2e
    branches:
    - release-1.9  # per-release image
    always_run: true
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.9
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - "--" # end bootstrap args, scenario args below
        - "--node-args=--image-config-file=/workspace/test-infra/jobs/e2e_node/image-config.yaml"
        ports:
        resources:
          requests:
            memory: "6Gi"
  - name: pull-kubernetes-node-e2e
    branches:
    - release-1.8
    always_run: true
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.8
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - "--" # end bootstrap args, scenario args below
        - "--node-args=--image-config-file=/workspace/test-infra/jobs/e2e_node/image-config.yaml"
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-node-e2e-containerd
    branches:
    - master
    always_run: false
    max_concurrency: 12
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - --root=/go/src
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--repo=github.com/containerd/cri"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=90"
        - --
        - "--node-args=--image-config-file=/workspace/test-infra/jobs/e2e_node/containerd/cri-master/image-config.yaml"
        resources:
          requests:
            memory: "6Gi"

  - name: pull-kubernetes-typecheck
    always_run: true
    skip_report: false
    skip_branches:
    - release-1.9 # doesn't have typecheck
    - release-1.8 # doesn't have typecheck
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--job=$(JOB_NAME)"
        - "--root=/go/src"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=75"

  - name: pull-kubernetes-verify
    always_run: true
    labels:
      preset-service-account: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=75"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            cpu: 4

  - name: pull-kubernetes-verify-prow
    always_run: false
    labels:
      preset-service-account: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bootstrap:latest
        imagePullPolicy: Always
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=75"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true
        resources:
          requests:
            cpu: 4

  kubernetes-sigs/testing_frameworks:
  - name: pull-frameworks-test
    branches:
    - master
    always_run: true
    skip_report: false
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/gcloud-in-go:v20171113-192bec25
        args:
        - "--repo=sigs.k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"

  kubernetes-sigs/poseidon:
  - name: ci-poseidon-e2e-gce
    always_run: true
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=github.com/$(REPO_OWNER)/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=110"
        securityContext:
          privileged: true
  - name: pull-poseidon-bazel
    always_run: true
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-1.10
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=github.com/$(REPO_OWNER)/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--timeout=45"
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "2Gi"
  - name: pull-poseidon-verify
    branches:
    - master
    always_run: true
    labels:
      preset-service-account: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/gcloud-in-go:v20171113-192bec25
        args:
        - "--repo=github.com/$(REPO_OWNER)/$(REPO_NAME)=$(PULL_REFS)"
        - "--root=/go/src"
        - "--upload=gs://kubernetes-jenkins/pr-logs"
        - "--clean"
        - "--timeout=45"
  kubernetes/release:
  - name: pull-release-cluster-up
    always_run: true
    labels:
      preset-service-account: "true"
      preset-k8s-ssh: "true"
      preset-bazel-scratch-dir: "true"
      preset-bazel-remote-cache-enabled: "true"
    spec:
      containers:
      - args:
        - --root=/go/src
        - --repo=k8s.io/kubernetes
        - --repo=k8s.io/release=$(PULL_REFS)
        - --upload=gs://kubernetes-jenkins/pr-logs
        - --timeout=90
        # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        resources:
          requests:
            memory: "6Gi"

postsubmits:
  GoogleCloudPlatform/k8s-multicluster-ingress:
  - name: ci-kubemci-image-push
    branches:
    - master
    labels:
      preset-service-account: "true"
      preset-dind-enabled: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
        args:
        - "--repo=k8s.io/test-infra=master"
        - "--root=/go/src/"
        - "--timeout=90"
        # docker-in-docker needs privileged mode
        securityContext:
          privileged: true

  kubernetes/federation:
  - name: ci-federation-release
    labels:
      preset-service-account: "true"
      preset-bazel-scratch-dir: "true"
    spec:
      containers:
      - image: gcr.io/k8s-testimages/bazelbuild:v20180201-0184a54dc-0.8.1
        args:
        - "--job=$(JOB_NAME)"
        - "--repo=k8s.io/$(REPO_NAME)=$(PULL_REFS)"
        - "--service-account=/etc/service-account/service-account.json"
        - "--upload=gs://kubernetes-jenkins/logs"
          # Bazel needs privileged mode in order to sandbox builds.
        securityContext:
          privileged: true
        resources:
          requests:
            memory: "2Gi"

periodics:
- interval: 2h
  name: application-periodic-default-gke
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--job=$(JOB_NAME)"
      - "--repo=github.com/kubernetes-sigs/application=master"
      - "--upload=gs://kubernetes-jenkins/logs/"
      - "--timeout=150"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 6
          memory: "8Gi"

- name: ci-docker-node-conformance
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - --repo=k8s.io/kubernetes=master
      - --timeout=90
      - --root=/go/src
      env:
      - name: GOPATH
        value: /go

- name: ci-docker-node-features
  interval: 4h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - --repo=k8s.io/kubernetes=master
      - --timeout=200
      - --root=/go/src
      env:
      - name: GOPATH
        value: /go

- name: ci-docker-node-legacy
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - --repo=k8s.io/kubernetes=master
      - --timeout=200
      - --root=/go/src
      env:
      - name: GOPATH
        value: /go

- interval: 1h
  name: ci-federation-build
  labels:
    preset-service-account: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
      args:
      - --repo=k8s.io/federation=master
      - --repo=k8s.io/release
      - --root=/go/src
      - --timeout=50
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 4
          memory: "8Gi"

- interval: 30m
  name: ci-federation-e2e-gce
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - args:
      - --timeout=920
      - --bare
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
- interval: 30m
  name: ci-federation-e2e-gce-serial
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - args:
      - --timeout=920
      - --bare
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 60m
  name: ci-kubemci-ingress-conformance
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=110
      - --bare
      image: gcr.io/k8s-testimages/e2e-kubemci:latest
      imagePullPolicy: Always

- interval: 6h
  name: ci-kubernetes-dind-conformance
  labels:
    preset-service-account: "true"
    preset-bazel-scratch-dir: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--job=$(JOB_NAME)"
      - "--root=/go/src"
      - "--repo=k8s.io/kubernetes=master"
      - "--repo=k8s.io/test-infra=master"
      - "--service-account=/etc/service-account/service-account.json"
      - "--upload=gs://kubernetes-jenkins/logs"
      - "--scenario=dindind_execute"
      - "--"
      - "kubetest"
      - "--"
      - "--build=dind"
      - "--deployment=dind"
      - "--up"
      - "--test"
      - "--ginkgo-focus=\\[Conformance\\]"
      - "--down"
      # Bazel needs privileged mode in order to sandbox builds.
      securityContext:
        privileged: true
        capabilities:
          add: ["SYS_ADMIN"]
      volumeMounts:
      - mountPath: /lib/modules
        name: modules
        readOnly: true
      - mountPath: /sys/fs/cgroup
        name: cgroup
      resources:
        requests:
          # We can adjust this after we know the requirements.
          memory: "6Gi"
    volumes:
    - name: modules
      hostPath:
        path: /lib/modules
        type: Directory
    - name: cgroup
      hostPath:
        path: /sys/fs/cgroup
        type: Directory
- name: ci-kubernetes-e2e-autoscaling-vpa-actuation
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--repo=k8s.io/autoscaler=master"
      - "--root=/go/src"
      - "--timeout=80"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true

- name: ci-kubernetes-e2e-autoscaling-vpa-admission-controller
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--repo=k8s.io/autoscaler=master"
      - "--root=/go/src"
      - "--timeout=80"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true

- name: ci-kubernetes-e2e-autoscaling-vpa-full
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--repo=k8s.io/autoscaler=master"
      - "--root=/go/src"
      - "--timeout=80"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true

- name: ci-kubernetes-e2e-autoscaling-vpa-recommender
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--repo=k8s.io/autoscaler=master"
      - "--root=/go/src"
      - "--timeout=80"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true

- name: ci-kubernetes-e2e-autoscaling-vpa-updater
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--repo=k8s.io/autoscaler=master"
      - "--root=/go/src"
      - "--timeout=80"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true

- name: ci-kubernetes-e2e-gce-device-plugin-gpu
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-device-plugin-gpu-beta
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-device-plugin-gpu-stable1
  interval: 6h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-device-plugin-gpu-stable2
  interval: 12h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 1h
  name: ci-kubernetes-e2e-gce-federation-release-1-8
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=920
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 2h
  name: ci-kubernetes-e2e-gce-gci-latest-rollback-etcd
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=110
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-beta-stable1-cluster-downgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-master-stable1-cluster-downgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-gpu-stable1
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable1-beta-cluster-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable1-beta-master-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable1-master-cluster-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable1-master-master-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-gpu-stable2
  interval: 6h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable2-stable1-cluster-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-e2e-gce-gpu-stable2-stable1-master-upgrade
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=180
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gce-ha-master
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=240
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gce-influxdb
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=70
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 24h
  name: ci-kubernetes-e2e-gce-min-node-permissions
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=520
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gce-multizone
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=170
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gce-pod-preemption
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:latest-master
      imagePullPolicy: Always


- interval: 30m
  name: ci-kubernetes-e2e-gce-prometheus
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=70
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gce-stackdriver
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=70
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gce-taint-evict
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=80
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-autoscaling
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=350
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-autoscaling-hpa
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=350
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-autoscaling-migs
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=350
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-autoscaling-migs-hpa
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=350
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-es-logging
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=110
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-garbage
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=620
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-proto
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=70
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-sd-logging
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1340
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gce-statefulset
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=110
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gke-autoscaling
  labels:
    preset-gke-alpha-service: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=620
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 4h
  name: ci-kubernetes-e2e-gci-gke-autoscaling-gpu-k80
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=170
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 4h
  name: ci-kubernetes-e2e-gci-gke-autoscaling-gpu-p100
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=170
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 4h
  name: ci-kubernetes-e2e-gci-gke-autoscaling-gpu-v100
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=170
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gke-autoscaling-hpa
  labels:
    preset-gke-alpha-service: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=440
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gke-autoscaling-regional
  labels:
    preset-gke-alpha-service: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=440
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gke-prod
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=620
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gke-prod-parallel
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=100
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gci-gke-prod-smoke
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=100
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-beta
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-monitoring
  interval: 3h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-p100
  interval: 12h #expensive test
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-p100-beta
  interval: 12h #expensive test
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-p100-stable1
  interval: 12h #expensive test
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-p100-stable2
  interval: 12h #expensive test
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-stable1
  interval: 6h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-stable2
  interval: 12h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- name: ci-kubernetes-e2e-gke-device-plugin-gpu-ubuntu
  interval: 2h
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=300
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 1h
  name: ci-kubernetes-e2e-gke-gci-ci-master
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=70
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-prod
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=820
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-prod-parallel
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=100
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-prod-smoke
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=100
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-sd-logging-gci-beta
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1400
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-sd-logging-gci-latest
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1400
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-sd-logging-gci-stable1
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1400
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-sd-logging-ubuntu-beta
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1400
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-sd-logging-ubuntu-latest
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1400
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-sd-logging-ubuntu-stable1
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1400
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 30m
  name: ci-kubernetes-e2e-gke-stackdriver
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=70
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 2h
  name: ci-kubernetes-federation-build-1-8
  labels:
    preset-service-account: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
      args:
      - --repo=k8s.io/kubernetes=release-1.8
      - --repo=k8s.io/release
      - --root=/go/src
      - --timeout=50
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 4
          memory: "8Gi"

- name: ci-kubernetes-local-e2e
  interval: 60m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--timeout=140"
      - "--bare"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true

- name: ci-kubernetes-local-e2e-containerized
  interval: 60m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--timeout=140"
      - "--bare"
      env:
      - name: DOCKERIZE_KUBELET
        value: "true"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true

- interval: 6h
  name: ci-kubernetes-multicluster-ingress-test
  labels:
    preset-service-account: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - --repo=github.com/GoogleCloudPlatform/k8s-multicluster-ingress=master
      - --root=/go/src
      - --timeout=50
      - --service-account=/etc/service-account/service-account.json
      - --upload=gs://kubernetes-jenkins/logs
      volumeMounts:
      - name: coveralls
        mountPath: /etc/coveralls-token
        readOnly: true
    volumes:
    - name: coveralls
      secret:
        secretName: k8s-multicluster-ingress-coveralls-token

- interval: 12h
  name: ci-kubernetes-soak-gce-gci
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1220
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-soak-gci-gce-beta
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1220
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-soak-gci-gce-stable1
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=1220
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-soak-gci-gce-stable2
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=820
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-soak-gci-gce-stable3
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=820
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 12h
  name: ci-kubernetes-soak-gke-gci
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - args:
      - --timeout=820
      - --bare
      image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master

- interval: 2h
  name: ci-kubernetes-verify-beta
  labels:
    preset-service-account: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
      args:
      - "--repo=k8s.io/kubernetes=release-1.11"
      - "--timeout=75"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 4

- interval: 1h
  name: ci-kubernetes-verify-master
  labels:
    preset-service-account: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
      args:
      - "--repo=k8s.io/kubernetes"
      - "--timeout=75"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 4

- interval: 2h
  name: ci-kubernetes-verify-stable1
  labels:
    preset-service-account: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
      args:
      - "--repo=k8s.io/kubernetes=release-1.10"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 4

- interval: 6h
  name: ci-kubernetes-verify-stable2
  labels:
    preset-service-account: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
      args:
      - "--repo=k8s.io/kubernetes=release-1.9"
      - "--timeout=75"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 4

- interval: 24h
  name: ci-kubernetes-verify-stable3
  labels:
    preset-service-account: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/bootstrap:v20180730-c3257f6c0
      args:
      - "--repo=k8s.io/kubernetes=release-1.8"
      - "--timeout=75"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 4

- interval: 2h
  name: ci-kustomize-periodic-default-gke
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--job=$(JOB_NAME)"
      - "--root=/go/src"
      - "--repo=github.com/kubernetes-sigs/kustomize"
      - "--upload=gs://kubernetes-jenkins/logs/"
      - "--timeout=150"

- interval: 2h
  name: istio-periodic-e2e-gke-addon
  labels:
    preset-istio-service: "true"
    preset-k8s-ssh: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - --repo=github.com/ostromart/istio=k8s-prow-test
      - --timeout=90
      - --root=/go/src

- interval: 2h
  name: spark-periodic-default-gke
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--job=$(JOB_NAME)"
      - "--repo=github.com/apache-spark-on-k8s/spark-integration=master"
      - "--upload=gs://kubernetes-jenkins/logs/"
      - "--timeout=150"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 6
          memory: "8Gi"

- interval: 2h
  name: spark-periodic-latest-gke
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
    preset-dind-enabled: "true"
  spec:
    containers:
    - image: gcr.io/k8s-testimages/kubekins-e2e:v20180730-8b7ab3104-master
      args:
      - "--job=$(JOB_NAME)"
      - "--repo=github.com/apache-spark-on-k8s/spark-integration=master"
      - "--upload=gs://kubernetes-jenkins/logs/"
      - "--timeout=150"
      # docker-in-docker needs privileged mode
      securityContext:
        privileged: true
      resources:
        requests:
          cpu: 6
          memory: "8Gi"
